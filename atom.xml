<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Dolice Lab]]></title>
  <link href="http://lab.dolice.net/atom.xml" rel="self"/>
  <link href="http://lab.dolice.net/"/>
  <updated>2013-09-03T21:29:27+09:00</updated>
  <id>http://lab.dolice.net/</id>
  <author>
    <name><![CDATA[Masaki Hirokawa]]></name>
    <email><![CDATA[info@dolice.net]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ユーティリティ機能をまとめた「DCUtil」クラス]]></title>
    <link href="http://lab.dolice.net/blog/2013/09/03/download-objc-classes-dc-util/"/>
    <updated>2013-09-03T14:39:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/09/03/download-objc-classes-dc-util</id>
    <content type="html"><![CDATA[<p>Objective-Cのユーティリティ系機能をまとめた「DCUtil」クラスを作成しました。まだ機能も少ないので、今後随時更新して行きます。</p>

<h2>主な機能</h2>

<ol>
<li>スリープ禁止モードの切り替え機能</li>
<li>テキストと画像のソーシャルシェア機能</li>
<li>ペーストボードへのテキストコピー機能</li>
<li>指定した URLを開く機能</li>
<li>アラート表示機能</li>
</ol>


<p>下記よりソースコードのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-util">https://github.com/masakihirokawa/objc-classes-dc-util</a></li>
</ul>


<h2>ソースコード</h2>

<h3>DCUtil.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCUtil</span> : <span class="nc">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark public method</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setIdleTimerDisabled:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">isDisabled</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">socialShare:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">delegate</span> <span class="nf">shareText:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">shareText</span> <span class="nf">shareImage:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">shareImage</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">copyToPasteBoard:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">copyText</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">openUrl:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAlert:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span> <span class="nf">message:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">message</span> <span class="nf">cancelButtonTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">cancelButtonTitle</span> <span class="nf">otherButtonTitles:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">otherButtonTitles</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCUtil.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCUtil.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCUtil</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark social share</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//スリープ禁止の切り替え</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setIdleTimerDisabled:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">isDisabled</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">setIdleTimerDisabled:</span><span class="n">isDisabled</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//シェアする</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">socialShare:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">delegate</span> <span class="nf">shareText:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">shareText</span> <span class="nf">shareImage:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">shareImage</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span><span class="p">([</span><span class="n">UIActivityViewController</span> <span class="n">class</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSString</span> <span class="o">*</span><span class="n">textToShare</span> <span class="o">=</span> <span class="n">shareText</span><span class="p">;</span>
</span><span class='line'>        <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageToShare</span> <span class="o">=</span> <span class="n">shareImage</span><span class="p">;</span>
</span><span class='line'>        <span class="n">NSArray</span> <span class="o">*</span><span class="n">itemsToShare</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithObjects:</span><span class="n">textToShare</span><span class="p">,</span> <span class="n">imageToShare</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>        <span class="n">UIActivityViewController</span> <span class="o">*</span><span class="n">activityVC</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIActivityViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithActivityItems:</span><span class="n">itemsToShare</span> <span class="nl">applicationActivities:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>        <span class="n">activityVC</span><span class="p">.</span><span class="n">excludedActivityTypes</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithObjects:</span> <span class="n">UIActivityTypePrint</span><span class="p">,</span> <span class="n">UIActivityTypeCopyToPasteboard</span><span class="p">,</span> <span class="n">UIActivityTypeAssignToContact</span><span class="p">,</span> <span class="n">UIActivityTypeSaveToCameraRoll</span><span class="p">,</span> <span class="n">UIActivityTypeMessage</span><span class="p">,</span> <span class="n">UIActivityTypePostToWeibo</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">delegate</span> <span class="nl">presentViewController:</span><span class="n">activityVC</span> <span class="nl">animated:</span><span class="n">YES</span> <span class="nl">completion:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark copy to paste board</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//ペーストボードにコピー</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">copyToPasteBoard:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">copyText</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//ペーストボードにコピー</span>
</span><span class='line'>    <span class="n">UIPasteboard</span> <span class="o">*</span><span class="n">board</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIPasteboard</span> <span class="n">generalPasteboard</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">board</span> <span class="nl">setValue:</span><span class="n">copyText</span> <span class="nl">forPasteboardType:</span><span class="s">@&quot;public.utf8-plain-text&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//コピー完了アラート表示</span>
</span><span class='line'>    <span class="p">[</span><span class="n">DCUtil</span> <span class="nl">showAlert:</span><span class="nb">nil</span> <span class="nl">message:</span><span class="s">@&quot;クリップボードにコピーしました&quot;</span> <span class="nl">cancelButtonTitle:</span><span class="nb">nil</span> <span class="nl">otherButtonTitles:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark open url</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//URLを開く</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">openUrl:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">openURL:</span><span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="n">url</span><span class="p">]];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark show alert</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アラート表示</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAlert:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span> <span class="nf">message:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">message</span> <span class="nf">cancelButtonTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">cancelButtonTitle</span> <span class="nf">otherButtonTitles:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">otherButtonTitles</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">otherButtonTitles</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="n">otherButtonTitles</span> <span class="o">=</span> <span class="s">@&quot;OK&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UIAlertView</span> <span class="o">*</span><span class="n">alert</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="n">title</span>
</span><span class='line'>                                                    <span class="nl">message:</span><span class="n">message</span>
</span><span class='line'>                                                   <span class="nl">delegate:</span><span class="n">self</span>
</span><span class='line'>                                          <span class="nl">cancelButtonTitle:</span><span class="n">cancelButtonTitle</span>
</span><span class='line'>                                          <span class="nl">otherButtonTitles:</span><span class="n">otherButtonTitles</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">alert</span> <span class="n">show</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Objective-Cで指定した文字列をペーストボードにコピーする]]></title>
    <link href="http://lab.dolice.net/blog/2013/09/03/objc-copy-to-paste-board/"/>
    <updated>2013-09-03T12:15:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/09/03/objc-copy-to-paste-board</id>
    <content type="html"><![CDATA[<p>Objective-Cで URL等の指定した文字列をペーストボードにコピーする方法を以下に記載します。</p>

<p>UIPasteboardの値にコピーさせたい文字列と文字コードを指定して使用します。</p>

<h2>ソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//ペーストボードにコピー</span>
</span><span class='line'><span class="n">UIPasteboard</span> <span class="o">*</span><span class="n">board</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIPasteboard</span> <span class="n">generalPasteboard</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">board</span> <span class="nl">setValue:</span><span class="s">@&quot;コピーさせたい文字列&quot;</span> <span class="nl">forPasteboardType:</span><span class="s">@&quot;public.utf8-plain-text&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アラート表示</span>
</span><span class='line'><span class="n">UIAlertView</span> <span class="o">*</span><span class="n">alert</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="nb">nil</span>
</span><span class='line'>                                                <span class="nl">message:</span><span class="s">@&quot;クリップボードにコピーしました&quot;</span>
</span><span class='line'>                                               <span class="nl">delegate:</span><span class="n">self</span>
</span><span class='line'>                                      <span class="nl">cancelButtonTitle:</span><span class="nb">nil</span>
</span><span class='line'>                                      <span class="nl">otherButtonTitles:</span><span class="s">@&quot;OK&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">alert</span> <span class="n">show</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[アプリ内課金をする「DCAppPurchase」クラス]]></title>
    <link href="http://lab.dolice.net/blog/2013/09/02/download-objc-classes-dc-app-purchase/"/>
    <updated>2013-09-02T19:30:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/09/02/download-objc-classes-dc-app-purchase</id>
    <content type="html"><![CDATA[<p>iOSでアプリ内課金をするための「DCAppPurchase」クラスを作成しました。実際のパッケージで動作確認済みです。</p>

<p>このクラスの使用には、StoreKitフレームワークが必要になります。</p>

<p>購入対象のプロダクトIDと、呼び出し側の viewを渡して購入処理を開始します。viewは購入処理中のインジケータ表示のために渡します。</p>

<p>下記よりサンプルとソースコードのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-app-purchase">https://github.com/masakihirokawa/objc-classes-dc-app-purchase</a></li>
</ul>


<h2>使用方法</h2>

<h3>プロダクトの購入リクエスト</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//プロダクトの購入リクエスト開始</span>
</span><span class='line'><span class="n">DCAppPurchase</span> <span class="o">*</span><span class="n">appPurchase</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCAppPurchase</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">appPurchase</span> <span class="nl">startPurchase:</span><span class="s">@&quot;com.exsample.xxx.unlock_yyy&quot;</span> <span class="nl">view:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCAppPurchase.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;StoreKit/StoreKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define AI_LARGE_SIZE       50</span>
</span><span class='line'><span class="cp">#define AI_SMALL_SIZE       20</span>
</span><span class='line'><span class="cp">#define AI_BG_COLOR         [UIColor colorWithRed:0 green:0 blue:0 alpha:0.5f]</span>
</span><span class='line'><span class="cp">#define SCREEN_WIDTH        320</span>
</span><span class='line'><span class="cp">#define SCREEN_HEIGHT       480</span>
</span><span class='line'><span class="cp">#define SCREEN_HEIGHT_4INCH 568</span>
</span><span class='line'>
</span><span class='line'><span class="k">@protocol</span> <span class="nc">DCAppPurchaseDelegate</span>;
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCAppPurchase</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">SKProductsRequestDelegate</span><span class="p">,</span> <span class="n">SKPaymentTransactionObserver</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">id</span><span class="o">&lt;</span><span class="n">DCAppPurchaseDelegate</span><span class="o">&gt;</span> <span class="n">_dc_delegate</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">id</span>                        <span class="n">_delegate</span><span class="p">;</span>
</span><span class='line'>    <span class="n">NSString</span>                  <span class="o">*</span><span class="n">productId_</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">id</span>                        <span class="n">view_</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">BOOL</span>                      <span class="n">isProccessing_</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UIActivityIndicatorView</span>   <span class="o">*</span><span class="n">indicator_</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UIView</span>                    <span class="o">*</span><span class="n">indicatorOverlay_</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">+</span> <span class="p">(</span><span class="n">DCAppPurchase</span> <span class="o">*</span><span class="p">)</span><span class="n">sharedManager</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark property prottype</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">id</span><span class="o">&lt;</span><span class="n">DCAppPurchaseDelegate</span><span class="o">&gt;</span> <span class="n">dc_delegate</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">id</span> <span class="n">delegate</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark public method</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startPurchase:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productId</span> <span class="nf">view:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">restorePurchase</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark delegate prottype</span>
</span><span class='line'><span class="k">@protocol</span> <span class="nc">DCAppPurchaseDelegate</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">DCAppPurchaseDidFinish</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCAppPurchase.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCAppPurchase.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCAppPurchase</span>
</span><span class='line'>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">dc_delegate</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">delegate</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark init</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">DCAppPurchase</span> <span class="o">*</span><span class="n">_sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">DCAppPurchase</span> <span class="o">*</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCAppPurchase</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">SKPaymentQueue</span> <span class="n">defaultQueue</span><span class="p">]</span> <span class="nl">addTransactionObserver:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark in app purchase</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アプリ内課金処理を開始</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startPurchase:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productId</span> <span class="nf">view:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//アプリ内課金が許可されていなければアラートを出して終了</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">self</span> <span class="n">canMakePayments</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="s">@&quot;アプリ内課金が許可されていません&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//処理中であれば処理しない</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isProccessing_</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//処理中フラグを立てる</span>
</span><span class='line'>    <span class="n">isProccessing_</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//プロダクトID保持</span>
</span><span class='line'>    <span class="n">productId_</span> <span class="o">=</span> <span class="n">productId</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//View保持</span>
</span><span class='line'>    <span class="n">view_</span> <span class="o">=</span> <span class="n">view</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//プロダクト情報の取得処理を開始</span>
</span><span class='line'>    <span class="n">NSSet</span> <span class="o">*</span><span class="n">set</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSSet</span> <span class="nl">setWithObjects:</span><span class="n">productId_</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="n">SKProductsRequest</span> <span class="o">*</span><span class="n">productsRequest</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SKProductsRequest</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithProductIdentifiers:</span><span class="n">set</span><span class="p">];</span>
</span><span class='line'>    <span class="n">productsRequest</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">productsRequest</span> <span class="n">start</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//デリゲートメソッド (プロダクト情報を取得)</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">productsRequest:</span><span class="p">(</span><span class="n">SKProductsRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span> <span class="nf">didReceiveResponse:</span><span class="p">(</span><span class="n">SKProductsResponse</span> <span class="o">*</span><span class="p">)</span><span class="nv">response</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//レスポンスがなければエラー処理</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">response</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="s">@&quot;レスポンスがありません&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//プロダクトIDが無効な場合はアラートを出して終了</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">response</span><span class="p">.</span><span class="n">invalidProductIdentifiers</span> <span class="n">count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="s">@&quot;プロダクトIDが無効です&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//購入処理開始</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">SKProduct</span> <span class="o">*</span><span class="n">product</span> <span class="k">in</span> <span class="n">response</span><span class="p">.</span><span class="n">products</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">SKPayment</span> <span class="o">*</span><span class="n">payment</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKPayment</span> <span class="nl">paymentWithProduct:</span><span class="n">product</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">SKPaymentQueue</span> <span class="n">defaultQueue</span><span class="p">]</span> <span class="nl">addPayment:</span><span class="n">payment</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//購入完了時の処理</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">completeTransaction:</span><span class="p">(</span><span class="n">SKPaymentTransaction</span> <span class="o">*</span><span class="p">)</span><span class="nv">transaction</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//アイテム付与</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">itemGrant</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//トランザクション記録</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">recordTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//コンテンツ提供記録</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">provideContent:</span><span class="n">transaction</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">productIdentifier</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//リストア完了時の処理</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">restoreTransaction:</span><span class="p">(</span><span class="n">SKPaymentTransaction</span> <span class="o">*</span><span class="p">)</span><span class="nv">transaction</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//アイテム付与</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">itemGrant</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//トランザクション記録</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">recordTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//コンテンツ提供記録</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">provideContent:</span><span class="n">transaction</span><span class="p">.</span><span class="n">originalTransaction</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">productIdentifier</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アイテム付与</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">itemGrant</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//ここでアイテム付与を行う</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//トランザクション記録</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">recordTransaction:</span><span class="p">(</span><span class="n">SKPaymentTransaction</span> <span class="o">*</span><span class="p">)</span><span class="nv">transaction</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//コンテンツ提供</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">provideContent:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productIdentifier</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//デリゲートメソッド (購入処理開始後に状態が変わるごとに随時コールされる)</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">paymentQueue:</span><span class="p">(</span><span class="n">SKPaymentQueue</span> <span class="o">*</span><span class="p">)</span><span class="nv">queue</span> <span class="nf">updatedTransactions:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">transactions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">SKPaymentTransaction</span> <span class="o">*</span><span class="n">transaction</span> <span class="k">in</span> <span class="n">transactions</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">transactionState</span> <span class="o">==</span> <span class="n">SKPaymentTransactionStatePurchasing</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//購入処理中</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="nl">startActivityIndicator:</span><span class="n">view_</span>
</span><span class='line'>                                  <span class="nl">center:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">SCREEN_WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">self</span> <span class="n">is4inch</span><span class="p">]</span> <span class="o">?</span> <span class="n">SCREEN_HEIGHT_4INCH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">SCREEN_HEIGHT</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                                 <span class="nl">styleId:</span><span class="n">AI_WHITE</span>
</span><span class='line'>                        <span class="nl">hidesWhenStopped:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">transactionState</span> <span class="o">==</span> <span class="n">SKPaymentTransactionStatePurchased</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//購入処理成功</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="s">@&quot;購入ありがとうございます&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//該当するプロダクトのロックを解除する</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="nl">completeTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//インジケータ非表示</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//処理中フラグを下ろす</span>
</span><span class='line'>            <span class="n">isProccessing_</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//ペイメントキューからトランザクションを削除</span>
</span><span class='line'>            <span class="p">[</span><span class="n">queue</span> <span class="nl">finishTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">transactionState</span> <span class="o">==</span> <span class="n">SKPaymentTransactionStateFailed</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//ユーザーによるキャンセルでなければアラートを出す</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">code</span> <span class="o">!=</span> <span class="n">SKErrorPaymentCancelled</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">//購入処理失敗の場合はアラート表示</span>
</span><span class='line'>                <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="p">[</span><span class="n">transaction</span><span class="p">.</span><span class="n">error</span> <span class="n">localizedDescription</span><span class="p">]];</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//インジケータ非表示</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//処理中フラグを下ろす</span>
</span><span class='line'>            <span class="n">isProccessing_</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//ペイメントキューからトランザクションを削除</span>
</span><span class='line'>            <span class="p">[</span><span class="n">queue</span> <span class="nl">finishTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">transactionState</span> <span class="o">==</span> <span class="n">SKPaymentTransactionStateRestored</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//リストア処理開始</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="s">@&quot;購入アイテムを復元しました&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//購入済みのプロダクトのロックを再解除する</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="nl">restoreTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//インジケータ非表示</span>
</span><span class='line'>            <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//処理中フラグを下ろす</span>
</span><span class='line'>            <span class="n">isProccessing_</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//ペイメントキューからトランザクションを削除</span>
</span><span class='line'>            <span class="p">[</span><span class="n">queue</span> <span class="nl">finishTransaction:</span><span class="n">transaction</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark restore</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//リストア</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">restorePurchase</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//購入済みプラグインのリストア処理を開始する</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">SKPaymentQueue</span> <span class="n">defaultQueue</span><span class="p">]</span> <span class="n">restoreCompletedTransactions</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//リストア完了</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">paymentQueueRestoreCompletedTransactionsFinished:</span><span class="p">(</span><span class="n">SKPaymentQueue</span> <span class="o">*</span><span class="p">)</span><span class="nv">queue</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">SKPaymentTransaction</span> <span class="o">*</span><span class="n">transaction</span> <span class="k">in</span> <span class="n">queue</span><span class="p">.</span><span class="n">transactions</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//NSLog(@&quot;Restore Product ID: %@&quot;, transaction.payment.productIdentifier);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//リストアキュー</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">paymentQueue:</span><span class="p">(</span><span class="n">SKPaymentQueue</span> <span class="o">*</span><span class="p">)</span><span class="nv">queue</span> <span class="nf">restoreCompletedTransactionsFailedWithError:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">SKPaymentTransaction</span> <span class="o">*</span><span class="n">transaction</span> <span class="k">in</span> <span class="n">queue</span><span class="p">.</span><span class="n">transactions</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//NSLog(@&quot;Restore Product ID: %@&quot;, transaction.payment.productIdentifier);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark check method</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アプリ内課金が許可されているか</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">canMakePayments</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">SKPaymentQueue</span> <span class="n">canMakePayments</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark delegate method</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//デリゲートメソッド (終了通知)</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">requestDidFinish:</span><span class="p">(</span><span class="n">SKRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//デリゲートメソッド (アクセスエラー)</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">request:</span><span class="p">(</span><span class="n">SKRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span> <span class="nf">didFailWithError:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">showAlert:</span><span class="p">[</span><span class="n">error</span> <span class="n">localizedDescription</span><span class="p">]];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark activity indicator</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="k">enum</span> <span class="n">activityIndicatorStyles</span> <span class="o">:</span> <span class="n">NSUInteger</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">AI_GRAY</span>        <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AI_WHITE</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AI_WHITE_LARGE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="p">}</span> <span class="n">activityIndicatorStyles</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アクティビティインジケータのアニメーション開始</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startActivityIndicator:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span> <span class="nf">center:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">center</span> <span class="nf">styleId:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">styleId</span> <span class="nf">hidesWhenStopped:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidesWhenStopped</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//インジケーター初期化</span>
</span><span class='line'>    <span class="n">indicator_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIActivityIndicatorView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スタイルを設定</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">styleId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_GRAY:</span>
</span><span class='line'>            <span class="n">indicator_</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleGray</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_WHITE:</span>
</span><span class='line'>            <span class="n">indicator_</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhite</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_WHITE_LARGE:</span>
</span><span class='line'>            <span class="n">indicator_</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スタイルに応じて寸法変更</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">indicator_</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">==</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">indicator_</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AI_LARGE_SIZE</span><span class="p">,</span> <span class="n">AI_LARGE_SIZE</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">indicator_</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AI_SMALL_SIZE</span><span class="p">,</span> <span class="n">AI_SMALL_SIZE</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//座標をセンターに指定</span>
</span><span class='line'>    <span class="n">indicator_</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//停止した時に隠れるよう設定</span>
</span><span class='line'>    <span class="n">indicator_</span><span class="p">.</span><span class="n">hidesWhenStopped</span> <span class="o">=</span> <span class="n">hidesWhenStopped</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//インジケーターアニメーション開始</span>
</span><span class='line'>    <span class="p">[</span><span class="n">indicator_</span> <span class="n">startAnimating</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//オーバーレイ表示</span>
</span><span class='line'>    <span class="n">indicatorOverlay_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="p">[</span><span class="n">self</span> <span class="n">is4inch</span><span class="p">]</span> <span class="o">?</span> <span class="n">SCREEN_HEIGHT_4INCH</span> <span class="o">:</span> <span class="n">SCREEN_HEIGHT</span><span class="p">)];</span>
</span><span class='line'>    <span class="n">indicatorOverlay_</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">AI_BG_COLOR</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">indicatorOverlay_</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//画面に追加</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">indicator_</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アクティビティインジケータのアニメーション停止</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopActivityIndicator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">indicatorOverlay_</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">indicator_</span> <span class="n">stopAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アクティビティインジケータがアニメーション中であるか</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isAnimatingActivityIndicator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">indicator_</span> <span class="n">isAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark common method</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アラート表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAlert:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">message</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">UIAlertView</span> <span class="o">*</span><span class="n">alert</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="nb">nil</span>
</span><span class='line'>                                                    <span class="nl">message:</span><span class="n">message</span>
</span><span class='line'>                                                   <span class="nl">delegate:</span><span class="n">self</span>
</span><span class='line'>                                          <span class="nl">cancelButtonTitle:</span><span class="s">@&quot;OK&quot;</span>
</span><span class='line'>                                          <span class="nl">otherButtonTitles:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">alert</span> <span class="n">show</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//4インチ端末であるか</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">is4inch</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CGSize</span> <span class="n">screenSize</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">screenSize</span><span class="p">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">SCREEN_WIDTH</span> <span class="o">&amp;&amp;</span> <span class="n">screenSize</span><span class="p">.</span><span class="n">height</span> <span class="o">==</span> <span class="n">SCREEN_HEIGHT_4INCH</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[インジケーターを表示する「DCActivityIndicator」クラス改訂版]]></title>
    <link href="http://lab.dolice.net/blog/2013/09/02/download-objc-classes-dc-activity-indicator2/"/>
    <updated>2013-09-02T17:30:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/09/02/download-objc-classes-dc-activity-indicator2</id>
    <content type="html"><![CDATA[<p>iOSのアクティビティインジケーターを制御する「DCActivityIndicator」クラスで、背景にオーバーレイを表示できるよう改訂しました。startメソッドの showOverlayパラメータに YESを渡すと、半透明のオーバーレイが表示されます。</p>

<p>このクラスでは、アクティビティインジケーターのアニメーション再生／停止／再生状況の取得を行えます。</p>

<p>下記よりサンプルとソースコードのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-activity-indicator2">https://github.com/masakihirokawa/objc-classes-dc-activity-indicator2</a></li>
</ul>


<h2>使用方法</h2>

<h3>アクティビティインジケーターのアニメーション再生</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">DCActivityIndicator</span> <span class="nl">start:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span>
</span><span class='line'>                    <span class="nl">center:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">center</span>
</span><span class='line'>                   <span class="nl">styleId:</span><span class="n">GRAY</span>
</span><span class='line'>          <span class="nl">hidesWhenStopped:</span><span class="n">YES</span>
</span><span class='line'>               <span class="nl">showOverlay:</span><span class="n">YES</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>アクティビティインジケーターのアニメーション停止</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">DCActivityIndicator</span> <span class="n">stop</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>アクティビティインジケーターのアニメーション再生状況取得</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">if</span> <span class="p">([</span><span class="n">DCActivityIndicator</span> <span class="n">isAnimating</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//アニメーション再生中の処理</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCActivityIndicator.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define INDICATOR_LARGE_SIZE 50</span>
</span><span class='line'><span class="cp">#define INDICATOR_SMALL_SIZE 20</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCActivityIndicator</span> : <span class="nc">UIActivityIndicatorView</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">start:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span> <span class="nf">center:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">center</span> <span class="nf">styleId:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">styleId</span> <span class="nf">hidesWhenStopped:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidesWhenStopped</span> <span class="nf">showOverlay:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">showOverlay</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stop</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isAnimating</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCActivityIndicator.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCActivityIndicator.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCActivityIndicator</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">UIActivityIndicatorView</span> <span class="o">*</span><span class="n">indicator_</span><span class="p">;</span>
</span><span class='line'><span class="k">static</span> <span class="n">UIView</span>                  <span class="o">*</span><span class="n">overlay_</span><span class="p">;</span>
</span><span class='line'><span class="k">static</span> <span class="kt">BOOL</span>                    <span class="n">showOverlay_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="k">enum</span> <span class="n">styles</span> <span class="o">:</span> <span class="n">NSInteger</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">GRAY</span>        <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">WHITE</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="n">WHITE_LARGE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="p">}</span> <span class="n">styles</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アニメーション開始</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">start:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span> <span class="nf">center:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">center</span> <span class="nf">styleId:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">styleId</span> <span class="nf">hidesWhenStopped:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidesWhenStopped</span> <span class="nf">showOverlay:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">showOverlay</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//インジケーター初期化</span>
</span><span class='line'>    <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIActivityIndicatorView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スタイルを設定</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">styleId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">GRAY:</span>
</span><span class='line'>            <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleGray</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">WHITE:</span>
</span><span class='line'>            <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhite</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">WHITE_LARGE:</span>
</span><span class='line'>            <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スタイルに応じて寸法変更</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">==</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">INDICATOR_LARGE_SIZE</span><span class="p">,</span> <span class="n">INDICATOR_LARGE_SIZE</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">INDICATOR_SMALL_SIZE</span><span class="p">,</span> <span class="n">INDICATOR_SMALL_SIZE</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//座標をセンターに指定</span>
</span><span class='line'>    <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//停止した時に隠れるよう設定</span>
</span><span class='line'>    <span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">.</span><span class="n">hidesWhenStopped</span> <span class="o">=</span> <span class="n">hidesWhenStopped</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//インジケーターアニメーション開始</span>
</span><span class='line'>    <span class="p">[</span><span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span> <span class="n">startAnimating</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//オーバーレイ表示フラグ保持</span>
</span><span class='line'>    <span class="n">showOverlay_</span> <span class="o">=</span> <span class="n">showOverlay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//オーバーレイ表示</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">showOverlay_</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">CGSize</span> <span class="n">screenSize</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">;</span>
</span><span class='line'>        <span class="n">overlay_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="n">screenSize</span><span class="p">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">320</span> <span class="o">&amp;&amp;</span> <span class="n">screenSize</span><span class="p">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">568</span> <span class="o">?</span> <span class="mi">568</span> <span class="o">:</span> <span class="mi">480</span><span class="p">)];</span>
</span><span class='line'>        <span class="n">overlay_</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nl">colorWithRed:</span><span class="mi">0</span> <span class="nl">green:</span><span class="mi">0</span> <span class="nl">blue:</span><span class="mi">0</span> <span class="nl">alpha:</span><span class="mf">0.5f</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">overlay_</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//画面に追加</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アニメーション停止</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stop</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">showOverlay_</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">overlay_</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span> <span class="n">stopAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アニメーション中であるか</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isAnimating</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">DCActivityIndicator</span><span class="p">.</span><span class="n">indicator</span> <span class="n">isAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setIndicator:</span><span class="p">(</span><span class="n">UIActivityIndicatorView</span> <span class="o">*</span><span class="p">)</span><span class="nv">indicator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">indicator_</span> <span class="o">=</span> <span class="n">indicator</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">UIActivityIndicatorView</span> <span class="o">*</span><span class="p">)</span><span class="nf">indicator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">indicator_</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSアプリで音楽のバックグラウンド再生を許可する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/09/02/xcode-objc-required-background-modes/"/>
    <updated>2013-09-02T17:06:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/09/02/xcode-objc-required-background-modes</id>
    <content type="html"><![CDATA[<p><img src="http://lab.dolice.net/images/article/required_background_modes.png" alt="" /></p>

<p>iOSアプリで音声のバックグラウンド再生を許可する方法を以下に記載します。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/xcode-objc-required-background-modes">https://github.com/masakihirokawa/xcode-objc-required-background-modes</a></li>
</ul>


<h2>手順</h2>

<h3>1. info.plistファイルを編集</h3>

<p>info.plistファイルを Xcode左側のプロジェクトメニューから開き、Keyに [Required background modes]を追加し、[Item 0] の Valueを [App plays audio]にします</p>

<h3>2. アプリ起動時のコードに以下の記述を追加 (AVFoundationフレームワークの読み込みが前提)</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">AVAudioSession</span> <span class="o">*</span><span class="n">audioSession</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVAudioSession</span> <span class="n">sharedInstance</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">audioSession</span> <span class="nl">setCategory:</span><span class="n">AVAudioSessionCategoryPlayback</span> <span class="nl">error:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSのロック／スリープを禁止する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/09/02/objc-set-idle-timer-disabled/"/>
    <updated>2013-09-02T14:21:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/09/02/objc-set-idle-timer-disabled</id>
    <content type="html"><![CDATA[<p>Objective-Cでアプリの起動中にロック／スリープを禁止するサンプルを以下に作成しました。</p>

<p>AppDelegateの didFinishLaunchingWithOptionsメソッド内に、[[UIApplication sharedApplication] setIdleTimerDisabled:YES]; と指定するとロックとスリープを禁止できます。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-set-idle-timer-disabled">https://github.com/masakihirokawa/objc-set-idle-timer-disabled</a></li>
</ul>


<h2>ソースコード</h2>

<h3>AppDelegate.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//ロック／スリープの禁止</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">setIdleTimerDisabled:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Objective-Cで iOSデフォルトの背景画像を敷く方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/08/23/objc-background-texture/"/>
    <updated>2013-08-23T22:36:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/08/23/objc-background-texture</id>
    <content type="html"><![CDATA[<p><img src="http://lab.dolice.net/images/article/background_texture.png" alt="" /></p>

<p>Objective-Cで iOSにデフォルトで用意されている背景画像2種を敷くサンプルを以下に作成しました。</p>

<p>UIColorの colorWithPatternImageメソッドを使用して背景にパターンテクスチャを敷くより、こちらの手法の方がメモリ消費量を抑えられます。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-background-texture">https://github.com/masakihirokawa/objc-background-texture</a></li>
</ul>


<h2>使用方法</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">underPageBackgroundView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">underPageBackgroundColor</span><span class="p">];</span>
</span><span class='line'><span class="n">scrollViewTextureBackgroundView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">scrollViewTexturedBackgroundColor</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setUnderPageBackgroundColor</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">UIView</span> <span class="o">*</span><span class="n">underPageBackgroundView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">VIEW_WIDTH</span><span class="p">,</span> <span class="n">VIEW_HEIGHT</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//背景指定</span>
</span><span class='line'>    <span class="n">underPageBackgroundView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">underPageBackgroundColor</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ラベル配置</span>
</span><span class='line'>    <span class="n">UILabel</span> <span class="o">*</span><span class="n">backgroundCaption</span> <span class="o">=</span> <span class="p">[</span><span class="n">DCLabel</span> <span class="nl">roundRectLabel:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">underPageBackgroundView</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">LABEL_WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
</span><span class='line'>                                                                    <span class="n">underPageBackgroundView</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">LABEL_HEIGHT</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
</span><span class='line'>                                                                    <span class="n">LABEL_WIDTH</span><span class="p">,</span> <span class="n">LABEL_HEIGHT</span><span class="p">)</span>
</span><span class='line'>                                                    <span class="nl">text:</span><span class="s">@&quot;[UIColor underPageBackgroundColor]&quot;</span>
</span><span class='line'>                                                    <span class="nl">font:</span><span class="p">[</span><span class="n">UIFont</span> <span class="nl">systemFontOfSize:</span><span class="mi">12</span><span class="p">]</span>
</span><span class='line'>                                               <span class="nl">textColor:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">]</span> <span class="nl">textAlignment:</span><span class="n">NSTextAlignmentCenter</span>
</span><span class='line'>                                         <span class="nl">backgroundColor:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">]</span> <span class="nl">cornerRadious:</span><span class="mi">6</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">underPageBackgroundView</span> <span class="nl">addSubview:</span><span class="n">backgroundCaption</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">underPageBackgroundView</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setScrollViewTexturedBackgroundColor</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">UIView</span> <span class="o">*</span><span class="n">scrollViewTextureBackgroundView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//背景指定</span>
</span><span class='line'>    <span class="n">scrollViewTextureBackgroundView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">scrollViewTexturedBackgroundColor</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ラベル配置</span>
</span><span class='line'>    <span class="n">UILabel</span> <span class="o">*</span><span class="n">backgroundCaption</span> <span class="o">=</span> <span class="p">[</span><span class="n">DCLabel</span> <span class="nl">roundRectLabel:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">scrollViewTextureBackgroundView</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">LABEL_WIDTH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
</span><span class='line'>                                                                    <span class="n">scrollViewTextureBackgroundView</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">LABEL_HEIGHT</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">VIEW_HEIGHT</span><span class="p">,</span>
</span><span class='line'>                                                                    <span class="n">LABEL_WIDTH</span><span class="p">,</span> <span class="n">LABEL_HEIGHT</span><span class="p">)</span>
</span><span class='line'>                                                    <span class="nl">text:</span><span class="s">@&quot;[UIColor scrollViewTexturedBackgroundColor]&quot;</span>
</span><span class='line'>                                                    <span class="nl">font:</span><span class="p">[</span><span class="n">UIFont</span> <span class="nl">systemFontOfSize:</span><span class="mi">12</span><span class="p">]</span>
</span><span class='line'>                                               <span class="nl">textColor:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">]</span> <span class="nl">textAlignment:</span><span class="n">NSTextAlignmentCenter</span>
</span><span class='line'>                                         <span class="nl">backgroundColor:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">]</span> <span class="nl">cornerRadious:</span><span class="mi">6</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">scrollViewTextureBackgroundView</span> <span class="nl">addSubview:</span><span class="n">backgroundCaption</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">scrollViewTextureBackgroundView</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Objective-Cで AppDelegateをグローバル化する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/08/22/objc-app-delegate-global/"/>
    <updated>2013-08-22T23:35:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/08/22/objc-app-delegate-global</id>
    <content type="html"><![CDATA[<p>Objective-Cで AppDelegateに定義された変数やメソッドをどこからでも呼べるようグローバル化するサンプルを以下に作成しました。</p>

<p>*.pchファイルに一度 AppDelegateを定数として定義しておけば、以降どこからでも AppDelegateを初期化せずに呼ぶ事ができます。</p>

<p>以下よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-app-delegate-global">https://github.com/masakihirokawa/objc-app-delegate-global</a></li>
</ul>


<h2>使用方法</h2>

<h3>1. *.pchファイルに AppDelegateのヘッダファイルを読み込む</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;AppDelegate.h&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. *.pchファイルの定数に AppDelegateを代入する</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#define APP_DELEGATE (AppDelegate*)[[UIApplication sharedApplication] delegate]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. 2の手順で生成した定数経由でメソッドや変数を取得する</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">globalStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">APP_DELEGATE</span> <span class="n">globalStrings</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>*.pch</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;AppDelegate.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define APP_DELEGATE (AppDelegate*)[[UIApplication sharedApplication] delegate]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>AppDelegate.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">globalStrings</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>AppDelegate.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">globalStrings</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">@&quot;AppDelegate Global Strings&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//AppDelegate内のメソッドから変数を取得</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">globalStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">APP_DELEGATE</span> <span class="n">globalStrings</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS端末情報を取得する「DCDevice」クラスに言語取得機能を追加しました]]></title>
    <link href="http://lab.dolice.net/blog/2013/08/22/download-objc-classes-dc-device2/"/>
    <updated>2013-08-22T23:20:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/08/22/download-objc-classes-dc-device2</id>
    <content type="html"><![CDATA[<p>iPhone/iPadのデバイス情報を判別する「DCDevice」クラスに、iOSの設定言語が日本語か否かを判別する機能を追加しました。</p>

<p>以下よりサンプルコードを含めたソースファイルをダウンロードできます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-device2">https://github.com/masakihirokawa/objc-classes-dc-device2</a></li>
</ul>


<h2>サンプルソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//言語設定が日本語であれば1が返る</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="n">isJapaniese</span> <span class="o">=</span> <span class="p">[</span><span class="n">DCDevice</span> <span class="n">isJapaneseLanguage</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCDevice.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//言語設定取得</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isJapaneseLanguage</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">BOOL</span> <span class="n">isJapanese</span><span class="p">;</span>
</span><span class='line'>    <span class="k">static</span> <span class="n">dispatch_once_t</span> <span class="n">onceToken</span><span class="p">;</span>
</span><span class='line'>    <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">onceToken</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSArray</span> <span class="o">*</span><span class="n">languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSLocale</span> <span class="n">preferredLanguages</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSString</span> <span class="o">*</span><span class="n">currentLanguage</span> <span class="o">=</span> <span class="p">[</span><span class="n">languages</span> <span class="nl">objectAtIndex:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>        <span class="n">isJapanese</span> <span class="o">=</span> <span class="p">[</span><span class="n">currentLanguage</span> <span class="nl">compare:</span><span class="s">@&quot;ja&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">isJapanese</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[「compare」を使用した Objective-Cの文字列比較]]></title>
    <link href="http://lab.dolice.net/blog/2013/08/22/objc-compare/"/>
    <updated>2013-08-22T23:05:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/08/22/objc-compare</id>
    <content type="html"><![CDATA[<p>Objective-Cの文字列比較は「isEqualToString」を使用するのが主流ですが、「compare」メソッドを使用した文字列の比較方法を以下に記載します。</p>

<p>こちらの記述方法の方がシンプルで良いかもしれません。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-compare">https://github.com/masakihirokawa/objc-compare</a></li>
</ul>


<h2>使用方法</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">comparisonStr</span> <span class="o">=</span> <span class="s">@&quot;abc&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">([</span><span class="n">comparisonStr</span> <span class="nl">compare:</span><span class="s">@&quot;abc&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//文字列が同一である場合の処理</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">comparisonStr</span> <span class="o">=</span> <span class="s">@&quot;abc&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//文字列が同一であるか</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="n">isSameStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">comparisonStr</span> <span class="nl">compare:</span><span class="s">@&quot;abc&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//コンソール出力</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d&quot;</span><span class="p">,</span> <span class="n">isSameStrings</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[音楽ファイルの再生停止などの制御をする「DCAudioPlayer」クラス]]></title>
    <link href="http://lab.dolice.net/blog/2013/08/02/download-objc-classes-dc-audio-player/"/>
    <updated>2013-08-02T23:12:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/08/02/download-objc-classes-dc-audio-player</id>
    <content type="html"><![CDATA[<p><img src="http://lab.dolice.net/images/article/av-audio-player.png" alt="" /></p>

<p>音楽ファイルの再生停止などの制御をする「DCAudioPlayer」クラスを作成しました。</p>

<p>オーディオの再生／停止／再生状況の取得、ボリュームコントロールスライダーの生成などを行えます。</p>

<p>このクラスの使用には AVFoundationフレームワークが必要になります。</p>

<p>下記よりサンプルとソースコードのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-audio-player">https://github.com/masakihirokawa/objc-classes-dc-audio-player</a></li>
</ul>


<h2>使用方法</h2>

<h3>オーディオファイルを指定し初期化</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">_audioPlayer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCAudioPlayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAudio:</span><span class="n">AUDIO_RESOURCE_FILE_NAME</span>
</span><span class='line'>                                                <span class="nl">ext:</span><span class="n">AUDIO_RESOURCE_FILE_EXT</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>再生</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">play</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>停止</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">stop</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>一時停止</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">pause</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ボリュームコントロールスライダーの取得</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">_audioVolumeSlider</span> <span class="o">=</span> <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">volumeControlSlider:</span><span class="n">self</span>
</span><span class='line'>                                                 <span class="nl">point:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span><span class='line'>                                          <span class="nl">defaultValue:</span><span class="mf">0.2f</span>
</span><span class='line'>                                              <span class="nl">selector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">sliderValueChanged:</span><span class="p">)];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sliderValueChanged:</span><span class="p">(</span><span class="n">UISlider</span> <span class="o">*</span><span class="p">)</span><span class="nv">slider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setVolume:</span><span class="n">slider</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>音量の指定</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setVolume:</span><span class="mf">0.5f</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>現在の再生フレームの指定</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setCurrentTime:</span><span class="mi">0</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>再生ループ回数の指定</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setNumberOfLoops:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>再生状況の取得</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">BOOL</span> <span class="n">isPlaying</span> <span class="o">=</span> <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">isPlaying</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCAudioPlayer.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;AVFoundation/AVFoundation.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define AUDIO_VOLUME_SLIDER_WIDTH  220</span>
</span><span class='line'><span class="cp">#define AUDIO_VOLUME_SLIDER_HEIGHT 0</span>
</span><span class='line'><span class="cp">#define AUDIO_MAX_VOLUME           1.0f</span>
</span><span class='line'><span class="cp">#define AUDIO_MIN_VOLUME           0.5f</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCAudioPlayer</span> : <span class="nc">AVAudioPlayer</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">AVAudioPlayer</span>                       <span class="o">*</span><span class="n">audioPlayer</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="n">NSTimeInterval</span>                      <span class="n">currentTime</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSData</span>                   <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">assign</span><span class="p">)</span> <span class="kt">id</span> <span class="o">&lt;</span><span class="n">AVAudioPlayerDelegate</span><span class="o">&gt;</span> <span class="n">delegate</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="n">NSTimeInterval</span>                      <span class="n">duration</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">getter</span><span class="o">=</span><span class="n">isMeteringEnabled</span><span class="p">)</span> <span class="kt">BOOL</span>     <span class="n">meteringEnabled</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSUInteger</span>               <span class="n">numberOfChannels</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="n">NSInteger</span>                           <span class="n">numberOfLoops</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="n">isPlaying</span><span class="p">)</span> <span class="kt">BOOL</span>   <span class="n">playing</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSURL</span>                    <span class="o">*</span><span class="n">url</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="kt">float</span>                               <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithAudio:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fileName</span> <span class="nf">ext:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">ext</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">play</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pause</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stop</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UISlider</span> <span class="o">*</span><span class="p">)</span><span class="nf">volumeControlSlider:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">delegate</span> <span class="nf">point:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">point</span> <span class="nf">defaultValue:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nv">defaultValue</span> <span class="nf">selector:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">selector</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setVolume:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nv">volume</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setCurrentTime:</span><span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">currentTime</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setNumberOfLoops:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">numberOfLoops</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isPlaying</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCAudioPlayer.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCAudioPlayer.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCAudioPlayer</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//初期化</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithAudio:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fileName</span> <span class="nf">ext:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">ext</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//オーディオプレイヤー初期化</span>
</span><span class='line'>        <span class="n">NSBundle</span> <span class="o">*</span><span class="n">mainBundle</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">mainBundle</span> <span class="nl">pathForResource:</span><span class="n">fileName</span>
</span><span class='line'>                                                  <span class="nl">ofType:</span><span class="n">ext</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSURL</span> <span class="o">*</span><span class="n">fileUrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">fileURLWithPath:</span><span class="n">filePath</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>        <span class="n">AVAudioPlayer</span> <span class="o">*</span><span class="n">audioPlayer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioPlayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithContentsOfURL:</span><span class="n">fileUrl</span> <span class="nl">error:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//エラーであれば処理しない</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//オーディオプレイヤー保持</span>
</span><span class='line'>            <span class="n">_audioPlayer</span> <span class="o">=</span> <span class="n">audioPlayer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//バッファを保持</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//再生</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">play</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_audioPlayer</span><span class="p">.</span><span class="n">isPlaying</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">play</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//一時停止</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pause</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">.</span><span class="n">isPlaying</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">pause</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//停止</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stop</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">.</span><span class="n">isPlaying</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">stop</span><span class="p">];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//ボリュームコントロールスライダー</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UISlider</span> <span class="o">*</span><span class="p">)</span><span class="nf">volumeControlSlider:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">delegate</span> <span class="nf">point:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">point</span> <span class="nf">defaultValue:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nv">defaultValue</span> <span class="nf">selector:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">selector</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">UISlider</span> <span class="o">*</span><span class="n">audioVolumeSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UISlider</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
</span><span class='line'>                                                                             <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
</span><span class='line'>                                                                             <span class="n">AUDIO_VOLUME_SLIDER_WIDTH</span><span class="p">,</span>
</span><span class='line'>                                                                             <span class="n">AUDIO_VOLUME_SLIDER_HEIGHT</span><span class="p">)];</span>
</span><span class='line'>    <span class="n">audioVolumeSlider</span><span class="p">.</span><span class="n">minimumValue</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span><span class='line'>    <span class="n">audioVolumeSlider</span><span class="p">.</span><span class="n">maximumValue</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">defaultValue</span> <span class="o">&gt;</span> <span class="n">AUDIO_MAX_VOLUME</span><span class="p">)</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="n">AUDIO_MAX_VOLUME</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">defaultValue</span> <span class="o">&lt;</span> <span class="n">AUDIO_MIN_VOLUME</span><span class="p">)</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="n">AUDIO_MIN_VOLUME</span><span class="p">;</span>
</span><span class='line'>    <span class="n">audioVolumeSlider</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">defaultValue</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">audioVolumeSlider</span> <span class="nl">addTarget:</span><span class="n">delegate</span>
</span><span class='line'>                          <span class="nl">action:</span><span class="n">selector</span>
</span><span class='line'>                <span class="nl">forControlEvents:</span><span class="n">UIControlEventValueChanged</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">audioVolumeSlider</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//ボリューム指定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setVolume:</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nv">volume</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//現在の再生フレーム指定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setCurrentTime:</span><span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">currentTime</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">currentTime</span> <span class="o">=</span> <span class="n">currentTime</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//ループ回数指定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setNumberOfLoops:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">numberOfLoops</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">numberOfLoops</span> <span class="o">=</span> <span class="n">numberOfLoops</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//再生状況の取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isPlaying</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">playing</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>サンプルソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'><span class="cp">#import &quot;DCAudioPlayer.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define AUDIO_RESOURCE_FILE_NAME @&quot;o-magne&quot;</span>
</span><span class='line'><span class="cp">#define AUDIO_RESOURCE_FILE_EXT  @&quot;mp3&quot;</span>
</span><span class='line'><span class="cp">#define BUTTON_WIDTH             80</span>
</span><span class='line'><span class="cp">#define BUTTON_HEIGHT            50</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">DCAudioPlayer</span> <span class="o">*</span><span class="n">audioPlayer</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="n">UISlider</span>      <span class="o">*</span><span class="n">audioVolumeSlider</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="k">enum</span> <span class="n">audioPlayButtonEvent</span> <span class="o">:</span> <span class="n">NSInteger</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">AUDIO_PLAY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AUDIO_PAUSE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AUDIO_STOP</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="p">}</span> <span class="n">audioPlayButtonEvent</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//初期化</span>
</span><span class='line'>    <span class="n">_audioPlayer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCAudioPlayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAudio:</span><span class="n">AUDIO_RESOURCE_FILE_NAME</span>
</span><span class='line'>                                                    <span class="nl">ext:</span><span class="n">AUDIO_RESOURCE_FILE_EXT</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//再生/停止ボタンとボリュームスライダー表示</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">setButtonsAndSlider</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//再生/停止ボタンイベント</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">buttonTapped:</span><span class="p">(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">button</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">button</span><span class="p">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">AUDIO_PLAY</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//ボリューム指定</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setVolume:</span><span class="n">_audioVolumeSlider</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//ループ回数指定</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setNumberOfLoops:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//再生</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">play</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">button</span><span class="p">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">AUDIO_PAUSE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">.</span><span class="n">isPlaying</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//一時停止</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">pause</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//再生</span>
</span><span class='line'>            <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">play</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">button</span><span class="p">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">AUDIO_STOP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//再生フレーム指定</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setCurrentTime:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>        <span class="c1">//停止</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">stop</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//再生/停止ボタンとボリュームスライダーの表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setButtonsAndSlider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//再生ボタン</span>
</span><span class='line'>    <span class="n">UIButton</span> <span class="o">*</span><span class="n">buttonPlay</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nl">buttonWithType:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
</span><span class='line'>    <span class="n">buttonPlay</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">BUTTON_WIDTH</span><span class="p">,</span> <span class="n">BUTTON_HEIGHT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">buttonPlay</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">AUDIO_PLAY</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonPlay</span> <span class="nl">setTitle:</span><span class="s">@&quot;Play&quot;</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonPlay</span> <span class="nl">addTarget:</span><span class="n">self</span>
</span><span class='line'>                   <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">buttonTapped:</span><span class="p">)</span>
</span><span class='line'>         <span class="nl">forControlEvents:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">buttonPlay</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//一時停止ボタン</span>
</span><span class='line'>    <span class="n">UIButton</span> <span class="o">*</span><span class="n">buttonPause</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nl">buttonWithType:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
</span><span class='line'>    <span class="n">buttonPause</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">BUTTON_WIDTH</span><span class="p">,</span> <span class="n">BUTTON_HEIGHT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">buttonPause</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">AUDIO_PAUSE</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonPause</span> <span class="nl">setTitle:</span><span class="s">@&quot;Pause&quot;</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonPause</span> <span class="nl">addTarget:</span><span class="n">self</span>
</span><span class='line'>                    <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">buttonTapped:</span><span class="p">)</span>
</span><span class='line'>          <span class="nl">forControlEvents:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">buttonPause</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//停止ボタン</span>
</span><span class='line'>    <span class="n">UIButton</span> <span class="o">*</span><span class="n">buttonStop</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nl">buttonWithType:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
</span><span class='line'>    <span class="n">buttonStop</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">BUTTON_WIDTH</span><span class="p">,</span> <span class="n">BUTTON_HEIGHT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">buttonStop</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">AUDIO_STOP</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonStop</span> <span class="nl">setTitle:</span><span class="s">@&quot;Stop&quot;</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonStop</span> <span class="nl">addTarget:</span><span class="n">self</span>
</span><span class='line'>                   <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">buttonTapped:</span><span class="p">)</span>
</span><span class='line'>         <span class="nl">forControlEvents:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">buttonStop</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ボリュームスライダー</span>
</span><span class='line'>    <span class="n">_audioVolumeSlider</span> <span class="o">=</span> <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">volumeControlSlider:</span><span class="n">self</span>
</span><span class='line'>                                                     <span class="nl">point:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span><span class='line'>                                              <span class="nl">defaultValue:</span><span class="mf">0.2f</span>
</span><span class='line'>                                                  <span class="nl">selector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">sliderValueChanged:</span><span class="p">)];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_audioVolumeSlider</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//オーディオボリューム変更</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sliderValueChanged:</span><span class="p">(</span><span class="n">UISlider</span> <span class="o">*</span><span class="p">)</span><span class="nv">slider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="nl">setVolume:</span><span class="n">slider</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UIViewにアニメーションを適用する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/30/objc-ui-view-animation-transition/"/>
    <updated>2013-07-30T23:15:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/30/objc-ui-view-animation-transition</id>
    <content type="html"><![CDATA[<p>Objective-Cで UIViewにアニメーション指定し実行するサンプルを以下に作成しました。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>サンプルダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-ui-view-animation-transition">https://github.com/masakihirokawa/objc-ui-view-animation-transition</a></li>
</ul>


<h2>アニメーションの種類</h2>

<table>
<thead>
<tr>
<th align="left">UIViewAnimationTransition </th>
<th align="left"> 説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">UIViewAnimationTransitionFlipFromLeft</td>
<td align="left">左から回転し裏返るアニメーション</td>
</tr>
<tr>
<td align="left">UIViewAnimationTransitionCurlDown</td>
<td align="left">下から捲れるアニメーション</td>
</tr>
</tbody>
</table>


<h2>ソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ANIMATION_FLIP_FROM_LEFT UIViewAnimationTransitionFlipFromLeft</span>
</span><span class='line'><span class="cp">#define ANIMATION_CURL_DOWN      UIViewAnimationTransitionCurlDown</span>
</span><span class='line'><span class="cp">#define ANIMATION_DURATION       0.75f</span>
</span><span class='line'><span class="cp">#define FRONT_IMAGE              @&quot;Hesychasm_640_1136.jpg&quot;</span>
</span><span class='line'><span class="cp">#define BACK_IMAGE               @&quot;Echidna_640_1136.jpg&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark start implementation for methods</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="k">enum</span> <span class="n">transitions</span> <span class="o">:</span> <span class="n">NSUInteger</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">viewForTransition</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span> <span class="n">transitions</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//次のビューをセット</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="p">[</span><span class="n">self</span> <span class="n">nextView</span><span class="p">]];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark responder</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesEnded:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="n">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//アニメーション実行中であれば処理しない</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">UIView</span> <span class="n">areAnimationsEnabled</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">nextResponder</span> <span class="nl">touchesEnded:</span><span class="n">touches</span> <span class="nl">withEvent:</span><span class="n">event</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">static</span> <span class="n">UIViewAnimationTransition</span> <span class="n">transition</span> <span class="o">=</span> <span class="n">ANIMATION_FLIP_FROM_LEFT</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//次のビューをセット</span>
</span><span class='line'>    <span class="n">UIView</span> <span class="o">*</span><span class="n">nextView</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">nextView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//アニメーション定義</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">beginAnimations:</span><span class="nb">nil</span> <span class="nl">context:</span><span class="nb">NULL</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationDelegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationDidStopSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">animationDidStop:</span><span class="p">)];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationDuration:</span><span class="n">ANIMATION_DURATION</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationTransition:</span><span class="n">transition</span> <span class="nl">forView:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">cache:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ビューの入れ替え</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">viewWithTag:</span><span class="n">viewForTransition</span><span class="p">]</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">nextView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//アニメーション実行</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="n">commitAnimations</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//アニメーションを無効にする</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationsEnabled:</span><span class="n">NO</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//次に実行されるアニメーションの種類変更</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">ANIMATION_CURL_DOWN</span> <span class="o">&lt;</span> <span class="o">++</span><span class="n">transition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">transition</span> <span class="o">=</span> <span class="n">ANIMATION_FLIP_FROM_LEFT</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark private methods</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">nextView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//表か裏の画像を指定</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">BOOL</span> <span class="n">isFront</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="n">isFront</span> <span class="o">?</span> <span class="n">FRONT_IMAGE</span> <span class="o">:</span> <span class="n">BACK_IMAGE</span><span class="p">];</span>
</span><span class='line'>    <span class="n">isFront</span> <span class="o">=</span> <span class="o">!</span><span class="n">isFront</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ビューに画像をセット</span>
</span><span class='line'>    <span class="n">UIView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">image</span><span class="p">];</span>
</span><span class='line'>    <span class="n">view</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">viewForTransition</span><span class="p">;</span>
</span><span class='line'>    <span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'>    <span class="n">view</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleWidth</span> <span class="o">|</span> <span class="n">UIViewAutoresizingFlexibleHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="n">view</span><span class="p">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="n">UIViewContentModeScaleAspectFill</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">view</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">animationDidStop:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">selector</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//アニメーションを有効にする</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIView</span> <span class="nl">setAnimationsEnabled:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UIImageにブレンドモードを指定して加工する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/25/objc-ui-image-blend-mode/"/>
    <updated>2013-07-25T12:09:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/25/objc-ui-image-blend-mode</id>
    <content type="html"><![CDATA[<p>Objective-Cで UIImageにブレンドモードを指定し表示するサンプルを以下に作成しました。</p>

<p>カメラアプリの実験用に Photoshopのように画像を重ねてブレンド表示する方法を色々試しましたので、以下に詳細を記載します。</p>

<h2>サンプルダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-ui-image-blend-mode">https://github.com/masakihirokawa/objc-ui-image-blend-mode</a></li>
</ul>


<h2>使用する画像</h2>

<p><img src="http://lab.dolice.net/images/article/blend_mode/Asymmetry_640_1136.jpg" title="元画像" alt="元画像" /></p>

<p><img src="http://lab.dolice.net/images/article/blend_mode/blend_image.png" title="重ねて表示する画像" alt="重ねて表示する画像" /></p>

<p><img src="http://lab.dolice.net/images/article/blend_mode/result.jpg" title="結果画像（ブレンドモード: スクリーン）" alt="結果画像（ブレンドモード: スクリーン）" /></p>

<h2>ブレンドモードの種類</h2>

<table>
<thead>
<tr>
<th align="left"> CGBlendMode </th>
<th align="left"> 説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">kCGBlendModeMultiply</td>
<td align="left">乗算</td>
</tr>
<tr>
<td align="left">kCGBlendModeScreen</td>
<td align="left">スクリーン</td>
</tr>
<tr>
<td align="left">kCGBlendModeOverlay</td>
<td align="left">オーバーレイ</td>
</tr>
<tr>
<td align="left">kCGBlendModeDarken</td>
<td align="left">比較（暗）</td>
</tr>
<tr>
<td align="left">kCGBlendModeLighten</td>
<td align="left">比較（明）</td>
</tr>
<tr>
<td align="left">kCGBlendModeColorDodge</td>
<td align="left">覆い焼きカラー</td>
</tr>
<tr>
<td align="left">kCGBlendModeColorBurn</td>
<td align="left">焼きこみカラー</td>
</tr>
<tr>
<td align="left">kCGBlendModeSoftLight</td>
<td align="left">ソフトライト</td>
</tr>
<tr>
<td align="left">kCGBlendModeHardLight</td>
<td align="left">ハードライト</td>
</tr>
<tr>
<td align="left">kCGBlendModeDifference</td>
<td align="left">差の絶対値</td>
</tr>
<tr>
<td align="left">kCGBlendModeExclusion</td>
<td align="left">除外</td>
</tr>
<tr>
<td align="left">kCGBlendModeHue</td>
<td align="left">色相</td>
</tr>
<tr>
<td align="left">kCGBlendModeSaturation</td>
<td align="left">彩度</td>
</tr>
<tr>
<td align="left">kCGBlendModeColor</td>
<td align="left">カラー</td>
</tr>
<tr>
<td align="left">kCGBlendModeLuminosity</td>
<td align="left">輝度</td>
</tr>
<tr>
<td align="left">kCGBlendModeClear</td>
<td align="left">透明色で描画</td>
</tr>
</tbody>
</table>


<h2>ソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define BACK_IMAGE              @&quot;blend_image.png&quot;</span>
</span><span class='line'><span class="cp">#define BACK_IMAGE_WIDTH        640</span>
</span><span class='line'><span class="cp">#define BACK_IMAGE_HEIGHT       1136</span>
</span><span class='line'><span class="cp">#define FRONT_IMAGE             @&quot;Asymmetry_640_1136.jpg&quot;</span>
</span><span class='line'><span class="cp">#define FRONT_IMAGE_WIDTH       640</span>
</span><span class='line'><span class="cp">#define FRONT_IMAGE_HEIGHT      1136</span>
</span><span class='line'><span class="cp">#define FRONT_IMAGE_ALPHA       1.0f</span>
</span><span class='line'><span class="cp">#define PREVIEW_IMAGE_WIDTH     80</span>
</span><span class='line'><span class="cp">#define PREVIEW_IMAGE_HEIGHT    142</span>
</span><span class='line'><span class="cp">#define BLEND_MODE_LABEL_HEIGHT 20</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">BlendMode</span> : <span class="nc">UIView</span> <span class="p">{</span>
</span><span class='line'><span class="k">@private</span>
</span><span class='line'>    <span class="n">UIImage</span>     <span class="o">*</span><span class="n">frontImage_</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UIImage</span>     <span class="o">*</span><span class="n">backImage_</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGBlendMode</span> <span class="n">blendMode_</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">CGBlendMode</span> <span class="n">blendMode</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">changeMode</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span> <span class="p">{</span>
</span><span class='line'><span class="k">@private</span>
</span><span class='line'>    <span class="n">BlendMode</span> <span class="o">*</span><span class="n">blendMode_</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UILabel</span>   <span class="o">*</span><span class="n">blendModeLabel_</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">BlendMode</span>
</span><span class='line'>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">blendMode</span> <span class="o">=</span> <span class="n">blendMode_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">backImage_</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="n">BACK_IMAGE</span><span class="p">];</span>
</span><span class='line'>        <span class="n">frontImage_</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="n">FRONT_IMAGE</span><span class="p">];</span>
</span><span class='line'>        <span class="n">CGRect</span> <span class="n">newFrame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
</span><span class='line'>        <span class="n">newFrame</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">frontImage_</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">newFrame</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">backImage_</span> <span class="nl">drawInRect:</span><span class="n">rect</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">frontImage_</span> <span class="nl">drawInRect:</span><span class="n">rect</span> <span class="nl">blendMode:</span><span class="n">blendMode_</span> <span class="nl">alpha:</span><span class="n">FRONT_IMAGE_ALPHA</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">changeMode</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">kCGBlendModeLuminosity</span> <span class="o">&lt;</span> <span class="o">++</span><span class="n">blendMode_</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">blendMode_</span> <span class="o">=</span> <span class="n">kCGBlendModeNormal</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark private methods definition</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">changeLabel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark start implementation for methods</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//初期化</span>
</span><span class='line'>    <span class="n">blendMode_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">BlendMode</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">blendMode_</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">center</span><span class="p">;</span>
</span><span class='line'>    <span class="n">blendMode_</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleTopMargin</span> <span class="o">|</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleBottomMargin</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">blendMode_</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//重ねて表示するイメージ表示</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageBack</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="n">BACK_IMAGE</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImageView</span> <span class="o">*</span><span class="n">imageViewBack</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">imageBack</span><span class="p">];</span>
</span><span class='line'>    <span class="n">imageViewBack</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BACK_IMAGE_WIDTH</span><span class="p">,</span> <span class="n">BACK_IMAGE_HEIGHT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">imageViewBack</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleLeftMargin</span> <span class="o">|</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleRightMargin</span> <span class="o">|</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleTopMargin</span> <span class="o">|</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleBottomMargin</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">imageViewBack</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//プレビューイメージ表示</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageFront</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="n">FRONT_IMAGE</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImageView</span> <span class="o">*</span><span class="n">imageViewFront</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">imageFront</span><span class="p">];</span>
</span><span class='line'>    <span class="n">imageViewFront</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">320</span> <span class="o">-</span> <span class="n">PREVIEW_IMAGE_WIDTH</span><span class="p">,</span>
</span><span class='line'>                                      <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>                                      <span class="n">PREVIEW_IMAGE_WIDTH</span><span class="p">,</span>
</span><span class='line'>                                      <span class="n">PREVIEW_IMAGE_HEIGHT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">imageViewFront</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span> <span class="n">imageViewFront</span><span class="p">.</span><span class="n">autoresizingMask</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">imageViewFront</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ブレンドモードを変更するラベル表示</span>
</span><span class='line'>    <span class="n">blendModeLabel_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
</span><span class='line'>                                       <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">BLEND_MODE_LABEL_HEIGHT</span><span class="p">,</span>
</span><span class='line'>                                       <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
</span><span class='line'>                                       <span class="n">BLEND_MODE_LABEL_HEIGHT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleTopMargin</span> <span class="o">|</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleBottomMargin</span><span class="p">;</span>
</span><span class='line'>    <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="n">NSTextAlignmentCenter</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">blendModeLabel_</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ラベル変更</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">changeLabel</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark private methods</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">changeLabel</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">blendMode_</span><span class="p">.</span><span class="n">blendMode</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeMultiply:</span>        <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeMultiply&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>        <span class="cm">/* 乗算 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeScreen:</span>          <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeScreen&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>          <span class="cm">/* スクリーン */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeOverlay:</span>         <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeOverlay&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>         <span class="cm">/* オーバーレイ */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeDarken:</span>          <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeDarken&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>          <span class="cm">/* 比較（暗） */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeLighten:</span>         <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeLighten&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>         <span class="cm">/* 比較（明） */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeColorDodge:</span>      <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeColorDodge&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>      <span class="cm">/* 覆い焼きカラー */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeColorBurn:</span>       <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeColorBurn&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>       <span class="cm">/* 焼きこみカラー */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeSoftLight:</span>       <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeSoftLight&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>       <span class="cm">/* ソフトライト */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeHardLight:</span>       <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeHardLight&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>       <span class="cm">/* ハードライト */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeDifference:</span>      <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeDifference&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>      <span class="cm">/* 差の絶対値 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeExclusion:</span>       <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeExclusion&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>       <span class="cm">/* 除外 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeHue:</span>             <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeHue&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>             <span class="cm">/* 色相 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeSaturation:</span>      <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeSaturation&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>      <span class="cm">/* 彩度 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeColor:</span>           <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeColor&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>           <span class="cm">/* カラー */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeLuminosity:</span>      <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeLuminosity&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>      <span class="cm">/* 輝度 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeClear:</span>           <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeClear&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>           <span class="cm">/* 透明色で描画 */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeCopy:</span>            <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeCopy&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>            <span class="cm">/* コピー */</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeSourceIn:</span>        <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeSourceIn&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeSourceOut:</span>       <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeSourceOut&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeSourceAtop:</span>      <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeSourceAtop&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeDestinationOver:</span> <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeDestinationOver&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeDestinationIn:</span>   <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeDestinationIn&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeDestinationOut:</span>  <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeDestinationOut&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeDestinationAtop:</span> <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeDestinationAtop&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModeXOR:</span>             <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeXOR&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModePlusDarker:</span>      <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModePlusDarker&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">kCGBlendModePlusLighter:</span>     <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModePlusLighter&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>                          <span class="n">blendModeLabel_</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;kCGBlendModeNormal&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark responder</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesEnded:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="n">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//ブレンドモード変更</span>
</span><span class='line'>    <span class="p">[</span><span class="n">blendMode_</span> <span class="n">changeMode</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ラベルの変更</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">changeLabel</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ブレンド実行</span>
</span><span class='line'>    <span class="p">[</span><span class="n">blendMode_</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UIImageを画面に直接描画する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/25/objc-ui-image-draw-in-rect/"/>
    <updated>2013-07-25T00:19:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/25/objc-ui-image-draw-in-rect</id>
    <content type="html"><![CDATA[<p>Objective-Cで UIImageに画像を読み込み、UIImageViewを通さずに画面に直接描画するサンプルを以下に作成しました。</p>

<p>サンプルでは、DrawImageというカスタムクラスを使用し画像を描画しています。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-ui-image-draw-in-rect">https://github.com/masakihirokawa/objc-ui-image-draw-in-rect</a></li>
</ul>


<h2>ソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DrawImage</span> : <span class="nc">UIView</span> <span class="p">{</span>
</span><span class='line'><span class="k">@private</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">image_</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithImage:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="n">image</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DrawImage</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithImage:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">image</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">((</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">image_</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">image_</span> <span class="nl">drawInRect:</span><span class="n">rect</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//画像ファイルの読み込み</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;Frigg_640_1136.jpg&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//画像ファイルの表示</span>
</span><span class='line'>    <span class="n">DrawImage</span> <span class="o">*</span><span class="n">myImage</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DrawImage</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">image</span><span class="p">];</span>
</span><span class='line'>    <span class="n">myImage</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'>    <span class="n">myImage</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleWidth</span> <span class="o">|</span> <span class="n">UIViewAutoresizingFlexibleHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">myImage</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Objective-Cのプロパティで指定可能なオプション]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/24/objc-property-option/"/>
    <updated>2013-07-24T23:49:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/24/objc-property-option</id>
    <content type="html"><![CDATA[<p>Objective-Cの @property宣言で指定可能なオプションを以下に列記します。</p>

<h2>オプション一覧</h2>

<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"> タイプ </th>
<th align="left"> オプション </th>
<th> 説明 </th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"></td>
<td align="left"> メソッド名       </td>
<td align="left"> getter=ゲッタ名 </td>
<td>     ゲッタメソッドの名前を明示的に指定する</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> setter=セッタ名 </td>
<td> セッタメソッドの名前を明示的に指定する</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"> 読み書き属性 </td>
<td align="left"> readonly </td>
<td> 読み取りのみ</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> readwrite </td>
<td> 読み書き可能</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"> 値の設定方法 </td>
<td align="left"> assign </td>
<td> 代入によって値を設定（規定値）</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> retain </td>
<td> オブジェクトを保持するよう設定</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> unsafe_unretained </td>
<td> assignと同じ（ARC用）</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> strong </td>
<td> retainと同じ（ARC用）</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> weak </td>
<td> 弱い参照</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"> copy </td>
<td> オブジェクトをコピーするよう設定</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"> アトミック性 </td>
<td align="left"> nonatomic </td>
<td> 排他的に実行されないメソッド</td>
</tr>
</tbody>
</table>


<h2>使用例</h2>

<p>例えばセッタメソッドを宣言する場合は下記のように指定します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">setter</span><span class="o">=</span><span class="nl">setValue:</span><span class="p">)</span> <span class="kt">int</span> <span class="n">myValue</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>オブジェクトを保持するよう設定する場合は下記のように指定します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">)</span> <span class="kt">int</span> <span class="n">myValue</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>2つの属性を指定する場合はカンマで区切って列挙します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">int</span> <span class="n">myValue</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AVAudioPlayerを使用した曲の再生/停止/ボリューム調節サンプル]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/14/objc-av-audio-player/"/>
    <updated>2013-07-14T21:03:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/14/objc-av-audio-player</id>
    <content type="html"><![CDATA[<p><img src="http://lab.dolice.net/images/article/av-audio-player.png" alt="" /></p>

<p>AVAudioPlayerを使用しオーディオの再生/停止/ボリューム調節を行うサンプルを以下に作成しました。</p>

<p>AVFoundationフレームワークが必要になります。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-av-audio-player">https://github.com/masakihirokawa/objc-av-audio-player</a></li>
</ul>


<h2>使用方法</h2>

<h3>初期化</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSBundle</span> <span class="o">*</span><span class="n">mainBundle</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">];</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">mainBundle</span> <span class="nl">pathForResource:</span><span class="n">AUDIO_RESOURCE_FILE_NAME</span>
</span><span class='line'>                                          <span class="nl">ofType:</span><span class="n">AUDIO_RESOURCE_FILE_EXT</span><span class="p">];</span>
</span><span class='line'><span class="n">NSURL</span> <span class="o">*</span><span class="n">fileUrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">fileURLWithPath:</span><span class="n">filePath</span><span class="p">];</span>
</span><span class='line'><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'><span class="n">AVAudioPlayer</span> <span class="o">*</span><span class="n">audioPlayer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioPlayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithContentsOfURL:</span><span class="n">fileUrl</span>
</span><span class='line'>                                                                    <span class="nl">error:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>再生</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">play</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>一時停止</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">pause</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>停止</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">stop</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;AVFoundation/AVFoundation.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define AUDIO_RESOURCE_FILE_NAME @&quot;o-magne&quot;</span>
</span><span class='line'><span class="cp">#define AUDIO_RESOURCE_FILE_EXT  @&quot;mp3&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">AVAudioPlayer</span> <span class="o">*</span><span class="n">audioPlayer</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="n">UISlider</span>      <span class="o">*</span><span class="n">audioVolumeSlider</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="k">enum</span> <span class="n">audioPlayButtonEvent</span> <span class="o">:</span> <span class="n">NSInteger</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">AUDIO_PLAY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AUDIO_STOP</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'><span class="p">}</span> <span class="n">audioPlayButtonEvent</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//オーディオプレイヤー初期化</span>
</span><span class='line'>    <span class="n">NSBundle</span> <span class="o">*</span><span class="n">mainBundle</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">mainBundle</span> <span class="nl">pathForResource:</span><span class="n">AUDIO_RESOURCE_FILE_NAME</span>
</span><span class='line'>                                              <span class="nl">ofType:</span><span class="n">AUDIO_RESOURCE_FILE_EXT</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSURL</span> <span class="o">*</span><span class="n">fileUrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">fileURLWithPath:</span><span class="n">filePath</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="n">AVAudioPlayer</span> <span class="o">*</span><span class="n">audioPlayer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioPlayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithContentsOfURL:</span><span class="n">fileUrl</span>
</span><span class='line'>                                                                        <span class="nl">error:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//エラーであれば処理しない</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//バッファを保持</span>
</span><span class='line'>    <span class="p">[</span><span class="n">audioPlayer</span> <span class="n">prepareToPlay</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ボタンとスライダーをセット</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">setButtonsAndSlider</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//オーディオプレイヤー保持</span>
</span><span class='line'>    <span class="n">_audioPlayer</span> <span class="o">=</span> <span class="n">audioPlayer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//再生/停止ボタンイベント</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">buttonTapped:</span><span class="p">(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">button</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">button</span><span class="p">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">AUDIO_PLAY</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kt">float</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">_audioVolumeSlider</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span><span class='line'>        <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>        <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">play</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">button</span><span class="p">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">AUDIO_STOP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_audioPlayer</span> <span class="n">pause</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//オーディオボリューム変更</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sliderValueChanged:</span><span class="p">(</span><span class="n">UISlider</span> <span class="o">*</span><span class="p">)</span><span class="nv">slider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_audioPlayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_audioPlayer</span><span class="p">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">slider</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//ボタンとスライダーの表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setButtonsAndSlider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//再生ボタン</span>
</span><span class='line'>    <span class="n">UIButton</span> <span class="o">*</span><span class="n">buttonPlay</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nl">buttonWithType:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
</span><span class='line'>    <span class="n">buttonPlay</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</span><span class='line'>    <span class="n">buttonPlay</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">AUDIO_PLAY</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonPlay</span> <span class="nl">setTitle:</span><span class="s">@&quot;Play&quot;</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonPlay</span> <span class="nl">addTarget:</span><span class="n">self</span>
</span><span class='line'>                   <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">buttonTapped:</span><span class="p">)</span>
</span><span class='line'>         <span class="nl">forControlEvents:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">buttonPlay</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//停止ボタン</span>
</span><span class='line'>    <span class="n">UIButton</span> <span class="o">*</span><span class="n">buttonStop</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nl">buttonWithType:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
</span><span class='line'>    <span class="n">buttonStop</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">170</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</span><span class='line'>    <span class="n">buttonStop</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">AUDIO_STOP</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonStop</span> <span class="nl">setTitle:</span><span class="s">@&quot;Stop&quot;</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">buttonStop</span> <span class="nl">addTarget:</span><span class="n">self</span>
</span><span class='line'>                   <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">buttonTapped:</span><span class="p">)</span>
</span><span class='line'>         <span class="nl">forControlEvents:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">buttonStop</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//ボリュームスライダー</span>
</span><span class='line'>    <span class="n">UISlider</span> <span class="o">*</span><span class="n">audioVolumeSlider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UISlider</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>
</span><span class='line'>    <span class="n">audioVolumeSlider</span><span class="p">.</span><span class="n">minimumValue</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span><span class='line'>    <span class="n">audioVolumeSlider</span><span class="p">.</span><span class="n">maximumValue</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
</span><span class='line'>    <span class="n">audioVolumeSlider</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="p">;</span>
</span><span class='line'>    <span class="n">_audioVolumeSlider</span> <span class="o">=</span> <span class="n">audioVolumeSlider</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_audioVolumeSlider</span> <span class="nl">addTarget:</span><span class="n">self</span>
</span><span class='line'>                           <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">sliderValueChanged:</span><span class="p">)</span>
</span><span class='line'>                 <span class="nl">forControlEvents:</span><span class="n">UIControlEventValueChanged</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_audioVolumeSlider</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[カメラで撮った写真に画像をオーバーレイする方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/07/objc-ui-image-picker-control-camera-overlay/"/>
    <updated>2013-07-07T10:56:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/07/objc-ui-image-picker-control-camera-overlay</id>
    <content type="html"><![CDATA[<p><img src="http://lab.dolice.net/images/article/ui-image-picker-control-camera-overlay.jpg" alt="" /></p>

<p>カメラで撮った写真に画像をオーバーレイするサンプルを以下に作成しました。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-ui-image-picker-control-camera-overlay">https://github.com/masakihirokawa/objc-ui-image-picker-control-camera-overlay</a></li>
</ul>


<h2>ソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">CameraOverlayView</span> : <span class="nc">UIImageView</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">UIImagePickerController</span> <span class="o">*</span><span class="n">pickerController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span> <span class="o">&lt;</span><span class="n">UIActionSheetDelegate</span><span class="p">,</span> <span class="n">UINavigationControllerDelegate</span><span class="p">,</span> <span class="n">UIImagePickerControllerDelegate</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nl">cameraButtonEvent:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark CameraOverlayView</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">CameraOverlayView</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesEnded:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="n">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">pickerController</span> <span class="n">takePicture</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">UIImagePickerController</span> <span class="o">*</span><span class="n">pickerController</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="n">UIImageView</span> <span class="o">*</span><span class="n">imageView</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//撮影画像を表示するイメージビュー配置</span>
</span><span class='line'>    <span class="n">_imageView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">_imageView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'>    <span class="n">_imageView</span><span class="p">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="n">UIViewContentModeScaleAspectFit</span><span class="p">;</span>
</span><span class='line'>    <span class="n">_imageView</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">UIViewAutoresizingFlexibleWidth</span> <span class="o">|</span> <span class="n">UIViewAutoresizingFlexibleHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_imageView</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//カメラボタンを押した時のイベント</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">cameraButtonEvent:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">UIImagePickerController</span> <span class="nl">isSourceTypeAvailable:</span><span class="n">UIImagePickerControllerSourceTypeCamera</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//カメラが有効であれば撮影モードに入る</span>
</span><span class='line'>        <span class="n">UIImagePickerController</span> <span class="o">*</span><span class="n">picker</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImagePickerController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="n">picker</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>        <span class="n">picker</span><span class="p">.</span><span class="n">sourceType</span> <span class="o">=</span> <span class="n">UIImagePickerControllerSourceTypeCamera</span><span class="p">;</span>
</span><span class='line'>        <span class="n">picker</span><span class="p">.</span><span class="n">showsCameraControls</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>        <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;scope.png&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="n">CameraOverlayView</span> <span class="o">*</span><span class="n">overlayView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CameraOverlayView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">image</span><span class="p">];</span>
</span><span class='line'>        <span class="n">overlayView</span><span class="p">.</span><span class="n">pickerController</span> <span class="o">=</span> <span class="n">picker</span><span class="p">;</span>
</span><span class='line'>        <span class="n">overlayView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">picker</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'>        <span class="n">overlayView</span><span class="p">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="n">UIViewContentModeScaleAspectFill</span><span class="p">;</span>
</span><span class='line'>        <span class="n">overlayView</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">UIViewAutoresizingFlexibleWidth</span> <span class="o">|</span> <span class="n">UIViewAutoresizingFlexibleHeight</span><span class="p">;</span>
</span><span class='line'>        <span class="n">overlayView</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span><span class='line'>        <span class="n">overlayView</span><span class="p">.</span><span class="n">userInteractionEnabled</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>        <span class="n">picker</span><span class="p">.</span><span class="n">cameraOverlayView</span> <span class="o">=</span> <span class="n">overlayView</span><span class="p">;</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">presentViewController:</span><span class="n">picker</span> <span class="nl">animated:</span><span class="n">YES</span> <span class="nl">completion:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//カメラが無効であればエラーログを出力する</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;UIImagePickerController is not available.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//選択/撮影した写真を取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">imagePickerController:</span><span class="p">(</span><span class="n">UIImagePickerController</span><span class="o">*</span><span class="p">)</span><span class="nv">picker</span>
</span><span class='line'><span class="nf">didFinishPickingMediaWithInfo:</span><span class="p">(</span><span class="n">NSDictionary</span><span class="o">*</span><span class="p">)</span><span class="nv">info</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span> <span class="nl">objectForKey:</span><span class="n">UIImagePickerControllerEditedImage</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span> <span class="nl">objectForKey:</span><span class="n">UIImagePickerControllerOriginalImage</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">_imageView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">dismissViewControllerAnimated:</span><span class="n">YES</span> <span class="nl">completion:</span><span class="nb">NULL</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[スライダーのデザインをカスタマイズする方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/06/objc-ui-slider-thumb-image/"/>
    <updated>2013-07-06T11:46:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/06/objc-ui-slider-thumb-image</id>
    <content type="html"><![CDATA[<p><img src="http://lab.dolice.net/images/article/custom_slider.png" title="UISliderのデザインカスタマイズサンプル" alt="UISliderのデザインカスタマイズサンプル" /></p>

<p>UISliderのデザインをカスタマイズするサンプルを以下に作成しました。</p>

<p>サンプルでは、スライダーの掴み部分、左側部分、右側部分の画像を指定しています。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-slider-thumb-image">https://github.com/masakihirokawa/objc-slider-thumb-image</a></li>
</ul>


<h2>ソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setCustomSlider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//スライダー初期化</span>
</span><span class='line'>    <span class="n">UISlider</span> <span class="o">*</span><span class="n">slider</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UISlider</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">slider</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</span><span class='line'>    <span class="n">slider</span><span class="p">.</span><span class="n">minimumValue</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">slider</span><span class="p">.</span><span class="n">maximumValue</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">slider</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span><span class='line'>    <span class="n">slider</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">center</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スライダーのデザインをカスタマイズ</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageForThumb</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;slider_thumb.png&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageMinBase</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;slider_left.png&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageForMin</span> <span class="o">=</span> <span class="p">[</span><span class="n">imageMinBase</span> <span class="nl">stretchableImageWithLeftCapWidth:</span><span class="mi">4</span> <span class="nl">topCapHeight:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageMaxBase</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;slider_right.png&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageForMax</span> <span class="o">=</span> <span class="p">[</span><span class="n">imageMaxBase</span> <span class="nl">stretchableImageWithLeftCapWidth:</span><span class="mi">4</span> <span class="nl">topCapHeight:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">slider</span> <span class="nl">setThumbImage:</span><span class="n">imageForThumb</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">slider</span> <span class="nl">setThumbImage:</span><span class="n">imageForThumb</span> <span class="nl">forState:</span><span class="n">UIControlStateHighlighted</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">slider</span> <span class="nl">setMinimumTrackImage:</span><span class="n">imageForMin</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">slider</span> <span class="nl">setMaximumTrackImage:</span><span class="n">imageForMax</span> <span class="nl">forState:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スライダーを画面に追加</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">slider</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[スクロールビューの中を拡大縮小する方法]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/06/objc-ui-scroll-view-zooming/"/>
    <updated>2013-07-06T10:35:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/06/objc-ui-scroll-view-zooming</id>
    <content type="html"><![CDATA[<p>UIScrollViewの中を拡大縮小するサンプルを以下に作成しました。</p>

<p>サンプルでは、ズームの最小値を 0.1倍、最大値を3倍に指定しています。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-ui-scroll-view-zooming">https://github.com/masakihirokawa/objc-ui-scroll-view-zooming</a></li>
</ul>


<h2>ソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setScrollView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//スクロールビューの初期化</span>
</span><span class='line'>    <span class="n">UIScrollView</span> <span class="o">*</span><span class="n">scrollView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScrollView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">scrollView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'>    <span class="n">scrollView</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span> <span class="n">UIViewAutoresizingFlexibleWidth</span> <span class="o">|</span> <span class="n">UIViewAutoresizingFlexibleHeight</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スクロールビューに画像を設定</span>
</span><span class='line'>    <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;Pandora_640_1136.jpg&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UIImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">image</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">scrollView</span> <span class="nl">addSubview:</span><span class="n">imageView</span><span class="p">];</span>
</span><span class='line'>    <span class="n">scrollView</span><span class="p">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="n">imageView</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//スクロールビューを画面に貼り付け</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">scrollView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//拡大/縮小対応</span>
</span><span class='line'>    <span class="n">scrollView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">self</span><span class="p">;</span>
</span><span class='line'>    <span class="n">scrollView</span><span class="p">.</span><span class="n">minimumZoomScale</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">scrollView</span><span class="p">.</span><span class="n">maximumZoomScale</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//拡大/縮小対応</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">viewForZoomingInScrollView:</span><span class="p">(</span><span class="n">UIScrollView</span> <span class="o">*</span><span class="p">)</span><span class="nv">scrollView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">id</span> <span class="n">subview</span> <span class="k">in</span> <span class="n">scrollView</span><span class="p">.</span><span class="n">subviews</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">([</span><span class="n">subview</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">UIImageView</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">subview</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[アプリケーションバッジを表示する]]></title>
    <link href="http://lab.dolice.net/blog/2013/07/03/objc-application-icon-badge-number/"/>
    <updated>2013-07-03T11:53:00+09:00</updated>
    <id>http://lab.dolice.net/blog/2013/07/03/objc-application-icon-badge-number</id>
    <content type="html"><![CDATA[<p>ホーム画面のアプリアイコンにアプリケーションバッジを表示するサンプルを以下に作成しました。</p>

<p>サンプルの「Add」ボタンを押すとアプリケーションバッジが増え、「Reset」ボタンを押すとアプリケーションバッジが消えます。</p>

<p>下記よりサンプルのダウンロードが行えます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-application-badge-number">https://github.com/masakihirokawa/objc-application-badge-number</a></li>
</ul>


<h2>ソースコード</h2>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">NSInteger</span> <span class="n">applicationBadgeNum</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//アプリケーションバッジ初期化</span>
</span><span class='line'>    <span class="n">_applicationBadgeNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アプリケーションバッジを増やす</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">addApplicationBadgeEvent:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">_applicationBadgeNum</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">].</span><span class="n">applicationIconBadgeNumber</span> <span class="o">=</span> <span class="n">_applicationBadgeNum</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//アプリケーションバッジ削除</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">resetApplicationBadgeEvent:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">_applicationBadgeNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">].</span><span class="n">applicationIconBadgeNumber</span> <span class="o">=</span> <span class="n">_applicationBadgeNum</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
