<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[廣川政樹の開発ブログ - Dolice Lab]]></title>
  <link href="https://lab.dolice.net/atom.xml" rel="self"/>
  <link href="https://lab.dolice.net/"/>
  <updated>2020-10-29T10:50:04+09:00</updated>
  <id>https://lab.dolice.net/</id>
  <author>
    <name><![CDATA[Masaki Hirokawa]]></name>
    <email><![CDATA[info@dolice.net]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iOSアプリでローカルプッシュ通知を使用する]]></title>
    <link href="https://lab.dolice.net/blog/2020/07/10/objc-local-notification/"/>
    <updated>2020-07-10T12:31:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2020/07/10/objc-local-notification</id>
    <content type="html"><![CDATA[<p>iOSアプリで指定した時刻にローカルプッシュ通知を送信する手順を以下に記載します。</p>

<p>下記よりサンプルをダウンロード出来ますので、実装の際のお役に立てば幸いです。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-local-notification">https://github.com/masakihirokawa/objc-local-notification</a></li>
</ul>


<h2>使用手順</h2>

<h3>1. Frameworkの追加</h3>

<p>今回のサンプルは iOS 10以降を対象としていますので、<em>UserNotifications.framework</em>をプロジェクトに追加します。</p>

<h3>2. プッシュ通知の許可をユーザーに求める</h3>

<p>ローカルプッシュ通知の送信には、アプリ起動時にユーザーに対しプッシュ通知の受信許可を求める必要があります。</p>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">UserNotifications</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// アプリ起動時の処理</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// ユーザーにプッシュ通知の許可を求める</span>
</span><span class='line'>    <span class="n">UNUserNotificationCenter</span> <span class="o">*</span><span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNUserNotificationCenter</span> <span class="n">currentNotificationCenter</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">center</span> <span class="nl">requestAuthorizationWithOptions:</span><span class="p">(</span><span class="n">UNAuthorizationOptionBadge</span> <span class="o">|</span> <span class="n">UNAuthorizationOptionSound</span> <span class="o">|</span> <span class="n">UNAuthorizationOptionAlert</span><span class="p">)</span>
</span><span class='line'>                          <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">granted</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Succeeded!&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. ローカルプッシュ通知管理クラスの作成</h3>

<p>今回のサンプルでは、指定した時刻にローカルプッシュ通知を送信するよう実装しています。</p>

<h4>LocalNotificationManager.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">UserNotifications</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">NS_ASSUME_NONNULL_BEGIN</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">LocalNotificationManager</span> : <span class="nc">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSCalendar</span> <span class="o">*</span><span class="n">calendar</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSDate</span>     <span class="o">*</span><span class="n">nowDate</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">scheduleLocalNotifications:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">notificationHours</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="n">NS_ASSUME_NONNULL_END</span>
</span></code></pre></td></tr></table></div></figure>


<h4>LocalNotificationManager.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;LocalNotificationManager.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">LocalNotificationManager</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Scheduler</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ローカルプッシュ通知のスケジューリング</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">scheduleLocalNotifications:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">notificationHours</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// 通知を全てキャンセルする</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">UNUserNotificationCenter</span> <span class="n">currentNotificationCenter</span><span class="p">]</span> <span class="n">removeAllPendingNotificationRequests</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 通知時間を設定する</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">[</span><span class="n">notificationHours</span> <span class="n">count</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 通知時間保持</span>
</span><span class='line'>        <span class="n">NSUInteger</span> <span class="n">notificationHour</span> <span class="o">=</span> <span class="p">[</span><span class="n">notificationHours</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="n">intValue</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// カレンダー初期化</span>
</span><span class='line'>        <span class="n">_calendar</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSCalendar</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithCalendarIdentifier:</span><span class="n">NSCalendarIdentifierGregorian</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 現在の日付取得</span>
</span><span class='line'>        <span class="n">_nowDate</span>  <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// コンポーネント初期化</span>
</span><span class='line'>        <span class="n">NSDateComponents</span> <span class="o">*</span><span class="n">fireDateComponents</span> <span class="o">=</span> <span class="p">[</span><span class="n">_calendar</span> <span class="nl">components:</span><span class="p">(</span><span class="n">NSCalendarUnitHour</span> <span class="o">|</span>
</span><span class='line'>                                                                      <span class="n">NSCalendarUnitMinute</span> <span class="o">|</span>
</span><span class='line'>                                                                      <span class="n">NSCalendarUnitSecond</span><span class="p">)</span>
</span><span class='line'>                                                            <span class="nl">fromDate:</span><span class="n">_nowDate</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// コンポーネントに通知時間を指定</span>
</span><span class='line'>        <span class="p">[</span><span class="n">fireDateComponents</span> <span class="nl">setHour:</span><span class="n">notificationHour</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">fireDateComponents</span> <span class="nl">setMinute:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">fireDateComponents</span> <span class="nl">setSecond:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">fireDateComponents</span> <span class="nl">setTimeZone:</span><span class="p">[</span><span class="n">NSTimeZone</span> <span class="n">systemTimeZone</span><span class="p">]];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ローカル通知のスケジュール呼び出し</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">makeNotification:</span><span class="n">fireDateComponents</span> <span class="nl">notificationHour:</span><span class="n">notificationHour</span> <span class="nl">userInfo:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ローカルプッシュ通知生成</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">makeNotification:</span><span class="p">(</span><span class="n">NSDateComponents</span> <span class="o">*</span><span class="p">)</span><span class="nv">fireDateComponents</span> <span class="nf">notificationHour:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">notificationHour</span> <span class="nf">userInfo:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">userInfo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// デバッグ出力</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;fireDateComponents: %@&quot;, fireDateComponents);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ローカルプッシュ通知のスケジューリング</span>
</span><span class='line'>    <span class="n">UNMutableNotificationContent</span><span class="o">*</span> <span class="n">content</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UNMutableNotificationContent</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">content</span><span class="p">.</span><span class="n">title</span>    <span class="o">=</span> <span class="s">@&quot;It&#39;s time to go.&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">content</span><span class="p">.</span><span class="n">body</span>     <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;t&#39;s now %lu:00.&quot;</span><span class="p">,</span> <span class="n">notificationHour</span><span class="p">];</span>
</span><span class='line'>    <span class="n">content</span><span class="p">.</span><span class="n">sound</span>    <span class="o">=</span> <span class="p">[</span><span class="n">UNNotificationSound</span> <span class="n">defaultSound</span><span class="p">];</span>
</span><span class='line'>    <span class="n">content</span><span class="p">.</span><span class="n">badge</span>    <span class="o">=</span> <span class="err">@</span><span class="p">([[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="n">applicationIconBadgeNumber</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="n">content</span><span class="p">.</span><span class="n">userInfo</span> <span class="o">=</span> <span class="n">userInfo</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">UNCalendarNotificationTrigger</span> <span class="o">*</span><span class="n">trigger</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNCalendarNotificationTrigger</span>
</span><span class='line'>                                              <span class="nl">triggerWithDateMatchingComponents:</span><span class="n">fireDateComponents</span> <span class="nl">repeats:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">notificationIdentifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;NotificationHour: %lu&quot;</span><span class="p">,</span> <span class="n">notificationHour</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">UNNotificationRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNNotificationRequest</span>
</span><span class='line'>                                      <span class="nl">requestWithIdentifier:</span><span class="n">notificationIdentifier</span> <span class="nl">content:</span><span class="n">content</span> <span class="nl">trigger:</span><span class="n">trigger</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">UNUserNotificationCenter</span> <span class="o">*</span><span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">UNUserNotificationCenter</span> <span class="n">currentNotificationCenter</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">center</span> <span class="nl">addNotificationRequest:</span><span class="n">request</span> <span class="nl">withCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. プッシュ通知の予約</h3>

<p>ユーザーがアプリを閉じたタイミングでプッシュ通知を予約します。今回は9時、12時、15時、18時にローカルプッシュ通知が送信されるよう指定しました。</p>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;LocalNotificationManager.h&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// アプリがバックグラウンドになった時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationDidEnterBackground:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// ローカルプッシュ通知を送信する時間を指定</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">notificationHours</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="err">@</span><span class="mi">9</span><span class="p">,</span> <span class="err">@</span><span class="mi">12</span><span class="p">,</span> <span class="err">@</span><span class="mi">15</span><span class="p">,</span> <span class="err">@</span><span class="mi">18</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// バックグラウンド移行時にプッシュ通知を設定</span>
</span><span class='line'>    <span class="n">LocalNotificationManager</span> <span class="o">*</span><span class="n">notificationManager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LocalNotificationManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">notificationManager</span> <span class="nl">scheduleLocalNotifications:</span><span class="n">notificationHours</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>e.x. アイコンバッジの削除</h3>

<p>このサンプルではプッシュ通知送信時にアイコンバッジを付与するよう指定していますので、アプリが起動されたらアイコンバッジを削除するようにします。</p>

<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// アプリがバックグラウンドからフォアグラウンドになる直前に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationWillEnterForeground:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// アイコンバッジ削除</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">setApplicationIconBadgeNumber:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上でローカルプッシュ通知の実装は完了になります。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AdMob動画リワード広告の導入手順]]></title>
    <link href="https://lab.dolice.net/blog/2020/07/09/objc-admob-rewarded-video-ads/"/>
    <updated>2020-07-09T16:19:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2020/07/09/objc-admob-rewarded-video-ads</id>
    <content type="html"><![CDATA[<p>iPhoneアプリに<a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>の動画リワード広告を表示するサンプルを作成しました。</p>

<p><a href="https://developers.google.com/admob/ios/rewarded-ads?hl=ja" title="公式リファレンス">公式リファレンス</a>を参考にさせていただきました。ご使用の際はアプリIDと広告枠IDを指定してください。</p>

<p>下記よりサンプルをダウンロード出来ますので、導入の際のお役に立てば幸いです。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-admob-rewarded-video-ads">https://github.com/masakihirokawa/objc-admob-rewarded-video-ads</a></li>
</ul>


<h2>導入準備</h2>

<h3>1. Info.plistの編集</h3>

<p><a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>のサイトからアプリIDを取得し、<em>Info.plist</em>に <em>GADApplicationIdentifier</em>の項目を追加し指定してください。</p>

<h3>2. 広告枠IDの保持</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">GAD_REWARD_UNIT_ID</span> <span class="o">=</span> <span class="s">@&quot;広告枠ID&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. アプリ起動時に初期化</h3>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">GoogleMobileAds</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// AdMobアプリID初期化</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">GADMobileAds</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">startWithCompletionHandler:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>動画リワード広告の読み込み</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">AdMobRewardedVideoAds</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">loadRewardedVideoAds:</span><span class="n">self</span> <span class="nl">usePersonalizedAds:</span><span class="n">YES</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>AdMobRewardedVideoAds.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">GoogleMobileAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">AdMobRewardedVideoAds</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">GADRewardedAdDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="n">isCompletePlaying</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GADRewardedAd</span>    <span class="o">*</span><span class="n">adMobRewardedAd</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">UIViewController</span> <span class="o">*</span><span class="n">rootViewController</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>             <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">UIActivityIndicatorView</span> <span class="o">*</span><span class="n">activityIndicator</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">UIView</span>                  <span class="o">*</span><span class="n">overlay</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>                    <span class="n">showOverlay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - enumerator</span>
</span><span class='line'><span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">,</span> <span class="n">activityIndicatorStyles</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">AI_GRAY</span>        <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AI_WHITE</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AI_WHITE_LARGE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadRewardedVideoAds:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">usePersonalizedAds:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>AdMobRewardedVideoAds.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;AdMobRewardedVideoAds.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">AdMobRewardedVideoAds</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">id</span> <span class="n">sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">@synchronized</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - AdMob Rewarded Video Ads</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// AdMob動画リワード広告広告読み込み</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadRewardedVideoAds:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">usePersonalizedAds:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">viewController</span> <span class="nl">isEqual:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">usePersonalizedAds</span> <span class="o">=</span> <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">adMobRewardedAd</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADRewardedAd</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdUnitID:</span><span class="n">GAD_TEST_MODE</span> <span class="o">?</span> <span class="n">GAD_REWARD_TEST_UNIT_ID</span> <span class="o">:</span> <span class="n">GAD_REWARD_UNIT_ID</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GADRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">GADRequest</span> <span class="n">request</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">GAD_TEST_MODE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">GADMobileAds</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="n">requestConfiguration</span><span class="p">].</span><span class="n">testDeviceIdentifiers</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="n">kGADSimulatorID</span><span class="p">,</span>
</span><span class='line'>                                                                                       <span class="s">@&quot;Test Device ID&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">usePersonalizedAds</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">GADExtras</span> <span class="o">*</span><span class="n">extras</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADExtras</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="n">extras</span><span class="p">.</span><span class="n">additionalParameters</span> <span class="o">=</span> <span class="err">@</span><span class="p">{</span><span class="s">@&quot;npa&quot;</span><span class="o">:</span> <span class="s">@&quot;1&quot;</span><span class="p">};</span>
</span><span class='line'>        <span class="p">[</span><span class="n">request</span> <span class="nl">registerAdNetworkExtras:</span><span class="n">extras</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;RewardedVideoAds -&gt; usePersonalizedAds: %d&quot;, self.usePersonalizedAds);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">adMobRewardedAd</span> <span class="nl">loadRequest:</span><span class="n">request</span> <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">GADRequestError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>          <span class="n">self</span><span class="o">-&gt;</span><span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'>          <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">//NSLog(@&quot;Reward based video ad is received.&quot;);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// 動画リワード広告表示</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">adMobRewardedAd</span><span class="p">.</span><span class="n">isReady</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">adMobRewardedAd</span> <span class="nl">presentFromRootViewController:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'>          <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// アクティビティインジケータのアニメーション開始</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">screenWidth</span>  <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">screenHeight</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">startActivityIndicator:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">center:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">screenWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">screenHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                         <span class="nl">styleId:</span><span class="n">AI_WHITE</span> <span class="nl">hidesWhenStopped:</span><span class="n">YES</span> <span class="nl">showOverlay:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// リワード提供</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">rewardedAd:</span><span class="p">(</span><span class="n">GADRewardedAd</span> <span class="o">*</span><span class="p">)</span><span class="nv">rewardedAd</span> <span class="nf">userDidEarnReward:</span><span class="p">(</span><span class="n">GADAdReward</span> <span class="o">*</span><span class="p">)</span><span class="nv">reward</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;rewardedAd:userDidEarnReward:&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: リワード提供</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを立てる</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 動画リワード広告が開かれた時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">rewardedAdDidPresent:</span><span class="p">(</span><span class="n">GADRewardedAd</span> <span class="o">*</span><span class="p">)</span><span class="nv">rewardedAd</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;rewardedAdDidPresent:&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 動画リワード広告がエラーで開かれなかった時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">rewardedAd:</span><span class="p">(</span><span class="n">GADRewardedAd</span> <span class="o">*</span><span class="p">)</span><span class="nv">rewardedAd</span> <span class="nf">didFailToPresentWithError:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;rewardedAd:didFailToPresentWithError&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 動画リワード広告が閉じられた時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">rewardedAdDidDismiss:</span><span class="p">(</span><span class="n">GADRewardedAd</span> <span class="o">*</span><span class="p">)</span><span class="nv">rewardedAd</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;rewardedAd:rewardedAdDidDismiss&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: 再生が完了していればお知らせアラート表示</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isCompletePlaying</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Activity Indicator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// アクティビティインジケーターのアニメーション開始</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startActivityIndicator:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span> <span class="nf">center:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">center</span> <span class="nf">styleId:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">styleId</span> <span class="nf">hidesWhenStopped:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidesWhenStopped</span> <span class="nf">showOverlay:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">showOverlay</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// インジケーター初期化</span>
</span><span class='line'>    <span class="n">_activityIndicator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIActivityIndicatorView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// スタイルを設定</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">styleId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_GRAY:</span>
</span><span class='line'>            <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleGray</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_WHITE:</span>
</span><span class='line'>            <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhite</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_WHITE_LARGE:</span>
</span><span class='line'>            <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// スタイルに応じて寸法変更</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">==</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 座標をセンターに指定</span>
</span><span class='line'>    <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 停止した時に隠れるよう設定</span>
</span><span class='line'>    <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">hidesWhenStopped</span> <span class="o">=</span> <span class="n">hidesWhenStopped</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// インジケーターアニメーション開始</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_activityIndicator</span> <span class="n">startAnimating</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// オーバーレイ表示フラグ保持</span>
</span><span class='line'>    <span class="n">_showOverlay</span> <span class="o">=</span> <span class="n">showOverlay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// オーバーレイ表示</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_showOverlay</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_overlay</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span><span class='line'>        <span class="n">_overlay</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nl">colorWithRed:</span><span class="mf">0.0</span> <span class="nl">green:</span><span class="mf">0.0</span> <span class="nl">blue:</span><span class="mf">0.0</span> <span class="nl">alpha:</span><span class="mf">0.5f</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_overlay</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 画面に追加</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_activityIndicator</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopActivityIndicator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_showOverlay</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_overlay</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_activityIndicator</span> <span class="n">stopAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>リワードの提供</h2>

<p>当方は動画リワード広告が最後まで再生されたら3日間広告を表示しないという設定にしています。</p>

<p>また、リワードが提供されたことをユーザーにお知らせするため、リワード期限日を文字列で取得できるようにしています。</p>

<p>まず下記のようにリワードを提供します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// 動画リワード広告再生完了時の処理</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">onCompleteRewardedVideoAds</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// 視聴済みフラグを立てる</span>
</span><span class='line'>    <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ユーザーデフォルト更新</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setBool:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="nl">forKey:</span><span class="n">UD_REWARDED_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// リワード受取日と期限日の保存</span>
</span><span class='line'>    <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardDateReceived</span>   <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardExpirationDate</span> <span class="o">=</span> <span class="p">[</span><span class="n">Common</span> <span class="n">rewardExpirationDate</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setObject:</span><span class="n">rewardDateReceived</span> <span class="nl">forKey:</span><span class="n">UD_REWARD_DATE_RECEIVED_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setObject:</span><span class="n">rewardExpirationDate</span> <span class="nl">forKey:</span><span class="n">UD_REWARD_EXPIRATION_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: バナー削除</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// リワード期限日の取得</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nf">rewardExpirationDate</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardDateReceived</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">rewardDateReceived</span> <span class="nl">initWithTimeInterval:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">rewardPeriod</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="nl">sinceDate:</span><span class="n">rewardDateReceived</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// リワード期限日を文字列で取得</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">rewardExpirationDateStr</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">dateFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSDateFormatter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">dateFormatter</span> <span class="nl">setLocale:</span><span class="p">[</span><span class="n">NSLocale</span> <span class="n">systemLocale</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">dateFormatter</span> <span class="nl">setDateFormat:</span><span class="s">@&quot;yyyy/MM/dd HH:mm:ss&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSDate</span>   <span class="o">*</span><span class="k">const</span> <span class="n">expirationDate</span>    <span class="o">=</span> <span class="p">[</span><span class="n">Common</span> <span class="n">rewardExpirationDate</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">expirationDateStr</span> <span class="o">=</span> <span class="p">[</span><span class="n">dateFormatter</span> <span class="nl">stringFromDate:</span><span class="n">expirationDate</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;（有効期限: %@）&quot;</span><span class="p">,</span> <span class="n">expirationDateStr</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>リワード期間中であるか判定</h2>

<p>アプリ起動時にリワード期間中であるか判定し、フラグを更新します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// リワード期間であれば期限切れであるか判定</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// リワード受取日とリワード期限日の取得</span>
</span><span class='line'>        <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardDateReceived</span>   <span class="o">=</span> <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">objectForKey:</span><span class="n">UD_REWARD_DATE_RECEIVED_KEY</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardExpirationDate</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">objectForKey:</span><span class="n">UD_REWARD_EXPIRATION_KEY</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 現在時刻がリワード期間であるか判定</span>
</span><span class='line'>        <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">now</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="o">=</span> <span class="p">[</span><span class="n">now</span> <span class="nl">compare:</span><span class="n">rewardDateReceived</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedDescending</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">now</span> <span class="nl">compare:</span><span class="n">rewardExpirationDate</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedAscending</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ユーザーデフォルト更新</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setBool:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="nl">forKey:</span><span class="n">UD_REWARDED_KEY</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上で動画リワード広告の実装は完了になります。</p>

<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-admob-banner-2020/" title="AdMobバナーを表示する「DCAdMobBanner」クラス（改訂版）">AdMobバナーを表示する「DCAdMobBanner」クラス（改訂版）</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AdMobバナーを表示する「DCAdMobBanner」クラス（改訂版）]]></title>
    <link href="https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-admob-banner-2020/"/>
    <updated>2020-07-09T15:24:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-admob-banner-2020</id>
    <content type="html"><![CDATA[<p>iPhoneアプリに<a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>のモバイルバナーを表示する「<a href="https://github.com/masakihirokawa/objc-classes-dc-admob-banner-2020" title="DCAdMobBanner">DCAdMobBanner</a>」クラスを改訂しました。</p>

<p><a href="https://developers.google.com/admob/ios/banner?hl=ja" title="公式リファレンス">公式リファレンス</a>を参考にさせていただきました。ご使用の際はアプリIDと広告枠IDを指定してください。</p>

<p>下記よりサンプルをダウンロード出来ますので、導入の際のお役に立てば幸いです。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-admob-banner-2020">https://github.com/masakihirokawa/objc-classes-dc-admob-banner-2020</a></li>
</ul>


<h2>今回の変更点</h2>

<ol>
<li>バナーのフェードイン秒数を指定できるようにしました</li>
<li>アダプティブバナーを使用するか指定できるようにしました</li>
<li>広告のパーソナライズ設定を使用するか指定できるようにしました</li>
</ol>


<h2>導入準備</h2>

<h3>1. Info.plistの編集</h3>

<p><a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>のサイトからアプリIDを取得し、<em>Info.plist</em>に <em>GADApplicationIdentifier</em>の項目を追加し指定してください。</p>

<h3>2. 広告枠IDの保持</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">GAD_UNIT_ID</span> <span class="o">=</span> <span class="s">@&quot;広告枠ID&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. アプリ起動時に初期化</h3>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">GoogleMobileAds</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// AdMobアプリID初期化</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">GADMobileAds</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">startWithCompletionHandler:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>クラスの使用方法</h2>

<h3>1. バナーの表示</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdMobBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">showAdBanner:</span><span class="n">self</span> <span class="nl">yPos:</span><span class="mf">0.0</span> <span class="nl">fadeInDuration:</span><span class="mf">0.0</span>
</span><span class='line'>                              <span class="nl">useAdaptiveBanner:</span><span class="n">YES</span> <span class="nl">useSmartBanner:</span><span class="n">NO</span> <span class="nl">usePersonalizedAds:</span><span class="n">YES</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. バナーの削除</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdMobBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">removeAdBanner</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. バナーの非表示</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdMobBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">hideAdBanner:</span><span class="n">YES</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. バナーを最前面に配置</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdMobBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">insertAdBanner</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>5. バナーの再読み込み</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdMobBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">reloadAdBanner:</span><span class="n">self</span> <span class="nl">usePersonalizedAds:</span><span class="n">YES</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>6. ロード状況の取得</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">BOOL</span> <span class="n">isLoadedAdBanner</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCAdMobBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">loaded</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCAdMobBanner.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">GoogleMobileAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCAdMobBanner</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">GADBannerViewDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="n">bannerX</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="n">bannerY</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">BOOL</span>    <span class="n">isFailed</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GADBannerView</span>    <span class="o">*</span><span class="n">gadView</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">UIViewController</span> <span class="o">*</span><span class="n">currentRootViewController</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>             <span class="n">loaded</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">CGFloat</span>          <span class="n">fadeInDuration</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>             <span class="n">useAdaptiveBanner</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>             <span class="n">useSmartBanner</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>             <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAdBanner:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">yPos:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">yPos</span> <span class="nf">fadeInDuration:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">fadeInDuration</span>
</span><span class='line'>   <span class="nf">useAdaptiveBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">useAdaptiveBanner</span> <span class="nf">useSmartBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">useSmartBanner</span> <span class="nf">usePersonalizedAds:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">reloadAdBanner:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">usePersonalizedAds:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeAdBanner</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">hideAdBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidden</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">insertAdBanner</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCAdMobBanner.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCAdMobBanner.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCAdMobBanner</span>
</span><span class='line'>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">gadView</span>                   <span class="o">=</span> <span class="n">_gadView</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">currentRootViewController</span> <span class="o">=</span> <span class="n">_currentRootViewController</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">loaded</span>                    <span class="o">=</span> <span class="n">_loaded</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">id</span> <span class="n">sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">@synchronized</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナー表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAdBanner:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">yPos:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">yPos</span> <span class="nf">fadeInDuration:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">fadeInDuration</span>
</span><span class='line'>   <span class="nf">useAdaptiveBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">useAdaptiveBanner</span> <span class="nf">useSmartBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">useSmartBanner</span> <span class="nf">usePersonalizedAds:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">fadeInDuration</span> <span class="o">=</span> <span class="n">fadeInDuration</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">useAdaptiveBanner</span> <span class="o">=</span> <span class="n">useAdaptiveBanner</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">useSmartBanner</span> <span class="o">=</span> <span class="n">useSmartBanner</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">usePersonalizedAds</span> <span class="o">=</span> <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">useAdaptiveBanner</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">useSmartBanner</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">screenWidth</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'>        <span class="n">bannerX</span> <span class="o">=</span> <span class="n">roundf</span><span class="p">((</span><span class="n">screenWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">kGADAdSizeBanner</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">bannerY</span> <span class="o">=</span> <span class="n">yPos</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">showAdMobBanner:</span><span class="n">viewController</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナーの再読み込み</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">reloadAdBanner:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">usePersonalizedAds:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">usePersonalizedAds</span> <span class="o">=</span> <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">superview</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">loadAdMobBanner:</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナー削除</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeAdBanner</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">superview</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナー非表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">hideAdBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidden</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">superview</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="n">hidden</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナーを最前面に配置</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">insertAdBanner</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">superview</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSUInteger</span> <span class="n">subviewsCount</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span> <span class="n">subviews</span><span class="p">]</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">insertSubview:</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="nl">atIndex:</span><span class="n">subviewsCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - AdMob Banner</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAdMobBanner:</span><span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nv">targetView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">useAdaptiveBanner</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADBannerView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdSize:</span><span class="n">GADCurrentOrientationAnchoredAdaptiveBannerAdSizeWithWidth</span><span class="p">(</span><span class="n">targetView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">)];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">useSmartBanner</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADBannerView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdSize:</span><span class="n">kGADAdSizeSmartBannerPortrait</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADBannerView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdSize:</span><span class="n">kGADAdSizeBanner</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">adUnitID</span> <span class="o">=</span> <span class="n">GAD_TEST_MODE</span> <span class="o">?</span> <span class="n">GAD_TEST_UNIT_ID</span> <span class="o">:</span> <span class="n">GAD_UNIT_ID</span><span class="p">;</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">loadAdMobBanner:</span><span class="n">targetView</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">superview</span> <span class="nl">isEqual:</span><span class="n">targetView</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">loadAdMobBanner:</span><span class="n">targetView</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadAdMobBanner:</span><span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nv">view</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CGRect</span> <span class="n">gadViewFrame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
</span><span class='line'>    <span class="n">gadViewFrame</span><span class="p">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">bannerX</span><span class="p">,</span> <span class="n">bannerY</span><span class="p">);</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">gadViewFrame</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GADRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">GADRequest</span> <span class="n">request</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">GAD_TEST_MODE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">GADMobileAds</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="n">requestConfiguration</span><span class="p">].</span><span class="n">testDeviceIdentifiers</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="n">kGADSimulatorID</span><span class="p">,</span>
</span><span class='line'>                                                                                       <span class="s">@&quot;Test Device ID&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">usePersonalizedAds</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">GADExtras</span> <span class="o">*</span><span class="n">extras</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADExtras</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="n">extras</span><span class="p">.</span><span class="n">additionalParameters</span> <span class="o">=</span> <span class="err">@</span><span class="p">{</span><span class="s">@&quot;npa&quot;</span><span class="o">:</span> <span class="s">@&quot;1&quot;</span><span class="p">};</span>
</span><span class='line'>        <span class="p">[</span><span class="n">request</span> <span class="nl">registerAdNetworkExtras:</span><span class="n">extras</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;DCAdMobBanner -&gt; usePersonalizedAds: %d&quot;, self.usePersonalizedAds);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">gadView</span> <span class="nl">loadRequest:</span><span class="n">request</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - delegate method</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adViewDidReceiveAd:</span><span class="p">(</span><span class="n">GADBannerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">bannerView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="k">const</span> <span class="n">useFadeInAnimation</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">fadeInDuration</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">useFadeInAnimation</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">bannerView</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">[</span><span class="n">UIView</span> <span class="nl">animateWithDuration:</span><span class="n">self</span><span class="p">.</span><span class="n">fadeInDuration</span> <span class="nl">animations:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>            <span class="n">bannerView</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_loaded</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">isFailed</span> <span class="o">=</span> <span class="o">!</span><span class="n">_loaded</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adView:</span><span class="p">(</span><span class="n">GADBannerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">bannerView</span> <span class="nf">didFailToReceiveAdWithError:</span><span class="p">(</span><span class="n">GADRequestError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">_loaded</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">isFailed</span> <span class="o">=</span> <span class="o">!</span><span class="n">_loaded</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// バナー再読み込み</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">showAdBanner:</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span> <span class="nl">yPos:</span><span class="n">bannerY</span> <span class="nl">fadeInDuration:</span><span class="n">self</span><span class="p">.</span><span class="n">fadeInDuration</span>
</span><span class='line'>     <span class="nl">useAdaptiveBanner:</span><span class="n">self</span><span class="p">.</span><span class="n">useAdaptiveBanner</span> <span class="nl">useSmartBanner:</span><span class="n">self</span><span class="p">.</span><span class="n">useSmartBanner</span> <span class="nl">usePersonalizedAds:</span><span class="n">self</span><span class="p">.</span><span class="n">usePersonalizedAds</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adViewWillPresentScreen:</span><span class="p">(</span><span class="n">GADBannerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">bannerView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adViewDidDismissScreen:</span><span class="p">(</span><span class="n">GADBannerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">bannerView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adViewWillDismissScreen:</span><span class="p">(</span><span class="n">GADBannerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">bannerView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">adViewWillLeaveApplication:</span><span class="p">(</span><span class="n">GADBannerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">bannerView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/09/objc-admob-rewarded-video-ads/" title="AdMob動画リワード広告の導入手順">AdMob動画リワード広告の導入手順</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[アドフリくんの動画リワード広告導入手順]]></title>
    <link href="https://lab.dolice.net/blog/2020/07/09/objc-adfurikun-rewarded-video-ads/"/>
    <updated>2020-07-09T13:50:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2020/07/09/objc-adfurikun-rewarded-video-ads</id>
    <content type="html"><![CDATA[<p>iPhoneアプリに<a href="https://adfurikun.jp/" title="アドフリくん">アドフリくん</a>の動画リワード広告を表示するサンプルを作成しました。</p>

<p><a href="https://github.com/glossom-dev/AdfurikunSDK-iOS/wiki" title="公式マニュアル">公式マニュアル</a>を参考にさせていただきました。ご使用の際は広告枠IDを指定してください。</p>

<p>下記よりサンプルをダウンロード出来ますので、導入の際のお役に立てば幸いです。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-adfurikun-rewarded-video-ads">https://github.com/masakihirokawa/objc-adfurikun-rewarded-video-ads</a></li>
</ul>


<h2>導入準備</h2>

<h3>1. 広告枠IDの保持</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">ADFURIKUN_REWARD_UNIT_ID</span> <span class="o">=</span> <span class="s">@&quot;広告枠ID&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. アプリ起動時に初期化</h3>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;ADFMovieReward/ADFmyMovieReward.h&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// アドフリくん動画リワード広告初期化</span>
</span><span class='line'>    <span class="p">[</span><span class="n">ADFmyMovieReward</span> <span class="nl">initializeWithAppID:</span><span class="n">ADFURIKUN_REWARD_UNIT_ID</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>e.x. Info.plistの編集</h3>

<p><a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>を使用する場合は <em>Info.plist</em>に <em>GADApplicationIdentifier</em>の設定値を追加してください。</p>

<h3>動画リワード広告の読み込み</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">AdfurikunRewardedVideoAds</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">loadRewardedVideoAds:</span><span class="n">self</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>AdfurikunRewardedVideoAds.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;ADFMovieReward/ADFmyMovieReward.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">AdfurikunRewardedVideoAds</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">ADFmyMovieRewardDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="n">isCompletePlaying</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span>         <span class="n">ADFmyMovieReward</span> <span class="o">*</span><span class="n">adfurikunRewardedAd</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">UIViewController</span> <span class="o">*</span><span class="n">rootViewController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">UIActivityIndicatorView</span> <span class="o">*</span><span class="n">activityIndicator</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">UIView</span>                  <span class="o">*</span><span class="n">overlay</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>                    <span class="n">showOverlay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - enumerator</span>
</span><span class='line'><span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">,</span> <span class="n">activityIndicatorStyles</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">AI_GRAY</span>        <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AI_WHITE</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="n">AI_WHITE_LARGE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadRewardedVideoAds:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>AdfurikunRewardedVideoAds.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;AdfurikunRewardedVideoAds.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">AdfurikunRewardedVideoAds</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">id</span> <span class="n">sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">@synchronized</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Adfurikun Rewarded Video Ads</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 動画リワード広告広告読み込み</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadRewardedVideoAds:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">viewController</span> <span class="nl">isEqual:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Adfurikun動画リワード広告読み込み</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">adfurikunRewardedAd</span> <span class="o">=</span> <span class="p">[</span><span class="n">ADFmyMovieReward</span> <span class="nl">getInstance:</span><span class="n">ADFURIKUN_REWARD_UNIT_ID</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">adfurikunRewardedAd</span> <span class="n">load</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// アクティビティインジケータのアニメーション開始</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">screenWidth</span>  <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">screenHeight</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">startActivityIndicator:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">center:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">screenWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">screenHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                         <span class="nl">styleId:</span><span class="n">AI_WHITE</span> <span class="nl">hidesWhenStopped:</span><span class="n">YES</span> <span class="nl">showOverlay:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告取得成功時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsFetchCompleted:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span> <span class="nf">isTestMode:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">isTestMode_inApp</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;AdfurikunRewardedVideoAds: AdsFetchCompleted&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">self</span><span class="p">.</span><span class="n">adfurikunRewardedAd</span> <span class="n">isPrepared</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">adfurikunRewardedAd</span> <span class="nl">playWithPresentingViewController:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告取得失敗時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsFetchFailed:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;AdfurikunRewardedVideoAds: AdsFetchFailed&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告表示開始時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsDidShow:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span> <span class="nf">adNetworkKey:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">adNetworkKey</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;AdfurikunRewardedVideoAds: AdsDidShow&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告表示失敗時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsPlayFailed:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;AdfurikunRewardedVideoAds: AdsPlayFailed&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを下ろす</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">stopActivityIndicator</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告を最後まで視聴した時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsDidCompleteShow:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;AdfurikunRewardedVideoAds: AdsDidCompleteShow&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: リワード提供</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再生完了フラグを立てる</span>
</span><span class='line'>    <span class="n">isCompletePlaying</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告を閉じた時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsDidHide:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;AdfurikunRewardedVideoAds: AdsDidHide&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: 再生が完了していればお知らせアラート表示</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isCompletePlaying</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Activity Indicator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// アクティビティインジケーターのアニメーション開始</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startActivityIndicator:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">view</span> <span class="nf">center:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">center</span> <span class="nf">styleId:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">styleId</span> <span class="nf">hidesWhenStopped:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidesWhenStopped</span> <span class="nf">showOverlay:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">showOverlay</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// インジケーター初期化</span>
</span><span class='line'>    <span class="n">_activityIndicator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIActivityIndicatorView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// スタイルを設定</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">styleId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_GRAY:</span>
</span><span class='line'>            <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleGray</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_WHITE:</span>
</span><span class='line'>            <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhite</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AI_WHITE_LARGE:</span>
</span><span class='line'>            <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">=</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// スタイルに応じて寸法変更</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_activityIndicator</span><span class="p">.</span><span class="n">activityIndicatorViewStyle</span> <span class="o">==</span> <span class="n">UIActivityIndicatorViewStyleWhiteLarge</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 座標をセンターに指定</span>
</span><span class='line'>    <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 停止した時に隠れるよう設定</span>
</span><span class='line'>    <span class="n">_activityIndicator</span><span class="p">.</span><span class="n">hidesWhenStopped</span> <span class="o">=</span> <span class="n">hidesWhenStopped</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// インジケーターアニメーション開始</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_activityIndicator</span> <span class="n">startAnimating</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// オーバーレイ表示フラグ保持</span>
</span><span class='line'>    <span class="n">_showOverlay</span> <span class="o">=</span> <span class="n">showOverlay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// オーバーレイ表示</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_showOverlay</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_overlay</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span><span class='line'>        <span class="n">_overlay</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nl">colorWithRed:</span><span class="mf">0.0</span> <span class="nl">green:</span><span class="mf">0.0</span> <span class="nl">blue:</span><span class="mf">0.0</span> <span class="nl">alpha:</span><span class="mf">0.5f</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_overlay</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 画面に追加</span>
</span><span class='line'>    <span class="p">[</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_activityIndicator</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// アクティビティインジケーターのアニメーション停止</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopActivityIndicator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_showOverlay</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_overlay</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_activityIndicator</span> <span class="n">stopAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>リワードの提供</h2>

<p>当方は動画リワード広告が最後まで再生されたら3日間広告を表示しないという設定にしています。</p>

<p>また、リワードが提供されたことをユーザーにお知らせするため、リワード期限日を文字列で取得できるようにしています。</p>

<p>まず下記のようにリワードを提供します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// 動画リワード広告再生完了時の処理</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">onCompleteRewardedVideoAds</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// 視聴済みフラグを立てる</span>
</span><span class='line'>    <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ユーザーデフォルト更新</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setBool:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="nl">forKey:</span><span class="n">UD_REWARDED_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// リワード受取日と期限日の保存</span>
</span><span class='line'>    <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardDateReceived</span>   <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardExpirationDate</span> <span class="o">=</span> <span class="p">[</span><span class="n">Common</span> <span class="n">rewardExpirationDate</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setObject:</span><span class="n">rewardDateReceived</span> <span class="nl">forKey:</span><span class="n">UD_REWARD_DATE_RECEIVED_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setObject:</span><span class="n">rewardExpirationDate</span> <span class="nl">forKey:</span><span class="n">UD_REWARD_EXPIRATION_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: バナー削除</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// リワード期限日の取得</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nf">rewardExpirationDate</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardDateReceived</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">rewardDateReceived</span> <span class="nl">initWithTimeInterval:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">rewardPeriod</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="nl">sinceDate:</span><span class="n">rewardDateReceived</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// リワード期限日を文字列で取得</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">rewardExpirationDateStr</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">dateFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSDateFormatter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">dateFormatter</span> <span class="nl">setLocale:</span><span class="p">[</span><span class="n">NSLocale</span> <span class="n">systemLocale</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">dateFormatter</span> <span class="nl">setDateFormat:</span><span class="s">@&quot;yyyy/MM/dd HH:mm:ss&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSDate</span>   <span class="o">*</span><span class="k">const</span> <span class="n">expirationDate</span>    <span class="o">=</span> <span class="p">[</span><span class="n">Common</span> <span class="n">rewardExpirationDate</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">expirationDateStr</span> <span class="o">=</span> <span class="p">[</span><span class="n">dateFormatter</span> <span class="nl">stringFromDate:</span><span class="n">expirationDate</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;（有効期限: %@）&quot;</span><span class="p">,</span> <span class="n">expirationDateStr</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>リワード期間中であるか判定</h2>

<p>アプリ起動時にリワード期間中であるか判定し、フラグを更新します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// リワード期間であれば期限切れであるか判定</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// リワード受取日とリワード期限日の取得</span>
</span><span class='line'>        <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardDateReceived</span>   <span class="o">=</span> <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">objectForKey:</span><span class="n">UD_REWARD_DATE_RECEIVED_KEY</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">rewardExpirationDate</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">objectForKey:</span><span class="n">UD_REWARD_EXPIRATION_KEY</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 現在時刻がリワード期間であるか判定</span>
</span><span class='line'>        <span class="n">NSDate</span> <span class="o">*</span><span class="k">const</span> <span class="n">now</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="o">=</span> <span class="p">[</span><span class="n">now</span> <span class="nl">compare:</span><span class="n">rewardDateReceived</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedDescending</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">now</span> <span class="nl">compare:</span><span class="n">rewardExpirationDate</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedAscending</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ユーザーデフォルト更新</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setBool:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">isRewarded</span> <span class="nl">forKey:</span><span class="n">UD_REWARDED_KEY</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上で動画リワード広告の実装は完了になります。</p>

<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/08/objc-classes-dc-adfurikun-banner/" title="アドフリくんバナーを表示する「DCAdfurikunBanner」クラス">アドフリくんバナーを表示する「DCAdfurikunBanner」クラス</a></strong></li>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-adfurikun-interstitial/" title="アドフリくんの動画インタースティシャル広告を表示する「DCAdfurikunInterstitial」クラス">アドフリくんの動画インタースティシャル広告を表示する「DCAdfurikunInterstitial」クラス</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[アドフリくんの動画インタースティシャル広告を表示する「DCAdfurikunInterstitial」クラス]]></title>
    <link href="https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-adfurikun-interstitial/"/>
    <updated>2020-07-09T12:33:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-adfurikun-interstitial</id>
    <content type="html"><![CDATA[<p>iPhoneアプリに<a href="https://adfurikun.jp/" title="アドフリくん">アドフリくん</a>の動画インタースティシャル広告を表示する「<a href="https://github.com/masakihirokawa/objc-classes-dc-adfurikun-interstitial" title="DCAdfurikunInterstitial">DCAdfurikunInterstitial</a>」クラスを作成しました。</p>

<p><a href="https://github.com/glossom-dev/AdfurikunSDK-iOS/wiki" title="公式マニュアル">公式マニュアル</a>の通りの実装になりますが、作業時間短縮のお役に立てば幸いです。ご使用の際は広告枠IDを指定してください。</p>

<p>下記よりサンプルをダウンロード出来ます。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-adfurikun-interstitial">https://github.com/masakihirokawa/objc-classes-dc-adfurikun-interstitial</a></li>
</ul>


<h2>導入準備</h2>

<h3>1. 広告枠IDの保持</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">ADFURIKUN_INTERS_UNIT_ID</span> <span class="o">=</span> <span class="s">@&quot;広告枠ID&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. アプリ起動時に初期化</h3>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;ADFMovieReward/ADFmyInterstitial.h&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// アドフリくんインタースティシャル広告初期化</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">ADFmyInterstitial</span> <span class="n">isSupportedOSVersion</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">ADFmyInterstitial</span> <span class="nl">initializeWithAppID:</span><span class="n">ADFURIKUN_INTERS_UNIT_ID</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>e.x. Info.plistの編集</h3>

<p><a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>を使用する場合は <em>Info.plist</em>に <em>GADApplicationIdentifier</em>の設定値を追加してください。</p>

<h2>クラスの使用方法</h2>

<h3>動画インタースティシャル広告の読み込み</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdfurikunInterstitial</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">loadInterstitial:</span><span class="n">self</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCAdfurikunInterstitial.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;ADFMovieReward/ADFmyInterstitial.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCAdfurikunInterstitial</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">ADFmyMovieRewardDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">ADFmyInterstitial</span> <span class="o">*</span><span class="n">adfurikunInterstitial</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">UIViewController</span> <span class="o">*</span><span class="n">rootViewController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadInterstitial:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCAdfurikunInterstitial.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCAdfurikunInterstitial.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCAdfurikunInterstitial</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">id</span> <span class="n">sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">@synchronized</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Adfurikun Interstitial Ad</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Adfurikunインタースティシャル広告読み込み</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadInterstitial:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">viewController</span> <span class="nl">isEqual:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">adfurikunInterstitial</span> <span class="o">=</span> <span class="p">[</span><span class="n">ADFmyInterstitial</span> <span class="nl">getInstance:</span><span class="n">ADFURIKUN_INTERS_UNIT_ID</span> <span class="nl">delegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">adfurikunInterstitial</span> <span class="n">load</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の読み込みが完了した時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsFetchCompleted:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span> <span class="nf">isTestMode:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">isTestMode_inApp</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">adfurikunInterstitial</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">adfurikunInterstitial</span> <span class="n">isPrepared</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">adfurikunInterstitial</span> <span class="nl">playWithPresentingViewController:</span><span class="n">self</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の読み込みに失敗した時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsFetchFailed:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の表示を開始した時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsDidShow:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span> <span class="nf">adNetworkKey:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">adNetworkKey</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の再生が完了した時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsDidCompleteShow:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告を閉じた時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsDidHide:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の再生エラー時に呼ばれる</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">AdsPlayFailed:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/08/objc-classes-dc-adfurikun-banner/" title="アドフリくんバナーを表示する「DCAdfurikunBanner」クラス">アドフリくんバナーを表示する「DCAdfurikunBanner」クラス</a></strong></li>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/09/objc-adfurikun-rewarded-video-ads/" title="アドフリくんの動画リワード広告導入手順">アドフリくんの動画リワード広告導入手順</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[アドフリくんバナーを表示する「DCAdfurikunBanner」クラス]]></title>
    <link href="https://lab.dolice.net/blog/2020/07/08/objc-classes-dc-adfurikun-banner/"/>
    <updated>2020-07-08T13:38:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2020/07/08/objc-classes-dc-adfurikun-banner</id>
    <content type="html"><![CDATA[<p>iPhoneアプリに<a href="https://adfurikun.jp/" title="アドフリくん">アドフリくん</a>のモバイルバナー（Ver. 2）を表示する「<a href="https://github.com/masakihirokawa/objc-classes-dc-adfurikun-banner" title="DCAdfurikunBanner">DCAdfurikunBanner</a>」クラスを作成しました。</p>

<p><a href="https://github.com/glossom-dev/AdfurikunSDK-iOS/wiki" title="公式マニュアル">公式マニュアル</a>を参考にさせていただき、10秒毎にバナーがリフレッシュされるよう実装しております。ご使用の際は広告枠IDを指定してください。</p>

<p>下記よりサンプルをダウンロード出来ますので、導入の際のお役に立てば幸いです。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-adfurikun-banner">https://github.com/masakihirokawa/objc-classes-dc-adfurikun-banner</a></li>
</ul>


<h2>導入準備</h2>

<h3>1. 広告枠IDの保持</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">ADFURIKUN_AD_UNIT_ID</span> <span class="o">=</span> <span class="s">@&quot;広告枠ID&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. アプリ起動時に初期化</h3>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;ADFMovieReward/ADFmyBanner.h&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// アドフリくんバナー初期化</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">ADFmyNativeAd</span> <span class="n">isSupportedOSVersion</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">ADFmyNativeAd</span> <span class="nl">initializeWithAppID:</span><span class="n">ADFURIKUN_AD_UNIT_ID</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>e.x. Info.plistの編集</h3>

<p><a href="https://admob.google.com/intl/ja/home/" title="AdMob">AdMob</a>を使用する場合は <em>Info.plist</em>に <em>GADApplicationIdentifier</em>の設定値を追加してください。</p>

<h2>クラスの使用方法</h2>

<h3>1. バナーの表示</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdfurikunBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">showAdBanner:</span><span class="n">self</span> <span class="nl">yPos:</span><span class="mf">0.0</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. バナーの削除</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdfurikunBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">removeAdBanner</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. バナーの非表示</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdfurikunBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">hideAdBanner:</span><span class="n">YES</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. バナーを最前面に配置</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdfurikunBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">insertAdBanner</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>5. バナーの再読み込み</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[[</span><span class="n">DCAdfurikunBanner</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">reloadAdBanner</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCAdfurikunBanner.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;ADFMovieReward/ADFmyBanner.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCAdfurikunBanner</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">ADFmyNativeAdDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="n">bannerY</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">BOOL</span>    <span class="n">isAdfurikunFailed</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">ADFmyBanner</span>              <span class="o">*</span><span class="n">bannerAd</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">ADFNativeAdInfo</span>          <span class="o">*</span><span class="n">bannerAdInfo</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">UIViewController</span> <span class="o">*</span><span class="n">currentRootViewController</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">NSTimer</span>          <span class="o">*</span><span class="n">refreshTimer</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>             <span class="n">loaded</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAdBanner:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">yPos:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">yPos</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeAdBanner</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">hideAdBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">hidden</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">insertAdBanner</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">reloadAdBanner</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCAdfurikunBanner.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCAdfurikunBanner.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCAdfurikunBanner</span>
</span><span class='line'>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">bannerAd</span>                  <span class="o">=</span> <span class="n">_bannerAd</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">bannerAdInfo</span>              <span class="o">=</span> <span class="n">_bannerAdInfo</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">currentRootViewController</span> <span class="o">=</span> <span class="n">_currentRootViewController</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">refreshTimer</span>              <span class="o">=</span> <span class="n">_refreshTimer</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">loaded</span>                    <span class="o">=</span> <span class="n">_loaded</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">id</span> <span class="n">sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">@synchronized</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナー表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showAdBanner:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">yPos:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">yPos</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">removeAdBanner</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">viewController</span> <span class="nl">isEqual:</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">bannerY</span> <span class="o">=</span> <span class="n">yPos</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_bannerAd</span> <span class="o">=</span> <span class="p">[</span><span class="n">ADFmyBanner</span> <span class="nl">createInstance:</span><span class="n">ADFURIKUN_AD_UNIT_ID</span><span class="s">&quot;];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_bannerAd</span> <span class="nl">loadAndNotifyTo:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナー削除</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">removeAdBanner</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_bannerAdInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_bannerAdInfo</span><span class="p">.</span><span class="n">mediaView</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'>        <span class="n">_bannerAdInfo</span><span class="p">.</span><span class="n">mediaView</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>        <span class="n">_bannerAdInfo</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">clearRefreshTimer</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナー非表示</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">hideAdBanner:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">hidden</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_bannerAdInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_bannerAdInfo</span><span class="p">.</span><span class="n">mediaView</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="n">hidden</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナーを最前面に配置</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">insertAdBanner</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_bannerAdInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSUInteger</span> <span class="n">subviewsCount</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span> <span class="n">subviews</span><span class="p">]</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">insertSubview:</span><span class="n">_bannerAdInfo</span><span class="p">.</span><span class="n">mediaView</span> <span class="nl">atIndex:</span><span class="n">subviewsCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナーの再読み込み</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">reloadAdBanner</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_bannerAdInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="n">removeAdBanner</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_bannerAd</span> <span class="nl">loadAndNotifyTo:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Refresh Timer</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の自動更新タイマー開始</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">startRefreshTimer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">_refreshTimer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nl">scheduledTimerWithTimeInterval:</span><span class="mf">10.0</span> <span class="nl">repeats:</span><span class="n">YES</span> <span class="nl">block:</span><span class="o">^</span><span class="p">(</span><span class="n">NSTimer</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">timer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="n">reloadAdBanner</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告の自動更新タイマー削除</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">clearRefreshTimer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">_refreshTimer</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">_refreshTimer</span> <span class="n">invalidate</span><span class="p">];</span>
</span><span class='line'>        <span class="n">_refreshTimer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - delegate method</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナーの取得に成功した時に呼ばれる</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">onNativeAdLoadFinish:</span><span class="p">(</span><span class="n">ADFNativeAdInfo</span> <span class="o">*</span><span class="p">)</span><span class="n">info</span> <span class="nl">appID:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;onNativeAdLoadFinish&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_bannerAdInfo</span> <span class="o">=</span> <span class="n">info</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">bannerWidth</span>  <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">bannerHeight</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_bannerAdInfo</span><span class="p">.</span><span class="n">mediaView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bannerY</span><span class="p">,</span> <span class="n">bannerWidth</span><span class="p">,</span> <span class="n">bannerHeight</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_bannerAdInfo</span><span class="p">.</span><span class="n">mediaView</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_bannerAdInfo</span> <span class="n">playMediaView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">clearRefreshTimer</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">startRefreshTimer</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_loaded</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">isAdfurikunFailed</span> <span class="o">=</span> <span class="o">!</span><span class="n">_loaded</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// バナーの取得に失敗した時に呼ばれる</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">onNativeAdLoadError:</span><span class="p">(</span><span class="n">ADFMovieError</span> <span class="o">*</span><span class="p">)</span><span class="n">error</span> <span class="nl">appID:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">appID</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;Failed to load native ad, error code=%lu, error message=\&quot;%@\&quot;&quot;, (unsigned long)error.errorCode, error.errorMessage);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_loaded</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">isAdfurikunFailed</span> <span class="o">=</span> <span class="o">!</span><span class="n">_loaded</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// バナー再読み込み</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">showAdBanner:</span><span class="n">self</span><span class="p">.</span><span class="n">currentRootViewController</span> <span class="nl">yPos:</span><span class="n">bannerY</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/09/objc-classes-dc-adfurikun-interstitial/" title="アドフリくんの動画インタースティシャル広告を表示する「DCAdfurikunInterstitial」クラス">アドフリくんの動画インタースティシャル広告を表示する「DCAdfurikunInterstitial」クラス</a></strong></li>
<li><strong><a href="https://lab.dolice.net/blog/2020/07/09/objc-adfurikun-rewarded-video-ads/" title="アドフリくんの動画リワード広告導入手順">アドフリくんの動画リワード広告導入手順</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[株式会社リクルート「ホットペーパービューティー 2019年7月号」に掲載いただきました]]></title>
    <link href="https://lab.dolice.net/blog/2019/06/28/ios-hotpepper-beauty-july-2019/"/>
    <updated>2019-06-28T11:17:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2019/06/28/ios-hotpepper-beauty-july-2019</id>
    <content type="html"><![CDATA[<p><img src="https://lab.dolice.net/images/article/hotpepper_beauty_20190628.jpg" title="株式会社リクルート「ホットペッパービューティー 2019年7月号」" alt="株式会社リクルート「ホットペッパービューティー 2019年7月号」" /></p>

<p>株式会社リクルート様より 6月28日に発刊された「ホットペーパービューティー 2019年7月号」に iPhoneアプリ「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>」を掲載いただきました（<em>P 160</em>）。</p>

<p>「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>」は、2013年の iOS 6から iOS 7に変わる過渡期にリリースしました。当時は次の時代を意識した UI/UXデザインを念頭に置いていましたが、デザインのトレンドは常に変わり続けています。</p>

<p>毎年のアップデートで見えないところにも見えるところにも手を加えながら、沢山のユーザーの方々に支えられ今日に至りました。次回のアップデートではユーザーの方々に喜ばれるような改善を行いたく思っています。</p>

<p>「ホットペーパービューティー」は全国のコンビニや駅にて配布されていますので、見かけた折は是非お手に取ってご覧ください。</p>

<h2>ホットペッパービューティー公式サイト</h2>

<ul>
<li><p><a href="https://www.recruit-lifestyle.co.jp/service/hotpepper-beauty.html" title="ホットペーパービューティー">ホットペーパービューティー</a></p></li>
<li><p><a href="https://magazine.hotpepper.jp/how_to_get.html" title="ホットペーパービューティー - 配布場所一覧">ホットペーパービューティー - 配布場所一覧</a></p></li>
</ul>


<h2>掲載アプリ</h2>

<h3>リラックス・ヒーリング</h3>

<p>α波発生に効果的なヒーリング音楽、雨音や森の中の小鳥のさえずりなどのサウンドを聴きながら、リラックスして深い眠りに。勉強や仕事に打ち込む時の集中力アップ目的での活用もできます。</p>

<p><a href="https://itunes.apple.com/jp/app/%E3%83%AA%E3%83%A9%E3%83%83%E3%82%AF%E3%82%B9-%E3%83%92%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0-%E5%BF%83%E5%9C%B0%E8%89%AF%E3%81%84%E7%9D%A1%E7%9C%A0%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%81%A8%E7%9B%AE%E8%A6%9A%E3%81%BE%E3%81%97%E6%99%82%E8%A8%88-%E7%84%A1%E6%96%99/id694492667?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[宝島社「大人のおしゃれ手帖 2019年5月号」に掲載いただきました]]></title>
    <link href="https://lab.dolice.net/blog/2019/04/05/ios-otona-no-oshare-techou-may-2019/"/>
    <updated>2019-04-05T15:12:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2019/04/05/ios-otona-no-oshare-techou-may-2019</id>
    <content type="html"><![CDATA[<p><img src="https://lab.dolice.net/images/article/otona_no_oshare_techou_may_2019.jpg" title="宝島社「大人のおしゃれ手帖 2019年5月号」" alt="宝島社「大人のおしゃれ手帖 2019年5月号」" /></p>

<p>宝島社様より4月5日に発行された「<a href="https://tkj.jp/osharetecho/201905/" title="大人のおしゃれ手帖">大人のおしゃれ手帖</a>」という書籍にて、iPhoneアプリ「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>」をご紹介いただきました（<em>P 109</em>）。書店へ立ち寄る機会がございましたら、是非お手に取ってご覧ください。</p>

<p>「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>」は 2013年にリリースして以降、何度も大事にアップデートを重ねて来たアプリですので、このような立派な記事に掲載いただき本当に嬉しく思います。今後もユーザーの方々のご意見やご要望を聞きながら、改善を重ねて参ります。</p>

<h2>書籍の詳細ページ</h2>

<ul>
<li><a href="https://tkj.jp/osharetecho/201905/" title="宝島社「大人のおしゃれ手帖 2019年5月号」">宝島社「大人のおしゃれ手帖 2019年5月号」</a></li>
</ul>


<h2>掲載アプリ</h2>

<h3>リラックス・ヒーリング</h3>

<p>α波発生に効果的なヒーリング音楽、雨音や森の中の小鳥のさえずりなどのサウンドを聴きながら、リラックスして深い眠りに。勉強や仕事に打ち込む時の集中力アップ目的での活用もできます。</p>

<p><a href="https://itunes.apple.com/jp/app/%E3%83%AA%E3%83%A9%E3%83%83%E3%82%AF%E3%82%B9-%E3%83%92%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0-%E5%BF%83%E5%9C%B0%E8%89%AF%E3%81%84%E7%9D%A1%E7%9C%A0%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%81%A8%E7%9B%AE%E8%A6%9A%E3%81%BE%E3%81%97%E6%99%82%E8%A8%88-%E7%84%A1%E6%96%99/id694492667?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AdMobの GDPR対応（iOS）]]></title>
    <link href="https://lab.dolice.net/blog/2018/06/03/objc-personalized-ad-consent/"/>
    <updated>2018-06-03T08:02:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2018/06/03/objc-personalized-ad-consent</id>
    <content type="html"><![CDATA[<p>AdMobを使用した iOSアプリで GDPRに対応した同意フォームを表示するサンプルを作成しました。</p>

<p>主に<a href="https://developers.google.com/admob/ios/eu-consent" title="公式ドキュメント">公式ドキュメント</a>の情報を参考にしています。</p>

<h2>サンプルダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-personalized-ad-consent">https://github.com/masakihirokawa/objc-personalized-ad-consent</a></li>
</ul>


<h2>導入準備</h2>

<h3>1. 広告技術プロバイダの選択</h3>

<p>AdMobの管理画面にログインし、「ブロックの管理」→「EU ユーザーの同意」画面を開きます。</p>

<p>次に『広告技術プロバイダの選択』から『広告技術プロバイダのカスタム グループ』を選択します（この設定の反映には、自分の場合は1時間ほど要しました。反映されるまで同意フォームの読み込みエラーが発生しますので、気長に待ちましょう）。</p>

<p>また、『同意取得の設定』にある『サイト運営者 ID』も後に使用するので控えておきます。</p>

<h3>2. CocoaPodsから SDKをインストール</h3>

<p><em>Podfile</em>に「<em>pod &#8216;PersonalizedAdConsent&#8217;</em>」の一行を追加し、SDKをインストールします。</p>

<h2>実装</h2>

<h3>同意フォームの表示</h3>

<p>EU圏内であれば同意フォームを表示し、従来通りのパーソナライズされた広告を表示するか、非パーソナライズされた広告を表示するかの設定を保持し、その設定によって広告のリクエストを分岐します。</p>

<h4>ViewController.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;PersonalizedAdConsent/PersonalizedAdConsent.h&gt;</span>
</span><span class='line'><span class="cp">#import &quot;Common.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>ViewController.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">ADMOB_PUB_ID</span>       <span class="o">=</span> <span class="s">@&quot;Your AdMob Publisher ID&quot;</span><span class="p">;</span> <span class="c1">// AdMobのパブリッシャーID</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">PRIVACY_POLICY_URL</span> <span class="o">=</span> <span class="s">@&quot;Your Privacy Policy URL&quot;</span><span class="p">;</span> <span class="c1">// プライバシーポリシーURL</span>
</span><span class='line'><span class="kt">BOOL</span>      <span class="k">const</span> <span class="n">PAC_DEBUG_MODE</span>     <span class="o">=</span> <span class="n">YES</span><span class="p">;</span> <span class="c1">// デバッグモード</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 広告のパーソナライズ設定</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">initPersonalizedAdsSetting</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Personalized Ads</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告のパーソナライズ設定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initPersonalizedAdsSetting</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// デバッグ用</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">PAC_DEBUG_MODE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 実機の識別子をコンソール表示</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Advertising ID: %@&quot;</span><span class="p">,</span> <span class="n">ASIdentifierManager</span><span class="p">.</span><span class="n">sharedManager</span><span class="p">.</span><span class="n">advertisingIdentifier</span><span class="p">.</span><span class="n">UUIDString</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 上記で出力した実機の識別子を入力（シミュレータで確認する場合は不要）</span>
</span><span class='line'>        <span class="n">PACConsentInformation</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">debugIdentifiers</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;Advertising ID&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ユーザー地域をEU圏内に指定</span>
</span><span class='line'>        <span class="n">PACConsentInformation</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">debugGeography</span> <span class="o">=</span> <span class="n">PACDebugGeographyEEA</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ユーザー地域をEU圏外に指定</span>
</span><span class='line'>        <span class="c1">//PACConsentInformation.sharedInstance.debugGeography = PACDebugGeographyNotEEA;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 広告のパーソナライズ設定初期化</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">initPersonalizedAdsSetting</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ユーザー情報をリクエスト</span>
</span><span class='line'>    <span class="p">[</span><span class="n">PACConsentInformation</span><span class="p">.</span><span class="n">sharedInstance</span>
</span><span class='line'>     <span class="nl">requestConsentInfoUpdateForPublisherIdentifiers:</span><span class="err">@</span><span class="p">[</span><span class="n">ADMOB_PUB_ID</span><span class="p">]</span>
</span><span class='line'>     <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>         <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>             <span class="c1">// エラー</span>
</span><span class='line'>             <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error -&gt; requestConsentInfoUpdate: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>             <span class="k">if</span> <span class="p">([</span><span class="n">PACConsentInformation</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">isRequestLocationInEEAOrUnknown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                 <span class="c1">// EU圏内もしくは不明であればステータスをチェックする</span>
</span><span class='line'>                 <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">status</span> <span class="o">=</span> <span class="n">PACConsentInformation</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">consentStatus</span><span class="p">;</span>
</span><span class='line'>                 <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                     <span class="k">case</span> <span class="nl">PACConsentStatusPersonalized:</span>
</span><span class='line'>                     <span class="k">case</span> <span class="nl">PACConsentStatusNonPersonalized:</span>
</span><span class='line'>                         <span class="c1">// TODO: 既に同意フォームから設定を保存済みなので、保存済みのパーソナライズ設定の広告を表示</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                         <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                     <span class="k">case</span> <span class="nl">PACConsentStatusUnknown:</span>
</span><span class='line'>                     <span class="k">default</span><span class="o">:</span>
</span><span class='line'>                         <span class="c1">// 同意情報をユーザーから取得する必要があるので同意フォームを表示する</span>
</span><span class='line'>                         <span class="p">[</span><span class="n">self</span> <span class="n">showConsentForm</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>                         <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                 <span class="p">}</span>
</span><span class='line'>             <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                 <span class="c1">// TODO: EU圏外であれば従来通りパーソナライズされた広告を表示</span>
</span><span class='line'>
</span><span class='line'>             <span class="p">}</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>     <span class="p">}];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 同意フォームの表示</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showConsentForm</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// プライバシーポリシーURLを指定し同意フォーム初期化</span>
</span><span class='line'>    <span class="n">NSURL</span> <span class="o">*</span><span class="n">privacyURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="n">PRIVACY_POLICY_URL</span><span class="p">];</span>
</span><span class='line'>    <span class="n">PACConsentForm</span> <span class="o">*</span><span class="n">form</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PACConsentForm</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithApplicationPrivacyPolicyURL:</span><span class="n">privacyURL</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// パーソナライズ広告の同意ボタンの有無</span>
</span><span class='line'>    <span class="n">form</span><span class="p">.</span><span class="n">shouldOfferPersonalizedAds</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// パーソナライズされていない広告の同意ボタンの有無</span>
</span><span class='line'>    <span class="n">form</span><span class="p">.</span><span class="n">shouldOfferNonPersonalizedAds</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 有料アプリへの誘導ボタンの有無</span>
</span><span class='line'>    <span class="n">form</span><span class="p">.</span><span class="n">shouldOfferAdFree</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 同意フォームの読み込み</span>
</span><span class='line'>    <span class="p">[</span><span class="n">form</span> <span class="nl">loadWithCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// ロードエラー</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error -&gt; loadWithCompletionHandler: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// ロード成功</span>
</span><span class='line'>            <span class="p">[</span><span class="n">form</span> <span class="nl">presentFromViewController:</span><span class="n">self</span>
</span><span class='line'>                          <span class="nl">dismissCompletion:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">_Nullable</span> <span class="n">error</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">userPrefersAdFree</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                              <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                                  <span class="c1">// エラー</span>
</span><span class='line'>                                  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error -&gt; presentFromViewController: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>                              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                                  <span class="c1">// ユーザーが同意フォームのどれを選択したかによって処理を分岐</span>
</span><span class='line'>                                  <span class="c1">//PACConsentStatus *status = PACConsentInformation.sharedInstance.consentStatus; // 左記では型指定の警告が発生</span>
</span><span class='line'>                                  <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">status</span> <span class="o">=</span> <span class="n">PACConsentInformation</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="n">consentStatus</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                                  <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                                      <span class="k">case</span> <span class="nl">PACConsentStatusPersonalized:</span>
</span><span class='line'>                                          <span class="c1">// パーソナライズ広告を表示するよう設定</span>
</span><span class='line'>                                          <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">setPersonalizedAdsSetting:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>                                          <span class="c1">// TODO: 広告の読み込み</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                                          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                                      <span class="k">case</span> <span class="nl">PACConsentStatusNonPersonalized:</span>
</span><span class='line'>                                          <span class="c1">// パーソナライズされていない広告を表示するよう設定</span>
</span><span class='line'>                                          <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">setPersonalizedAdsSetting:</span><span class="n">NO</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>                                          <span class="c1">// TODO: 広告の読み込み</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>                                          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                                      <span class="k">case</span> <span class="nl">PACConsentStatusUnknown:</span>
</span><span class='line'>                                      <span class="k">default</span><span class="o">:</span>
</span><span class='line'>                                          <span class="c1">// 同意が得られなかった場合の処理（通常は何もしない）</span>
</span><span class='line'>
</span><span class='line'>                                          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                                  <span class="p">}</span>
</span><span class='line'>                              <span class="p">}</span>
</span><span class='line'>                          <span class="p">}];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>広告のパーソナライズ設定の保持</h3>

<p>広告のパーソナライズ設定をユーザーデフォルトに保持します。</p>

<h4>Common.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'><span class="cp">#import &lt;PersonalizedAdConsent/PersonalizedAdConsent.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define UD_PERSONALIZED_ADS_KEY @&quot;UD_PERSONALIZED_ADS_KEY&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">Common</span> : <span class="nc">UIView</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSUserDefaults</span> <span class="o">*</span><span class="n">userDefaults</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">BOOL</span>           <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">retain</span><span class="p">)</span> <span class="n">NSUserDefaults</span> <span class="o">*</span><span class="n">userDefaults</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">BOOL</span>           <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">Common</span> <span class="o">*</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setPersonalizedAdsSetting:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isRequestLocationInEEAOrUnknown</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initPersonalizedAdsSetting</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Common.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;Common.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">Common</span>
</span><span class='line'>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">userDefaults</span><span class="p">;</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">Common</span> <span class="o">*</span><span class="n">_sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">Common</span> <span class="o">*</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">_sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Common</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">_sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Personalized Ads</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告のパーソナライズ設定初期化</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initPersonalizedAdsSetting</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// ユーザーデフォルト初期化</span>
</span><span class='line'>    <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">personalizedAdsDefaults</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSMutableDictionary</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">personalizedAdsDefaults</span> <span class="nl">setValue:</span><span class="err">@</span><span class="n">YES</span> <span class="nl">forKey:</span><span class="n">UD_PERSONALIZED_ADS_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSUserDefaults</span> <span class="n">standardUserDefaults</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">registerDefaults:</span><span class="n">personalizedAdsDefaults</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 広告のパーソナライズ設定をユーザーデフォルトから保持</span>
</span><span class='line'>    <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">usePersonalizedAds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">boolForKey:</span><span class="n">UD_PERSONALIZED_ADS_KEY</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 広告のパーソナライズ設定保持</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setPersonalizedAdsSetting:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">usePersonalizedAds</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// 広告のパーソナライズ設定保持</span>
</span><span class='line'>    <span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">usePersonalizedAds</span> <span class="o">=</span> <span class="n">usePersonalizedAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ユーザーデフォルト更新</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="nl">setBool:</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">usePersonalizedAds</span> <span class="nl">forKey:</span><span class="n">UD_PERSONALIZED_ADS_KEY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">userDefaults</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ユーザー地域がEEAまたは不明であるか取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isRequestLocationInEEAOrUnknown</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">PACConsentInformation</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">isRequestLocationInEEAOrUnknown</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>非パーソナライズ広告のリクエスト</h3>

<p>非パーソナライズ広告を表示する場合は、下記のように広告のリクエスト時にパラメータを渡します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">GADRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">GADRequest</span> <span class="n">request</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">Common</span> <span class="n">sharedManager</span><span class="p">].</span><span class="n">usePersonalizedAds</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">GADExtras</span> <span class="o">*</span><span class="n">extras</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADExtras</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">extras</span><span class="p">.</span><span class="n">additionalParameters</span> <span class="o">=</span> <span class="err">@</span><span class="p">{</span><span class="s">@&quot;npa&quot;</span><span class="o">:</span> <span class="s">@&quot;1&quot;</span><span class="p">};</span>
</span><span class='line'>    <span class="p">[</span><span class="n">request</span> <span class="nl">registerAdNetworkExtras:</span><span class="n">extras</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上が導入から実装までの大まかな流れになります。</p>

<p>EU圏内からのアプリ使用で、同意フォームを表示する場合はまだ広告を表示しないようにし、選択された内容によって従来通りのパーソナライズされた広告か、非パーソナライズされた広告を読み込むのが良いと思います。</p>

<p>また、アプリのどこかに同意フォームを再表示できるメニューやボタンを用意し、ユーザーがいつでも設定を変更できる必要があります。</p>

<p>大雑把な情報ではありますが、少しでもお役に立てば幸いです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iPhoneアプリ「リラックス・ヒーリング」アップデート（3.0.0）]]></title>
    <link href="https://lab.dolice.net/blog/2018/03/01/ios-relaxing-healing-update-3-0-0/"/>
    <updated>2018-03-01T08:56:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2018/03/01/ios-relaxing-healing-update-3-0-0</id>
    <content type="html"><![CDATA[<p>ヒーリング音楽や睡眠に効果的なサウンドを聴いてリラックスできる iPhoneアプリ「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>」をアップデートいたしました。</p>

<p>今回のアップデートでは、デザイン（色合い）を大幅に改訂し、ミュージックのオフタイマー機能やミュージックコントロール機能の追加などを行いました。よりリラックスできる優しい配色を心掛け、快適にご利用いただけるよう配慮いたしました。</p>

<p>下記よりアプリをダウンロードできますので、是非ご利用ください。</p>

<p><a href="https://itunes.apple.com/jp/app/%E3%83%AA%E3%83%A9%E3%83%83%E3%82%AF%E3%82%B9-%E3%83%92%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0-%E5%BF%83%E5%9C%B0%E8%89%AF%E3%81%84%E7%9D%A1%E7%9C%A0%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89/id694492667?mt=8" style="display:inline-block;overflow:hidden;background:url(https://linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>

<h2>このアプリについて</h2>

<p>α波発生に効果的なヒーリング音楽、雨音や森の中の小鳥のさえずりなどのサウンドを聴きながら、リラックスして深い眠りに就くことができます。</p>

<p>ストレスの軽減や寝付きが悪い時の対策、そして心身の疲れに効果があります。</p>

<p>ホワイトノイズも収録していますので、仕事や勉強に打ち込む時の作業用BGMにもお薦めです。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing_3_0_0/relaxing_healing_screenshot1.jpg" title="ミュージック画面" alt="ミュージック画面" /></p>

<p>5曲のヒーリング音楽を収録しています。全曲連続で再生したり、一曲リピートさせることもできます。現在、約1時間分のヒーリング音楽を収録しています。</p>

<p>バックグラウンド再生もサポートしていますので、他のアプリを操作しながらでも音楽をお楽しみいただけます。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing_3_0_0/relaxing_healing_screenshot2.jpg" title="サウンド画面" alt="サウンド画面" /></p>

<p>雨音などの環境音は11種収録しています。設定した時間が来ると徐々に音量を下げながら停止しますので、睡眠の妨げにはなりません。</p>

<p>眠る前に、例えば小川のせせらぎなどを流したまま、リラックスした頃に知らず知らずと心地良い睡眠に入ることができます。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing_3_0_0/relaxing_healing_screenshot3.jpg" title="アラーム画面" alt="アラーム画面" /></p>

<p>目覚まし機能も搭載しており、5種類のアラーム音から選んで使用できます。音楽やサウンドを流したままアラームを設定しても、起床時刻と同時に停止するので安心です。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing_3_0_0/relaxing_healing_screenshot4.jpg" title="設定画面" alt="設定画面" /></p>

<p>設定画面では、ミュージック／サウンド／アラームの音量変更や、ミュージックのリピート設定と再生時間設定、サウンドの再生時間設定などが行えます。</p>

<h2>収録内容</h2>

<h3>ヒーリング音楽</h3>

<p>ヒーリング音楽は下記の5曲を収録しています（4曲目と5曲目は、アプリ内から購入いただくと聴く事ができます）。</p>

<ol>
<li>ストレス解消ヒーリング音楽（α波）[10:25]</li>
<li>神秘的なヒーリング音楽 [16:51]</li>
<li>快適な眠りを誘う癒しの音楽（α波）[15:31]</li>
<li>体に優しい癒しの音楽（有料） [06:34]</li>
<li>さざなみヒーリング音楽（有料） [09:47]</li>
</ol>


<h3>サウンド</h3>

<p>サウンドは下記の11項目を全て無料でお聞きいただけます。</p>

<ol>
<li>雨音と川のせせらぎ</li>
<li>夕立の雨音</li>
<li>雰囲気に満ちた豪雨の音</li>
<li>雨とカエルの鳴き声</li>
<li>ルイジアナの雨音</li>
<li>鳥の鳴き声</li>
<li>雪解け水の音</li>
<li>波の音</li>
<li>ホワイトノイズ</li>
<li>森林浴</li>
<li>フクロウの鳴き声</li>
</ol>


<h3>アラーム音</h3>

<p>アラーム音は下記から好きな音を選択できます。</p>

<ol>
<li>アナログ目覚まし時計</li>
<li>デジタル目覚まし時計</li>
<li>目覚ましベル</li>
<li>ビープ音</li>
<li>警報音</li>
</ol>


<h2>主な機能</h2>

<ul>
<li>ヒーリングミュージック再生機能（5曲）</li>
<li>ヒーリングミュージックのオールプレイ機能</li>
<li>雨音や環境音の再生機能（11サウンド）</li>
<li>目覚まし機能（5種のアラーム音を搭載）</li>
</ul>


<h2>価格</h2>

<ul>
<li>無料（App内購入あり）</li>
</ul>


<h2>対応言語</h2>

<ul>
<li>日本語</li>
<li>英語</li>
</ul>


<h2>Facebook公式ページ</h2>

<ul>
<li><a href="https://www.facebook.com/dolice.hearing.healing">https://www.facebook.com/dolice.hearing.healing</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iPhone/Androidアプリ「浮世絵壁紙 - 美しい日本画ギャラリー」アップデート]]></title>
    <link href="https://lab.dolice.net/blog/2018/01/19/ios-android-ukiyo-e-update/"/>
    <updated>2018-01-19T10:11:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2018/01/19/ios-android-ukiyo-e-update</id>
    <content type="html"><![CDATA[<div class="app_screenshot_container"><img src="https://dolice.net/mb/ios/marketing/images/ukiyo-e/screenshot_pc/ja/screenshot1.jpg" class="app_screenshot" /></div>


<p>「浮世絵壁紙 - 美しい日本画ギャラリー」iPhone/Android版をアップデートいたしました。</p>

<p>今回のアップデートでは、新たに12名の作者別カテゴリを追加し、デザインのブラッシュアップを行いました。多くの方々により長くお楽しみいただけるよう、今後も定期的に更新を続けて参ります。</p>

<p>下記よりアプリをダウンロードできますので、是非ご利用ください。</p>

<p><a href="https://itunes.apple.com/jp/app/%E6%B5%AE%E4%B8%96%E7%B5%B5%E5%A3%81%E7%B4%99-%E7%BE%8E%E3%81%97%E3%81%84%E6%97%A5%E6%9C%AC%E7%94%BB%E3%82%AE%E3%83%A3%E3%83%A9%E3%83%AA%E3%83%BC-iphone-6-6-plus-5-ipod%E5%AF%BE%E5%BF%9C/id835559799?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;margin:7px 0 -9px 10px;"></a></p>

<p><a href='https://play.google.com/store/apps/details?id=net.dolice.ukiyoe&pcampaignid=MKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1'><img src='https://play.google.com/intl/ja/badges/images/generic/ja_badge_web_generic.png' style="width: 155px;" /></a></p>

<h2>新たに追加したカテゴリ</h2>

<h3>作者別</h3>

<ul>
<li>歌川国政</li>
<li>歌川房種</li>
<li>歌川国利</li>
<li>歌川芳豊</li>
<li>笠松紫浪</li>
<li>吉田博</li>
<li>伊東深水</li>
<li>小原古邨</li>
<li>長谷川貞信（三代）</li>
<li>鳥居言人</li>
<li>名取春仙</li>
<li>山本昇雲</li>
</ul>


<h2>価格</h2>

<ul>
<li>無料</li>
</ul>


<h2>対応言語</h2>

<ul>
<li>日本語</li>
<li>英語</li>
<li>ロシア語</li>
<li>フランス語</li>
<li>イタリア語</li>
<li>タイ語（Android版のみ）</li>
<li>繁体中国語</li>
</ul>


<h2>著作権表記</h2>

<p>浮世絵は著作権フリー（著作権切れ）の作品のみを選別し、iPhone/Android用の壁紙、または作品集として一枚ずつ丹念に加工・修復しています。</p>

<h2>公式Facebookページ</h2>

<ul>
<li><a href="https://www.facebook.com/dolice.ukiyoe.ja">https://www.facebook.com/dolice.ukiyoe.ja</a></li>
</ul>


<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2014/10/24/ios-ukiyo-e-ja/" title="浮世絵壁紙 - 美しい日本画ギャラリー - iPhone/iPodアプリ">浮世絵壁紙 - 美しい日本画ギャラリー - iPhone/iPodアプリ</a></strong></li>
<li><strong><a href="https://lab.dolice.net/blog/2014/10/24/ios-ukiyo-e-ja/" title="Androidアプリ「浮世絵壁紙 - 美しい日本画ギャラリー」リリース">Androidアプリ「浮世絵壁紙 - 美しい日本画ギャラリー」リリース</a></strong></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iPhoneアプリ「望みが叶う！引き寄せの法則アプリ」アップデート（1.4.0）]]></title>
    <link href="https://lab.dolice.net/blog/2018/01/06/ios-law-of-attraction-update-1-4-0/"/>
    <updated>2018-01-06T10:14:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2018/01/06/ios-law-of-attraction-update-1-4-0</id>
    <content type="html"><![CDATA[<p><img src="https://lab.dolice.net/images/article/law_of_attraction.jpg" title="iPhone App: 望みが叶う！引き寄せの法則アプリ" alt="iPhone App: 望みが叶う！引き寄せの法則アプリ" /></p>

<p>引き寄せの法則を簡単に実践できる iPhoneアプリ「<a href="https://itunes.apple.com/us/app/law-of-attraction-free/id841157677?mt=8" title="望みが叶う！引き寄せの法則アプリ">望みが叶う！引き寄せの法則アプリ</a>」をアップデートしました。</p>

<p>今回のアップデートでは、ご要望の多かった Touch ID / Face IDへの対応および、iPhone Xへの対応を行いました。また、ユーザーの方々よりご報告いただいた幾つかの不具合を修正いたしました。</p>

<p>現在のバージョンから「望み」編集時の文字数制限を廃止し、改行を連続して入力できるよう仕様を変更しております。これにより、より自由な編集が行えるようになりました。</p>

<p>ユーザーの方々から寄せられたご要望はまだ全て反映できておりませんが、今後も丁寧にアップデートを重ねて行きたく思います。</p>

<p>いつも当アプリをご利用いただき、本当にありがとうございます。</p>

<h2>更新内容</h2>

<ol>
<li>Touch ID / Face IDに対応いたしました</li>
<li>「望み」作成時の文字数制限を廃止いたしました</li>
<li>「望み」編集時、改行した際にカーソルが一番下まで移動する不具合を修正いたしました</li>
<li>起動パスワードを7文字までしか設定できない不具合を修正いたしました</li>
<li>iPhone Xに対応いたしました</li>
</ol>


<h2>主な機能</h2>

<ul>
<li>直感的な操作で美しい「望み」を引き寄せ</li>
<li>豊富なサンプル文から自分好みの「望み」を作成</li>
<li>引き寄せの時間を忘れないようプッシュ通知を設定</li>
<li>アプリ起動時のパスワードロック機能（Touch ID / Face ID対応）</li>
<li>iCloudへのバックアップ機能</li>
</ul>


<h2>価格</h2>

<ul>
<li>無料</li>
</ul>


<h2>対応言語</h2>

<ul>
<li>日本語</li>
<li>英語</li>
</ul>


<h2>公式Facebookページ</h2>

<ul>
<li><a href="https://www.facebook.com/dolice.law.of.attraction">https://www.facebook.com/dolice.law.of.attraction</a></li>
</ul>


<h2>アプリのダウンロード</h2>

<p><a href="https://itunes.apple.com/jp/app/%E6%9C%9B%E3%81%BF%E3%81%8C%E5%8F%B6%E3%81%86-%E5%BC%95%E3%81%8D%E5%AF%84%E3%81%9B%E3%81%AE%E6%B3%95%E5%89%87%E3%82%A2%E3%83%97%E3%83%AA/id841157677?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[謹賀新年2018]]></title>
    <link href="https://lab.dolice.net/blog/2018/01/01/happy-new-year-2018/"/>
    <updated>2018-01-01T06:00:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2018/01/01/happy-new-year-2018</id>
    <content type="html"><![CDATA[<p><img src="https://lab.dolice.net/images/article/happy_new_year_2018.jpg" title="Happy New Year 2018" alt="Happy New Year 2018" /></p>

<p>明けましておめでとうございます。旧年中は大変お世話になり、ありがとうございました。皆様に支えられていることを改めて実感した一年でした。</p>

<p>お陰様でアプリの累計ダンロード数が1000万件を突破し、月間アクティブユーザー数は80万人を超えました。5本のアプリがアジア、ヨーロッパ、米国の各国で高ランクを維持しており、平均評価もユーザーの方に恵まれ、4.5/5.0となっております。</p>

<p>相変わらずユーザーの方々から寄せられたレビューを見るのは緊張します。国が異なるので言葉も価値観も、きっと信仰もそれぞれですが、戴いた声から伝わって来るものは同じように感じます。</p>

<p>今後はそうした共通の感覚や感情に訴えるものを作って行きたいです。</p>

<p>2018年が皆様にとって素晴らしい一年であるようお祈り申し上げます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSアプリのテーブルビューにネイティブ広告を表示するサンプル]]></title>
    <link href="https://lab.dolice.net/blog/2016/09/05/objc-native-ads-in-ui-table-view/"/>
    <updated>2016-09-05T12:13:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2016/09/05/objc-native-ads-in-ui-table-view</id>
    <content type="html"><![CDATA[<p>iOSアプリのテーブルビューにネイティブ広告を表示するサンプルを作成しました。</p>

<p>下記にサンプルを公開していますので、実装の際のお役に立てば幸いです。</p>

<h2>サンプルのダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-native-ads-in-ui-table-view">https://github.com/masakihirokawa/objc-native-ads-in-ui-table-view</a></li>
</ul>


<h2>サンプルの解説</h2>

<h3>1. ネイティブ広告の表示頻度と最大表示数を定義</h3>

<p>まずネイティブ広告をリスト何件毎に表示するかと、画面に最大何個まで表示するかを定義しています。</p>

<p>下記の例では、リスト8件毎にネイティブ広告を表示し、画面に最大2個まで表示するよう指定しています。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">int</span> <span class="k">const</span> <span class="n">NATIVE_ADS_PER</span>  <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// ネイティブ広告をリスト何件毎に表示するか</span>
</span><span class='line'><span class="kt">int</span> <span class="k">const</span> <span class="n">NATIVE_ADS_NUM</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// ネイティブ広告を最大何個表示するか</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. ネイティブ広告の表示数によってセルの総数を補正</h3>

<p>ネイティブ広告を表示する分だけセルの総数も補正しなければならないので、まず下記の「<em>nativeAdsNumPerScreen</em>」メソッドから画面に表示するネイティブ広告の総数を取得します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// 画面に表示するネイティブ広告の数を取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nf">nativeAdsNumPerScreen:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">comparisonNum</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SHOW_NATIVE_ADS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="k">const</span> <span class="n">maxDisplayPositionId</span> <span class="o">=</span> <span class="n">NATIVE_ADS_PER</span> <span class="o">*</span> <span class="n">NATIVE_ADS_NUM</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">comparisonNum</span> <span class="o">&gt;=</span> <span class="n">maxDisplayPositionId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">NATIVE_ADS_NUM</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">roundf</span><span class="p">(</span><span class="n">comparisonNum</span> <span class="o">/</span> <span class="n">NATIVE_ADS_PER</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>そして本来のセルの総数にネイティブ広告の数を加え、テーブルビューのセル総数を定義しています。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// セルの総数を指定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">CELL_NUM</span> <span class="o">+</span> <span class="p">[</span><span class="n">self</span> <span class="nl">nativeAdsNumPerScreen:</span><span class="n">CELL_NUM</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. ネイティブ広告を表示するセルの識別子を通常のセルと分けて定義</h3>

<p>セルの識別子は通常のセルとネイティブ広告とで分ける必要があります。</p>

<p>まず、下記の「<em>showNativeAdsByIndexId</em>」メソッドにセルのインデックス値を渡し、ネイティブ広告を表示するインデックス位置であるか取得します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ネイティブ広告を表示するインデックス位置であるか取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">showNativeAdsByIndexId:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">indexId</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SHOW_NATIVE_ADS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">positionId</span> <span class="o">=</span> <span class="p">(</span><span class="n">indexId</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="k">const</span> <span class="n">maxDisplayPositionId</span> <span class="o">=</span> <span class="n">NATIVE_ADS_NUM</span> <span class="o">*</span> <span class="n">NATIVE_ADS_PER</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">positionId</span> <span class="o">&gt;</span> <span class="n">maxDisplayPositionId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">positionId</span> <span class="o">%</span> <span class="n">NATIVE_ADS_PER</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>次に、ネイティブ広告を表示する位置である場合と通常のセルの場合とでセルの識別子を分けます。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// セルの識別子定義</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">CellIdentifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;Cell%lu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">NativeAdsCellIdentifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;NativeAds%lu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ネイティブ広告を表示する位置であるか取得し、セルの識別子を渡す</span>
</span><span class='line'><span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="k">const</span> <span class="n">isNativeAdsPosition</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">showNativeAdsByIndexId:</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">isNativeAdsPosition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">NativeAdsCellIdentifier</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">CellIdentifier</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. ネイティブ広告のセルと通常のセルとで描画処理を分ける</h3>

<p>ネイティブ広告を表示するセルであれば広告を表示し、通常のセルであれば通常のセル内容を表示するよう処理を分けます。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// ネイティブ広告を表示する位置であるか判定</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isNativeAdsPosition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">NativeAdsCellIdentifier</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// TODO: ネイティブ広告表示</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">CellIdentifier</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// TODO: 通常のセル表示</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ここでセルのインデックス値を取得して処理を行う際、そのままの値を使用すると正しく処理できませんので、下記の「<em>correctedIndexId</em>」メソッドに本来のインデックス値を渡し、ネイティブ広告の表示によって生じるインデックス値を補正して受け取る必要があります。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ネイティブ広告の表示によって生じるインデックス補正値を取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nf">nativeAdsCorrectionValue:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">indexId</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SHOW_NATIVE_ADS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">positionId</span> <span class="o">=</span> <span class="p">(</span><span class="n">indexId</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">NATIVE_ADS_NUM</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">positionId</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">NATIVE_ADS_PER</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ネイティブ広告を表示した分だけインデックス値に誤差が生じるため、通常は下記のようにインデックス値を補正して処理を行います。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">corretedIndexId</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">nativeAdsCorrectionValue:</span><span class="n">index</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>5. セルタップ時のイベントを分ける</h3>

<p>セルをタップした時のイベントも下記のように分けます。下記の例では、ネイティブ広告の背景がタップされると選択を解除するよう指定しています。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// セルタップ時のイベント</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// インデックス値の保持</span>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">indexPath</span> <span class="nl">indexAtPosition:</span><span class="p">[</span><span class="n">indexPath</span> <span class="n">length</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: ネイティブ広告を表示した分だけインデックス値に誤差が生じるため、通常はこの値を使用して処理を行う</span>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">corretedIndexId</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">correctedIndexId:</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ネイティブ広告を表示する位置であるか取得し、タップ時の処理を分ける</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="k">const</span> <span class="n">isNativeAdsPosition</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">showNativeAdsByIndexId:</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isNativeAdsPosition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// TODO: ネイティブ広告セルの場合の処理</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ネイティブ広告の背景はタップ禁止のため、セルの選択を解除する必要がある</span>
</span><span class='line'>        <span class="p">[</span><span class="n">tableView</span> <span class="nl">deselectRowAtIndexPath:</span><span class="n">indexPath</span> <span class="nl">animated:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// デバッグ出力</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;NativeAds&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// TODO: 通常セルの場合の処理</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// デバッグ出力</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;corretedIndexId: %lu&quot;</span><span class="p">,</span> <span class="n">corretedIndexId</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上でテーブルビューへのネイティブ広告の導入は完了です。</p>

<p>まずネイティブ広告を表示する位置であるか判別し、通常のセルの描画を行う際には、ネイティブ広告の表示によって生じるインデックス値の誤差を埋めた補正値を使用して処理を行う点が重要です。</p>

<p>解り辛い説明となりましたが、下記にサンプルソースコードを記載いたしますので、導入の際のご参考になれば幸いです。</p>

<h2>サンプルソースコード</h2>

<h3>ViewController.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span> <span class="o">&lt;</span><span class="n">UITableViewDelegate</span><span class="p">,</span> <span class="n">UITableViewDataSource</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ViewController.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="n">UITableView</span> <span class="o">*</span><span class="n">sampleList</span><span class="p">;</span> <span class="c1">// サンプルリスト</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'>
</span><span class='line'><span class="n">CGFloat</span>    <span class="k">const</span> <span class="n">CELL_HEIGHT</span>     <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// セルの縦幅</span>
</span><span class='line'><span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">CELL_NUM</span>        <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>  <span class="c1">// セルの総数</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>        <span class="k">const</span> <span class="n">NATIVE_ADS_PER</span>  <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>   <span class="c1">// ネイティブ広告をリスト何件毎に表示するか</span>
</span><span class='line'><span class="kt">int</span>        <span class="k">const</span> <span class="n">NATIVE_ADS_NUM</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>   <span class="c1">// ネイティブ広告を最大何個表示するか</span>
</span><span class='line'><span class="kt">BOOL</span>       <span class="k">const</span> <span class="n">SHOW_NATIVE_ADS</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span> <span class="c1">// ネイティブ広告を表示するか</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// サンプルリスト配置</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="n">setSampleList</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Sample List</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// サンプルリスト配置</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setSampleList</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">sampleListWidth</span>  <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">sampleListHeight</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
</span><span class='line'>    <span class="n">_sampleList</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">sampleListWidth</span><span class="p">,</span> <span class="n">sampleListHeight</span><span class="p">)</span>
</span><span class='line'>                                               <span class="nl">style:</span><span class="n">UITableViewStylePlain</span><span class="p">];</span>
</span><span class='line'>    <span class="n">_sampleList</span><span class="p">.</span><span class="n">delegate</span>        <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>    <span class="n">_sampleList</span><span class="p">.</span><span class="n">dataSource</span>      <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>    <span class="n">_sampleList</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class='line'>    <span class="n">_sampleList</span><span class="p">.</span><span class="n">separatorStyle</span>  <span class="o">=</span> <span class="n">UITableViewCellSeparatorStyleNone</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">_sampleList</span> <span class="nl">registerClass:</span><span class="p">[</span><span class="n">UITableViewCell</span> <span class="n">class</span><span class="p">]</span> <span class="nl">forCellReuseIdentifier:</span><span class="s">@&quot;Cell&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_sampleList</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Table View</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// インデックス値の保持</span>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">indexPath</span> <span class="nl">indexAtPosition:</span><span class="p">[</span><span class="n">indexPath</span> <span class="n">length</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// セルの識別子定義</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">CellIdentifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;Cell%lu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">NativeAdsCellIdentifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;NativeAds%lu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ネイティブ広告を表示する位置であるか取得し、セルの識別子を渡す</span>
</span><span class='line'>    <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="k">const</span> <span class="n">isNativeAdsPosition</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">showNativeAdsByIndexId:</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isNativeAdsPosition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">NativeAdsCellIdentifier</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">CellIdentifier</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// サンプルラベルの座標と寸法定義</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">labelX</span>      <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">labelWidth</span>  <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">labelX</span><span class="p">;</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="k">const</span> <span class="n">labelHeight</span> <span class="o">=</span> <span class="n">CELL_HEIGHT</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ネイティブ広告を表示する位置であるか判定</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isNativeAdsPosition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">NativeAdsCellIdentifier</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// TODO: ネイティブ広告表示</span>
</span><span class='line'>            <span class="n">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">labelX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">labelWidth</span><span class="p">,</span> <span class="n">labelHeight</span><span class="p">)];</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;NativeAds&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="n">NSTextAlignmentLeft</span><span class="p">;</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">numberOfLines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">clearColor</span><span class="p">];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">cell</span><span class="p">.</span><span class="n">contentView</span> <span class="nl">addSubview:</span><span class="n">label</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">CellIdentifier</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// TODO: 通常のセル表示</span>
</span><span class='line'>            <span class="n">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">labelX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">labelWidth</span><span class="p">,</span> <span class="n">labelHeight</span><span class="p">)];</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;List - %lu&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">self</span> <span class="nl">correctedIndexId:</span><span class="n">index</span><span class="p">]];</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="n">NSTextAlignmentLeft</span><span class="p">;</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">numberOfLines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>            <span class="n">label</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">clearColor</span><span class="p">];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">cell</span><span class="p">.</span><span class="n">contentView</span> <span class="nl">addSubview:</span><span class="n">label</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// セルタップ時のイベント</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// インデックス値の保持</span>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">indexPath</span> <span class="nl">indexAtPosition:</span><span class="p">[</span><span class="n">indexPath</span> <span class="n">length</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// TODO: ネイティブ広告を表示した分だけインデックス値に誤差が生じるため、通常はこの値を使用して処理を行う</span>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">corretedIndexId</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">correctedIndexId:</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ネイティブ広告を表示する位置であるか取得し、タップ時の処理を分ける</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="k">const</span> <span class="n">isNativeAdsPosition</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">showNativeAdsByIndexId:</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">isNativeAdsPosition</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// TODO: ネイティブ広告セルの場合の処理</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// ネイティブ広告の背景はタップ禁止のため、セルの選択を解除する必要がある</span>
</span><span class='line'>        <span class="p">[</span><span class="n">tableView</span> <span class="nl">deselectRowAtIndexPath:</span><span class="n">indexPath</span> <span class="nl">animated:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// デバッグ出力</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;NativeAds&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// TODO: 通常セルの場合の処理</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// デバッグ出力</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;corretedIndexId: %lu&quot;</span><span class="p">,</span> <span class="n">corretedIndexId</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// セルの総数を指定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">cellNum</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">cellNum</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">cellNum</span> <span class="o">+</span> <span class="p">[</span><span class="n">self</span> <span class="nl">nativeAdsNumPerScreen:</span><span class="n">cellNum</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// セルの総数を返す</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">cellNum</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">CELL_NUM</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// セルのセクション数を設定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">numberOfSectionsInTableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// セル高さを設定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">CELL_HEIGHT</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// セルの背景色指定</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>  <span class="nf">willDisplayCell:</span><span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nv">cell</span> <span class="nf">forRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Native Ads</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ネイティブ広告を表示するインデックス位置であるか取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">showNativeAdsByIndexId:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">indexId</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SHOW_NATIVE_ADS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">positionId</span> <span class="o">=</span> <span class="p">(</span><span class="n">indexId</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="k">const</span> <span class="n">maxDisplayPositionId</span> <span class="o">=</span> <span class="n">NATIVE_ADS_NUM</span> <span class="o">*</span> <span class="n">NATIVE_ADS_PER</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">positionId</span> <span class="o">&gt;</span> <span class="n">maxDisplayPositionId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">positionId</span> <span class="o">%</span> <span class="n">NATIVE_ADS_PER</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ネイティブ広告の表示分を補正したインデックス値の取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">correctedIndexId:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">indexId</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">indexId</span> <span class="o">-</span> <span class="p">[</span><span class="n">self</span> <span class="nl">nativeAdsCorrectionValue:</span><span class="n">indexId</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ネイティブ広告の表示によって生じるインデックス補正値を取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nf">nativeAdsCorrectionValue:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">indexId</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SHOW_NATIVE_ADS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSUInteger</span> <span class="k">const</span> <span class="n">positionId</span> <span class="o">=</span> <span class="p">(</span><span class="n">indexId</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">NATIVE_ADS_NUM</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">positionId</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">NATIVE_ADS_PER</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 画面に表示するネイティブ広告の数を取得</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nf">nativeAdsNumPerScreen:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">comparisonNum</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SHOW_NATIVE_ADS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="k">const</span> <span class="n">maxDisplayPositionId</span> <span class="o">=</span> <span class="n">NATIVE_ADS_PER</span> <span class="o">*</span> <span class="n">NATIVE_ADS_NUM</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">comparisonNum</span> <span class="o">&gt;=</span> <span class="n">maxDisplayPositionId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">NATIVE_ADS_NUM</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">roundf</span><span class="p">(</span><span class="n">comparisonNum</span> <span class="o">/</span> <span class="n">NATIVE_ADS_PER</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2016/09/04/objc-classes-dc-admob-native-ads/" title="iOSアプリに AdMobネイティブ広告を表示するクラスを作成しました">iOSアプリに AdMobネイティブ広告を表示するクラスを作成しました</a></strong></li>
</ul>


<h2>お薦めの参考書</h2>

<p><strong><a href="https://www.amazon.co.jp/gp/product/4797384514/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797384514&linkCode=as2&tag=pinocchio-22">本気ではじめるiPhoneアプリ作り Xcode 7.x+Swift 2.x対応</a></strong><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=pinocchio-22&l=as2&o=9&a=4797384514" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br />
iOSアプリ開発をこれから始める方に最もお薦めな一冊です。解り辛い点は図解入りで解説されており、プログラミングの動作の仕組みから詳しく知ることができます。基本から通信処理まで押さえられており、アプリ公開の手順についても解説されています。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSアプリに AdMobネイティブ広告を表示するクラスを作成しました]]></title>
    <link href="https://lab.dolice.net/blog/2016/09/04/objc-classes-dc-admob-native-ads/"/>
    <updated>2016-09-04T11:58:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2016/09/04/objc-classes-dc-admob-native-ads</id>
    <content type="html"><![CDATA[<p>iOSアプリに AdMobネイティブ広告を表示する「<a href="https://github.com/masakihirokawa/objc-classes-dc-admob-native-ads" title="DCAdMobNativeAds">DCAdMobNativeAds</a>」クラスを作成しました。</p>

<p>下記よりダウンロード出来ますので、実装の際のお役に立てば幸いです。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-admob-native-ads">https://github.com/masakihirokawa/objc-classes-dc-admob-native-ads</a></li>
</ul>


<h2>使用方法</h2>

<h3>A. ネイティブ広告を指定したビューに配置</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">CGFloat</span> <span class="k">const</span> <span class="n">nativeAdsWidth</span>  <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'><span class="n">CGFloat</span> <span class="k">const</span> <span class="n">nativeAdsHeight</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">UIView</span> <span class="o">*</span><span class="n">nativeAdsView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">nativeAdsWidth</span><span class="p">,</span> <span class="n">nativeAdsHeight</span><span class="p">)];</span>
</span><span class='line'><span class="p">[[</span><span class="n">DCAdMobNativeAds</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">showNativeAd:</span><span class="n">self</span> <span class="nl">targetView:</span><span class="n">nativeAdsView</span>
</span><span class='line'>                                         <span class="nl">frame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">nativeAdsWidth</span><span class="p">,</span> <span class="n">nativeAdsHeight</span><span class="p">)];</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubView:</span><span class="n">nativeAdsView</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>B. ネイティブ広告を取得し配置</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">CGFloat</span> <span class="k">const</span> <span class="n">nativeAdsWidth</span>  <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
</span><span class='line'><span class="n">CGFloat</span> <span class="k">const</span> <span class="n">nativeAdsHeight</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">UIView</span> <span class="o">*</span><span class="n">nativeAdsView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCAdMobNativeAds</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">nativeAd:</span><span class="n">self</span>
</span><span class='line'>                                                             <span class="nl">frame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">nativeAdsWidth</span><span class="p">,</span> <span class="n">nativeAdsHeight</span><span class="p">)];</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubView:</span><span class="n">nativeAdsView</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ネイティブ広告の寸法について</h2>

<p>AdMobネイティブ広告の縦幅は、80dp 以上である必要があります。それ未満のサイズを指定するとエラー取得時のデリゲートメソッドが呼ばれ、広告は表示されません。</p>

<p>横幅の最小値については未検証ですが、ネイティブ広告のユニット作成時にプレビューサイズを指定する際、280dp 以上である必要がありますので、恐らく 280dp が最小値だと思います。</p>

<p>iPhoneは 4-inch/ 4.7-inch/ 5.5-inch で横幅が異なりますので、今回のサンプルでは横幅一杯に指定する方法を取っています。</p>

<p>ネイティブ広告初期化の際、下記のように縦幅 80dp 以上のサイズを指定することで正常に表示されました。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">CGSize</span> <span class="k">const</span> <span class="n">nativeAdsSize</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">([[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">);</span>
</span><span class='line'><span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADNativeExpressAdView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdSize:</span><span class="n">GADAdSizeFromCGSize</span><span class="p">(</span><span class="n">nativeAdsSize</span><span class="p">)</span>
</span><span class='line'>                                                                       <span class="nl">origin:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ソースコード</h2>

<h3>DCAdMobNativeAds.h</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">import</span> <span class="n">GoogleMobileAds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">DCAdMobNativeAds</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">GADNativeExpressAdViewDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="n">nativeExpressAdView</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - property</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="n">nativeExpressAdView</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showNativeAd:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">targetView:</span><span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nv">targetView</span> <span class="nf">frame:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">nativeAd:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">frame:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>DCAdMobNativeAds.m</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCAdMobNativeAds.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">DCAdMobNativeAds</span>
</span><span class='line'>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">nativeExpressAdView</span> <span class="o">=</span> <span class="n">nativeExpressAdView</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">CGFloat</span> <span class="k">const</span> <span class="n">GAD_NATIVE_UNIT_ID</span> <span class="o">=</span> <span class="s">@&quot;Your Unit ID here&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kt">BOOL</span>    <span class="k">const</span> <span class="n">GAD_TEST_MODE</span>      <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Shared Manager</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">id</span> <span class="n">sharedInstance</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">sharedManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">@synchronized</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sharedInstance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">sharedInstance</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">sharedInstance</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">showNativeAd:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">targetView:</span><span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nv">targetView</span> <span class="nf">frame:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADNativeExpressAdView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdSize:</span><span class="n">GADAdSizeFromCGSize</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
</span><span class='line'>                                                                       <span class="nl">origin:</span><span class="n">frame</span><span class="p">.</span><span class="n">origin</span><span class="p">];</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">.</span><span class="n">adUnitID</span> <span class="o">=</span> <span class="n">GAD_NATIVE_UNIT_ID</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">targetView</span> <span class="nl">addSubview:</span><span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GADRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">GADRequest</span> <span class="n">request</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">GAD_TEST_MODE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">request</span><span class="p">.</span><span class="n">testDevices</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="n">kGADSimulatorID</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span> <span class="nl">loadRequest:</span><span class="n">request</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">nativeAd:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">frame:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GADNativeExpressAdView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithAdSize:</span><span class="n">GADAdSizeFromCGSize</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
</span><span class='line'>                                                                       <span class="nl">origin:</span><span class="n">frame</span><span class="p">.</span><span class="n">origin</span><span class="p">];</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">.</span><span class="n">adUnitID</span> <span class="o">=</span> <span class="n">GAD_NATIVE_UNIT_ID</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GADRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">GADRequest</span> <span class="n">request</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">GAD_TEST_MODE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">request</span><span class="p">.</span><span class="n">testDevices</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="n">kGADSimulatorID</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span> <span class="nl">loadRequest:</span><span class="n">request</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">nativeExpressAdView</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - delegate method</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">nativeExpressAdViewDidReceiveAd:</span><span class="p">(</span><span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="p">)</span><span class="nv">nativeExpressAdView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;nativeExpressAdViewDidReceiveAd&quot;);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">nativeExpressAdView:</span><span class="p">(</span><span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="p">)</span><span class="nv">nativeExpressAdView</span> <span class="nf">didFailToReceiveAdWithError:</span><span class="p">(</span><span class="n">GADRequestError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;nativeExpressAdView: didFailToReceiveAdWithError&quot;);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">nativeExpressAdViewWillPresentScreen:</span><span class="p">(</span><span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="p">)</span><span class="nv">nativeExpressAdView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;nativeExpressAdViewWillPresentScreen&quot;);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">nativeExpressAdViewWillDismissScreen:</span><span class="p">(</span><span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="p">)</span><span class="nv">nativeExpressAdView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;nativeExpressAdViewWillDismissScreen&quot;);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">nativeExpressAdViewDidDismissScreen:</span><span class="p">(</span><span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="p">)</span><span class="nv">nativeExpressAdView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;nativeExpressAdViewDidDismissScreen&quot;);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">nativeExpressAdViewWillLeaveApplication:</span><span class="p">(</span><span class="n">GADNativeExpressAdView</span> <span class="o">*</span><span class="p">)</span><span class="nv">nativeExpressAdView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//NSLog(@&quot;nativeExpressAdViewWillLeaveApplication&quot;);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>関連記事</h2>

<ul>
<li><strong><a href="https://lab.dolice.net/blog/2016/09/05/objc-native-ads-in-ui-table-view/" title="iOSアプリのテーブルビューにネイティブ広告を表示するサンプル">iOSアプリのテーブルビューにネイティブ広告を表示するサンプル</a></strong></li>
</ul>


<h2>お薦めの参考書</h2>

<p><strong><a href="https://www.amazon.co.jp/gp/product/4797384514/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797384514&linkCode=as2&tag=pinocchio-22">本気ではじめるiPhoneアプリ作り Xcode 7.x+Swift 2.x対応</a></strong><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=pinocchio-22&l=as2&o=9&a=4797384514" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br />
iOSアプリ開発をこれから始める方に最もお薦めな一冊です。解り辛い点は図解入りで解説されており、プログラミングの動作の仕組みから詳しく知ることができます。基本から通信処理まで押さえられており、アプリ公開の手順についても解説されています。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[技術評論社「自律神経を整えるスマホアプリ100選」に掲載いただきました]]></title>
    <link href="https://lab.dolice.net/blog/2016/01/22/ios-gijutsu-hyohron-autonomic-nerves/"/>
    <updated>2016-01-22T00:00:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2016/01/22/ios-gijutsu-hyohron-autonomic-nerves</id>
    <content type="html"><![CDATA[<p><img src="https://lab.dolice.net/images/article/gijutsu-hyohron-autonomic-nerves.jpg" title="技術評論社「自律神経を整えるスマホアプリ100選」" alt="技術評論社「自律神経を整えるスマホアプリ100選」" /></p>

<p>技術評論社様より1月22日に発行された「<a href="http://gihyo.jp/book/2016/978-4-7741-7848-6" title="自律神経を整えるスマホアプリ100選">自律神経を整えるスマホアプリ100選</a>」という書籍にて、iPhoneアプリ「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>（<em>P 43</em>）」と「<a href="https://itunes.apple.com/us/app/law-of-attraction-free/id841157677?mt=8" title="望みが叶う！引き寄せの法則アプリ">望みが叶う！引き寄せの法則アプリ</a>（<em>P 75</em>）」の両アプリをご紹介いただきました。</p>

<p>全体的にアプリの特長が分かりやすく解説されており、QRコードからストアへのアクセスも容易になっています。他にも実用的なアプリが多数紹介されていますので、ご興味のある方は是非お手にとってご覧ください。</p>

<h2>書籍の詳細ページ</h2>

<ul>
<li><a href="http://gihyo.jp/book/2016/978-4-7741-7848-6" title="自律神経を整えるスマホアプリ100選：書籍案内｜技術評論社">自律神経を整えるスマホアプリ100選：書籍案内｜技術評論社</a></li>
</ul>


<h2>掲載アプリ</h2>

<h3>リラックス・ヒーリング</h3>

<p>α波発生に効果的なヒーリング音楽、雨音や森の中の小鳥のさえずりなどのサウンドを聴きながら、リラックスして深い眠りに。勉強や仕事に打ち込む時の集中力アップ目的での活用もできます。</p>

<p><a href="https://itunes.apple.com/jp/app/%E3%83%AA%E3%83%A9%E3%83%83%E3%82%AF%E3%82%B9-%E3%83%92%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0-%E5%BF%83%E5%9C%B0%E8%89%AF%E3%81%84%E7%9D%A1%E7%9C%A0%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%81%A8%E7%9B%AE%E8%A6%9A%E3%81%BE%E3%81%97%E6%99%82%E8%A8%88-%E7%84%A1%E6%96%99/id694492667?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>

<h3>望みが叶う！引き寄せの法則アプリ</h3>

<p>「恋愛」「就活」「美容」「復縁」… 1日たったの3分で望みが叶う、あの「引き寄せの法則」を実践できる無料アプリです。豊富なサンプル文を組み合わせて、簡単にあなただけの「望み」を作成。プッシュ通知で引き寄せの「習慣化」ができます。</p>

<p><a href="https://itunes.apple.com/jp/app/%E6%9C%9B%E3%81%BF%E3%81%8C%E5%8F%B6%E3%81%86-%E5%BC%95%E3%81%8D%E5%AF%84%E3%81%9B%E3%81%AE%E6%B3%95%E5%89%87%E3%82%A2%E3%83%97%E3%83%AA/id841157677?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Androidアプリ「浮世絵壁紙 - 美しい日本画ギャラリー」リリース]]></title>
    <link href="https://lab.dolice.net/blog/2015/12/07/android-ukiyo-e/"/>
    <updated>2015-12-07T12:28:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2015/12/07/android-ukiyo-e</id>
    <content type="html"><![CDATA[<p><img src="https://lab.dolice.net/images/article/ukiyo-e_android.jpg" title="Android app: 浮世絵壁紙 - 美しい日本画ギャラリー" alt="Android app: 浮世絵壁紙 - 美しい日本画ギャラリー" /></p>

<p>日本の浮世絵を1000枚以上掲載したアプリ「<a href="https://play.google.com/store/apps/details?id=net.dolice.ukiyoe" title="浮世絵壁紙 - 美しい日本画ギャラリー">浮世絵壁紙 - 美しい日本画ギャラリー</a>」をリリースしました。</p>

<p>葛飾北斎、歌川広重、東洲斎写楽などの名作を、現代風に加工・修復しています。古紙独特の皺や染みを一つずつ丹念に消去し、浮世絵の持つ目の覚めるような紅や藍の色合いも、均一のトーンを保持しつつ再現するよう努めました。</p>

<p>このアプリが日本画の美しさを国内外の方に再認識していただく切っ掛けになることを願っています。</p>

<p>下記からアプリを無料でダウンロードできますので、是非ご利用ください。</p>

<p><a href='https://play.google.com/store/apps/details?id=net.dolice.ukiyoe&pcampaignid=MKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1'><img src='https://play.google.com/intl/ja/badges/images/generic/ja_badge_web_generic.png' style="width: 150px;" /></a></p>

<h2>浮世絵のカテゴリ</h2>

<h3>年代別</h3>

<ul>
<li>1780年〜1804年</li>
<li>1804年〜1868年</li>
<li>1868年〜1912年</li>
<li>1915年〜1940年代</li>
</ul>


<h3>作者別</h3>

<ul>
<li>東洲斎写楽</li>
<li>喜多川歌麿</li>
<li>歌川国政</li>
<li>葛飾北斎</li>
<li>歌川広重</li>
<li>歌川国貞</li>
<li>歌川国芳</li>
<li>歌川房種</li>
<li>歌川国利</li>
<li>歌川芳豊</li>
<li>笠松紫浪</li>
<li>吉田博</li>
<li>伊東深水</li>
<li>小原古邨</li>
<li>藤島武二</li>
<li>橋口五葉</li>
<li>長谷川貞信（三代）</li>
<li>鳥居言人</li>
<li>名取春仙</li>
<li>山本昇雲</li>
<li>浅野武二</li>
</ul>


<h3>その他</h3>

<ul>
<li>和柄</li>
<li>シンプル</li>
</ul>


<h2>主な機能</h2>

<ol>
<li>簡単操作で壁紙を保存</li>
<li>最新や人気の壁紙の一覧表示</li>
<li>作者・年代別のカテゴリ表示</li>
<li>壁紙のお気に入り追加機能</li>
<li>壁紙のサムネイル一覧表示</li>
<li>壁紙のフルスクリーン表示</li>
<li>壁紙共有機能</li>
<li>壁紙の更新通知</li>
</ol>


<h2>壁紙のサイズ</h2>

<ul>
<li>1440 × 2560ピクセル（<em>WQHD</em>）</li>
<li>1080 × 1920ピクセル（<em>FHD</em>）</li>
<li>720 × 1280ピクセル（<em>HD</em>）</li>
<li>480 × 800ピクセル（<em>WVGA</em>）</li>
<li>2560 × 1600ピクセル（<em>WQXGA</em>）</li>
<li>1200 × 1920ピクセル（<em>WUXGA</em>）</li>
</ul>


<h2>価格</h2>

<ul>
<li>無料</li>
</ul>


<h2>対応言語</h2>

<ul>
<li>日本語</li>
<li>英語</li>
<li>ロシア語</li>
<li>フランス語</li>
<li>イタリア語</li>
<li>タイ語</li>
<li>繁体中国語</li>
</ul>


<h2>著作権表記</h2>

<p>浮世絵は著作権切れの作品のみを選別し、Android用の壁紙、または作品集として一枚ずつ丹念に加工・修復しています。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iPhoneアプリ「リラックス・ヒーリング」アップデート]]></title>
    <link href="https://lab.dolice.net/blog/2015/08/13/ios-relaxing-healing/"/>
    <updated>2015-08-13T13:14:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2015/08/13/ios-relaxing-healing</id>
    <content type="html"><![CDATA[<p>ヒーリング音楽や自然の音を聴いてリラックスできる無料アプリ「<a href="https://itunes.apple.com/us/app/hearing-healing/id694492667?mt=8" title="リラックス・ヒーリング">リラックス・ヒーリング</a>」をアップデートいたしました。</p>

<p>今回のアップデートでは、デザインの全面リニューアルを実施し、他には動作速度の向上や設定項目の追加などを行いました。</p>

<p>下記よりアプリをダウンロードできますので、是非ご利用ください。</p>

<p><a href="https://itunes.apple.com/jp/app/%E3%83%AA%E3%83%A9%E3%83%83%E3%82%AF%E3%82%B9-%E3%83%92%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0-%E5%BF%83%E5%9C%B0%E8%89%AF%E3%81%84%E7%9D%A1%E7%9C%A0%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%81%A8%E7%9B%AE%E8%A6%9A%E3%81%BE%E3%81%97%E6%99%82%E8%A8%88-%E7%84%A1%E6%96%99/id694492667?mt=8" style="display:inline-block;overflow:hidden;background:url(//linkmaker.itunes.apple.com/assets/shared/badges/ja-jp/appstore-lrg.svg) no-repeat;width:135px;height:40px;background-size:contain;"></a></p>

<h2>このアプリについて</h2>

<p>α波発生に効果的なヒーリング音楽、雨音や森の中の小鳥のさえずりなどのサウンドを聴きながら、リラックスして深い眠りに就くことができます。</p>

<p>ストレスの軽減や寝付きが悪い時の対策、それから心身の疲れに効果があります。</p>

<p>ホワイトノイズも収録していますので、仕事や勉強に打ち込む時の作業用BGMにもお薦めです。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing/relaxing_healing_screenshot1.jpg" title="ミュージック画面" alt="ミュージック画面" /></p>

<p>5曲のヒーリング音楽と 11種の環境音を収録しています。ヒーリング音楽は全曲連続で再生したり、一曲リピートさせることもできます。現在、約1時間分のヒーリング音楽を収録しています。</p>

<p>バックグラウンド再生もサポートしていますので、他のアプリを操作しながらでも音楽やサウンドをお楽しみいただけます。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing/relaxing_healing_screenshot2.jpg" title="サウンド画面" alt="サウンド画面" /></p>

<p>雨音などの環境音は、設定した時間が来ると徐々に音量を下げながら停止しますので、睡眠の妨げにはなりません。</p>

<p>眠る前に、例えば小川のせせらぎなどを流したまま、リラックスした頃に知らず知らずと心地よい睡眠に入ることができます。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing/relaxing_healing_screenshot3.jpg" title="アラーム画面" alt="アラーム画面" /></p>

<p>目覚まし機能も搭載しており、5種類のアラーム音から選んで使用できます。音楽やサウンドを流したままアラームを設定しても、起床時刻と同時に停止するので安心です。</p>

<p><img src="https://lab.dolice.net/images/article/relaxing_healing/relaxing_healing_screenshot4.jpg" title="設定画面" alt="設定画面" /></p>

<p>設定画面では、ミュージック／サウンド／アラームの音量変更や、ミュージックのリピート設定、サウンドの再生時間設定などが行えます。</p>

<p>今回のアップデートで、アラーム使用時の画面輝度を設定できるようになり、起動時の画面も選択できるようになりました。</p>

<h2>収録内容</h2>

<p>ヒーリング音楽は下記の5曲を収録しています（4曲目と5曲目は、アプリ内から購入いただくと聴く事ができます）。</p>

<h3>ヒーリング音楽</h3>

<ol>
<li>ストレス解消ヒーリング音楽（α波）[10:25]</li>
<li>神秘的なヒーリング音楽 [16:51]</li>
<li>快適な眠りを誘う癒しの音楽（α波）[15:31]</li>
<li>体に優しい癒しの音楽 [06:34]</li>
<li>さざなみヒーリング音楽 [09:47]</li>
</ol>


<p>サウンドは下記の11項目を全て無料でお聞きいただけます。</p>

<h3>サウンド</h3>

<ol>
<li>雨音と川のせせらぎ</li>
<li>夕立の雨音</li>
<li>雰囲気に満ちた豪雨の音</li>
<li>雨とカエルの鳴き声</li>
<li>ルイジアナの雨音</li>
<li>鳥の鳴き声</li>
<li>雪解け水の音</li>
<li>波の音</li>
<li>ホワイトノイズ</li>
<li>森林浴</li>
<li>フクロウの鳴き声</li>
</ol>


<p>アラーム音は下記から好きな音を選択できます（お薦めは「アナログ目覚まし時計」です！）。</p>

<h3>アラーム音</h3>

<ol>
<li>アナログ目覚まし時計</li>
<li>デジタル目覚まし時計</li>
<li>目覚ましベル</li>
<li>ビープ音</li>
<li>警報音</li>
</ol>


<h2>主な機能</h2>

<ul>
<li>ヒーリングミュージック再生機能（5曲）</li>
<li>ヒーリングミュージックのオールプレイ機能</li>
<li>雨音や環境音の再生機能（11サウンド）</li>
<li>目覚まし機能（5種のアラーム音を搭載）</li>
</ul>


<h2>価格</h2>

<ul>
<li>無料（App内購入あり）</li>
</ul>


<h2>対応言語</h2>

<ul>
<li>日本語</li>
<li>英語</li>
</ul>


<h2>Facebook公式ページ</h2>

<ul>
<li><a href="https://www.facebook.com/dolice.hearing.healing">https://www.facebook.com/dolice.hearing.healing</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSでアプリ内課金をする「DCInAppPurchase」クラス]]></title>
    <link href="https://lab.dolice.net/blog/2015/06/28/objc-classes-dc-in-app-purchase/"/>
    <updated>2015-06-28T12:55:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2015/06/28/objc-classes-dc-in-app-purchase</id>
    <content type="html"><![CDATA[<p>iOSでアプリ内課金をする「<a href="https://github.com/masakihirokawa/objc-classes-dc-in-app-purchase" title="DCInAppPurchase">DCInAppPurchase</a>」クラスを GitHub に公開しました。</p>

<p>購入対象のプロダクトIDと、呼び出し元のビューを渡して購入／リストア処理を行います。</p>

<p>このクラスの使用には、<em>StoreKit</em> フレームワークが必要になります。</p>

<h2>ダウンロード</h2>

<ul>
<li><a href="https://github.com/masakihirokawa/objc-classes-dc-in-app-purchase">https://github.com/masakihirokawa/objc-classes-dc-in-app-purchase</a></li>
</ul>


<h2>導入手順</h2>

<h3>1. グローバル定義</h3>

<p>プロジェクトの <em>*.pch</em> ファイルでクラスのインスタンスを定義し、どこからでも呼び出せるようグローバル化します。</p>

<h4>*.pch</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;DCInAppPurchase.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">DCInAppPurchase</span> <span class="o">*</span><span class="n">inAppPurchase</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. 初期化</h3>

<p><em>AppDelegate.m</em> でアプリ起動時に初期化します。</p>

<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">inAppPurchase</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DCInAppPurchase</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. アイテム付与部分の実装</h3>

<p><em>DCInAppPurchase.m</em> の 137〜142行目にある <em>provideContent</em> 内に購入完了時の処理を記述します。</p>

<h4>DCInAppPurchase.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">provideContent:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productIdentifier</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// TODO: ここでアイテム付与を行う</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>使用方法</h2>

<h3>アイテムの購入</h3>

<p>アイテムのプロダクトIDを渡してアイテムの購入処理を開始します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">inAppPurchase</span> <span class="nl">startPurchase:</span><span class="s">@&quot;Product ID&quot;</span> <span class="nl">view:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>アイテムのリストア</h3>

<p>アイテムのプロダクトIDを渡してアイテムのリストア処理を開始します。</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">inAppPurchase</span> <span class="nl">restorePurchase:</span><span class="s">@&quot;Product ID&quot;</span> <span class="nl">view:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上が導入から使用までの流れになります。</p>

<p>2013年に作成したもののため大雑把な造りですが、現在リリース中のアプリで動作確認済みです。</p>

<h2>お薦めの参考書</h2>

<p><strong><a href="https://www.amazon.co.jp/gp/product/4797386258/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797386258&linkCode=as2&tag=pinocchio-22">詳解 Swift 改訂版</a></strong><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=pinocchio-22&l=as2&o=9&a=4797386258" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br />
Swiftのかなり入り込んだところまで解説しながら、実践コードを多数収録しています。応用本になりますので、入門書を読み終えて中級者から上級者に差し掛かる時に読むことをお勧めします。読み物としてだけではなくリファレンスとしても使用できます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSアプリへの Google Analytics 導入方法]]></title>
    <link href="https://lab.dolice.net/blog/2015/06/26/ios-google-analytics/"/>
    <updated>2015-06-26T12:53:00+09:00</updated>
    <id>https://lab.dolice.net/blog/2015/06/26/ios-google-analytics</id>
    <content type="html"><![CDATA[<p>iOSアプリに Google Analytics を導入する方法を以下に記載します。</p>

<p>当記事では、カスタムクラスを使用してスクリーントラッキングとイベントトラッキングを行っています。</p>

<h2>導入手順</h2>

<h3>1. Google Analytics SDKのダウンロード</h3>

<p><a href="https://developers.google.com/analytics/devguides/collection/ios/resources?hl=ja" title="Downloads - iOS SDK | Google Analytics | Google Developers">Downloads - iOS SDK | Google Analytics | Google Developers</a> より最新のSDKをダウンロードし、プロジェクトに追加します。</p>

<ul>
<li><a href="https://developers.google.com/analytics/devguides/collection/ios/resources?hl=ja">https://developers.google.com/analytics/devguides/collection/ios/resources?hl=ja</a></li>
</ul>


<h3>2. フレームワークの追加</h3>

<p>下記 5つのフレームワークをプロジェクトに追加します。</p>

<ul>
<li>libsqlite3.0.dylib</li>
<li>libz.dylib</li>
<li>SystemConfiguration.framework</li>
<li>CoreData.framework</li>
<li>AdSupport.framework</li>
</ul>


<h3>3. カスタムクラスの追加</h3>

<p>下記のカスタムクラスをプロジェクトに追加します。</p>

<h4>TrackingManager.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'><span class="cp">#import &quot;GAI.h&quot;</span>
</span><span class='line'><span class="cp">#import &quot;GAIFields.h&quot;</span>
</span><span class='line'><span class="cp">#import &quot;GAIDictionaryBuilder.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">TrackingManager</span> : <span class="nc">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - public method</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendScreenTracking:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">screenName</span><span class="p">;</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendEventTracking:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">category</span> <span class="nf">action:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">action</span> <span class="nf">label:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">label</span> <span class="nf">value:</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span><span class="p">)</span><span class="nv">value</span> <span class="nf">screen:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">screen</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>TrackingManager.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;TrackingManager.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">TrackingManager</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// スクリーン名を GoogleAnalyticsに送信する</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendScreenTracking:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">screenName</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">id</span><span class="o">&lt;</span><span class="n">GAITracker</span><span class="o">&gt;</span> <span class="n">tracker</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GAI</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="n">defaultTracker</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// スクリーン名を設定</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tracker</span> <span class="nl">set:</span><span class="n">kGAIScreenName</span> <span class="nl">value:</span><span class="n">screenName</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// トラッキング情報を送信する</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tracker</span> <span class="nl">send:</span><span class="p">[[</span><span class="n">GAIDictionaryBuilder</span> <span class="n">createScreenView</span><span class="p">]</span> <span class="n">build</span><span class="p">]];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 送信が終わったらtrackerに設定されているスクリーン名を初期化する</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tracker</span> <span class="nl">set:</span><span class="n">kGAIScreenName</span> <span class="nl">value:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// イベントを GoogleAnalyticsに送信する</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">sendEventTracking:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">category</span> <span class="nf">action:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">action</span> <span class="nf">label:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">label</span> <span class="nf">value:</span><span class="p">(</span><span class="n">NSNumber</span> <span class="o">*</span><span class="p">)</span><span class="nv">value</span> <span class="nf">screen:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">screen</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">id</span><span class="o">&lt;</span><span class="n">GAITracker</span><span class="o">&gt;</span> <span class="n">tracker</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GAI</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="n">defaultTracker</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// スクリーン名を設定</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tracker</span> <span class="nl">set:</span><span class="n">kGAIScreenName</span> <span class="nl">value:</span><span class="n">screen</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// イベントのトラッキング情報を送信する</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tracker</span> <span class="nl">send:</span><span class="p">[[</span><span class="n">GAIDictionaryBuilder</span> <span class="nl">createEventWithCategory:</span><span class="n">category</span> <span class="nl">action:</span><span class="n">action</span> <span class="nl">label:</span><span class="n">label</span> <span class="nl">value:</span><span class="n">value</span><span class="p">]</span> <span class="n">build</span><span class="p">]];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. 初期化</h3>

<p><em>AppDelegate</em> のヘッダファイルに <em>GAI.h</em> をインポートし、実装ファイルのアプリケーション起動時の部分でトラッキングIDを指定し初期化します。</p>

<h4>AppDelegate.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;GAI.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">AppDelegate</span> : <span class="nc">UIResponder</span> <span class="o">&lt;</span><span class="n">UIApplicationDelegate</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>AppDelegate.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Optional: automatically send uncaught exceptions to Google Analytics.</span>
</span><span class='line'>    <span class="p">[</span><span class="n">GAI</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">trackUncaughtExceptions</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Optional: set Google Analytics dispatch interval to e.g. 20 seconds.</span>
</span><span class='line'>    <span class="p">[</span><span class="n">GAI</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">dispatchInterval</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Optional: set Logger to VERBOSE for debug information.</span>
</span><span class='line'>    <span class="p">[[[</span><span class="n">GAI</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="n">logger</span><span class="p">]</span> <span class="nl">setLogLevel:</span><span class="n">kGAILogLevelNone</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Initialize tracker. Replace with your tracking ID.</span>
</span><span class='line'>    <span class="p">[[</span><span class="n">GAI</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">trackerWithTrackingId:</span><span class="s">@&quot;Your Tracking ID&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>使用方法</h2>

<h3>1. カスタムクラスの読み込み</h3>

<p>ビューコントローラのヘッダファイルに <em>TrackingManager.h</em> をインポートします。</p>

<h4>SampleViewController.h</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;TrackingManager.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">SampleViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2-a. スクリーントラッキング</h3>

<p>実装ファイルの <em>viewWillAppear</em> 内でスクリーントラッキングを行います。</p>

<h4>SampleViewController.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="nl">viewWillAppear:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Google Analytics スクリーントラッキング</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="n">screenName</span> <span class="o">=</span> <span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">self</span> <span class="n">class</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">TrackingManager</span> <span class="nl">sendScreenTracking:</span><span class="n">screenName</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2-b. イベントトラッキング</h3>

<p>例えばボタンをタップした際などにイベントトラッキングを行います。</p>

<p>指定できるのは「カテゴリ」「アクション」「ラベル」「値」「スクリーン名」の 5つで、詳細を正確に指定することにより、コンバージョンの設定が容易になります。</p>

<h4>SampleViewController.m</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">buttonTapEvent:</span><span class="p">(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">button</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Google Analytics イベントトラッキング</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="n">screenName</span> <span class="o">=</span> <span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">self</span> <span class="n">class</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">TrackingManager</span> <span class="nl">sendEventTracking:</span><span class="s">@&quot;Button&quot;</span> <span class="nl">action:</span><span class="s">@&quot;Tap&quot;</span>
</span><span class='line'>                                 <span class="nl">label:</span><span class="s">@&quot;Label&quot;</span> <span class="nl">value:</span><span class="mi">1</span> <span class="nl">screen:</span><span class="n">screenName</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上で iOSアプリへの Google Analytics 導入は完了になります。</p>

<h2>補足</h2>

<p>もし正常に動作しない場合は、ビルド設定の <em>Other Linker Flags</em> に「<em>-ObjC</em>」を追加してください。</p>

<h2>お薦めの参考書</h2>

<p><strong><a href="https://www.amazon.co.jp/gp/product/4797386258/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797386258&linkCode=as2&tag=pinocchio-22">詳解 Swift 改訂版</a></strong><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=pinocchio-22&l=as2&o=9&a=4797386258" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br />
Swiftのかなり入り込んだところまで解説しながら、実践コードを多数収録しています。応用本になりますので、入門書を読み終えて中級者から上級者に差し掛かる時に読むことをお勧めします。読み物としてだけではなくリファレンスとしても使用できます。</p>
]]></content>
  </entry>
  
</feed>
